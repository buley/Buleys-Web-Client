if(typeof window.webkitIndexedDB!=="undefined"){window.IDBCursor=window.webkitIDBCursor;window.IDBDatabase=window.webkitIDBDatabase;window.IDBDatabaseError=window.webkitIDBDatabaseError;window.IDBDatabaseException=window.webkitIDBDatabaseException;window.IDBErrorEvent=window.webkitIDBErrorEvent;window.IDBEvent=window.webkitIDBEvent;window.IDBFactory=window.webkitIDBFactory;window.IDBIndex=window.webkitIDBIndex;window.IDBKeyRange=window.webkitIDBKeyRange;window.IDBObjectStore=window.webkitIDBObjectStore;
window.IDBRequest=window.webkitIDBRequest;window.IDBSuccessEvent=window.webkitIDBSuccessEvent;window.IDBTransaction=window.webkitIDBTransaction;window.indexedDB=window.webkitIndexedDB}else if("mozIndexedDB"in window)window.indexedDB=window.mozIndexedDB;var Buleys={};Buleys.db={};Buleys.queues={};Buleys.settings={};Buleys.profile={};Buleys.mouse={};Buleys.shortcuts={};Buleys.history={};Buleys.session={};Buleys.view={};Buleys.view.scripts=[];Buleys.loader={};Buleys.loader.loaded_scripts=0;
Buleys.loader.total_scripts=0;Buleys.debug={};Buleys.debug.database=false;Buleys.debug.ajax=false;Buleys.debug.items=false;Buleys.settings.mini_inbox_topic_count=5;Buleys.shortcuts.s_depressed=false;Buleys.shortcuts.d_depressed=false;Buleys.shortcuts.shift_depressed=false;Buleys.settings.crawl_speed=1E4;Buleys.settings.crawl_deincrement=0.5;Buleys.settings.crawl_increment=0.2;Buleys.settings.crawl_max=6E6;Buleys.settings.crawl_min=1E4;Buleys.queues.pending_crawls=[];Buleys.queues.new_items={};
Buleys.mouse.mouse_y=0;Buleys.mouse.mouse_x=0;Buleys.mouse.mouse_y_snapshot=0;Buleys.mouse.mouse_x_snapshot=0;Buleys.store=window.localStorage;Buleys.session.database_is_open=false;var session_token="",debug;$(document).ready(function(){set_page_vars();check_login_status();if(typeof Buleys.db==="object")open_database();else if(typeof Buleys.db==="IDBDatabase"){console.log("database loaded");reload_results()}});
function new_archived_transaction(){try{var a=Buleys.db.transaction(["archive"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("archive")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("archive",{keyPath:"link"},true);Buleys.objectStore.createIndex("topic_slug","topic_slug",{unique:false});Buleys.objectStore.createIndex("topic_type","topic_type",
{unique:false});Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function get_archived(a,b,e,d,f){if(typeof f=="undefined")f=false;typeof e=="undefined"||e==null||parseInt(e);typeof d=="undefined"||d==null?(new Date).getTime():parseInt(d);new_categories_transaction();Buleys.index=Buleys.objectStore.index("slug");var i=Buleys.index.getAll(b);i.onsuccess=function(){var g=i.result;if(g)g.length>1?jQuery.each(g,function(k,h){new_archived_transaction();var j=Buleys.objectStore.get(h.link);j.onsuccess=function(){if(typeof j.result!=="undefined"&&f!==true){new_item_transaction();
var c=Buleys.objectStore.get(j.result.link);c.onsuccess=function(){typeof c.result!=="undefined"&&typeof c.result.link!=="undefined"&&jQuery("#"+h.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw(c.result.link)}}else if(f==true){new_item_transaction();c=Buleys.objectStore.get(h.link);c.onsuccess=function(){typeof c.result!=="undefined"&&typeof c.result!=="undefined"&&jQuery("#"+h.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw(c.result.link)}}}}):get_item(g.link)};i.onerror=
function(){}}function archive_item(a){new_archived_transaction();a={link:a,modified:(new Date).getTime()};var b=Buleys.objectStore.add(a);b.onsuccess=function(){Buleys.objectId=b.result};b.onerror=function(){}}
function check_if_item_is_archived(a){new_archived_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){checker=b;typeof b.result!="undefined"?jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("archived"):jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("unarchived")};b.onerror=function(){}}
function add_item_to_archives_database(a,b,e){new_archived_transaction();a={item_link:a,topic_slug:b,topic_type:e,modified:(new Date).getTime()};var d=Buleys.objectStore.add(a);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}function unarchive_item(a){new_archived_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
function remove_item_from_archives_database(a){new_archived_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}};
function get_signin(){var a=get_local_storage("session_id");typeof a=="undefined"||a==null||a==""?jQuery("#main").append('<div id="login_prompt"><div id="login_form"><input id="email" type="text" value="your@email.here" name="email" class="defaulttext" /><br/><input id="password"  class="defaulttext" type="password" value="p4s5w0rd" name="password" /><br/><br/><a href="#" id="doregistration" class="registrationlink">Register</a> or <a href="#" id="dologinsubmit" class="submitloginform">Login</a></div><div id="login_buttons"><a href="#" id="doresetpassword" class="resetpasswordlink">Reset Password</a></div></div></div>'):
jQuery("#main").append("<div id='login_prompt'>Already logged in with session id <code>"+a+"</code>.<br/><br/><a href='#' class='do_logout'>Click here</a> to log out.</div>");Buleys.view.loaded="signin"}function get_registration(){console.log("get_registration(): ")}function get_confirmation(){console.log("get_confirmation(): ")}
function submit_registration(){if($("#password_once").val()==$("#password_twice").val()){var a=$("#password_once").val(),b=$("#first_name").val(),c=$("#display_name").val(),d=$("#last_name").val(),e=$("#address_1").val(),g=$("#address_2").val(),h=$("#city").val(),i=$("#state").val(),j=$("#zip").val(),k=$("#country").val();request_registration(a,c,b,d,e,g,h,i,j,k)}else alert("Passwords don't match")}
function account_logout(){data_to_send={method:"logout"};$.post("/feedback/index.php",data_to_send,function(a){if(typeof a.result!=="undefined"){delete Buleys.store.session_id;jQuery("#login").fadeIn("fast");jQuery("#logout").fadeOut("fast")}},"json")}
function request_login(a,b){b=md5(b);$.post("/api/index.php",{method:"request_login",secret:b,email:a,token:session_token},function(c){if(c!=null&&typeof c.result!=="undefined")if(c.result.toLowerCase()=="failure"){console.log("fail");send_to_console(c.message)}else{if(c.result.toLowerCase()=="success"){set_local_storage("session_id",c.session_id);send_to_console(c.message);jQuery("#login_prompt").html("");jQuery("#login_prompt").append("Just logged in with session id <code>"+get_local_storage("session_id")+
"</code>.<br/><br/><a href='#' class='do_logout'>Click here</a> to log out.")}}else console.log("request_login(): no data")},"json")}
function request_registration(a,b,c,d,e,g,h,i,j,k){a=md5(a);data_to_send={method:"request_registration",secret:a,display_name:b,first_name:c,last_name:d,address_1:e,address_2:g,city:h,state:i,zip:j,country:k};$.post("/feedback/index.php",data_to_send,function(f){if(typeof f.request_status!=="undefined")if(f.result.toLowerCase()=="failure"){typeof f.message!=="undefined"?jQuery("#login_status_pane").prepend("<p>"+f.message+"</p>"):jQuery("#login_status_pane").prepend("There was an error. Your account is not confirmed.");
close_button(jQuery("#login_status_pane"))}else if(f.result.toLowerCase()=="success"){typeof f.message!=="undefined"?jQuery("#login_status_pane").html("<p>"+f.message+"</p>"):jQuery("#login_status_pane").html("Your account is confirmed.");close_button(jQuery("#login_status_pane"))}},"json")}
function confirm_registration(a){data_to_send={method:"confirm_account",secret:a};$.post("/feedback/index.php",data_to_send,function(b){if(typeof b.request_status!=="undefined")if(b.result.toLowerCase()=="failure"){jQuery("#login_status_pane").html("");typeof b.reason!=="undefined"&&jQuery("#login_status_pane").prepend("<p><small>"+b.reason+"<small></p>");typeof b.message!=="undefined"?jQuery("#login_status_pane").prepend("<p>"+b.message+"</p>"):jQuery("#login_status_pane").prepend("There was an error.")}else if(b.result.toLowerCase()==
"success"){typeof b.message!=="undefined"?jQuery("#login_status_pane").html("<p>"+b.message+"</p>"):jQuery("#login_status_pane").html("Your account is confirmed and logged in.");jQuery("#login_status_pane").append('<p><strong>Password</strong>:<input id="password_once"type="password"name="password"/><br/><strong>Password</strong>(again):<input id="password_twice"type="password"name="password_confirm"/></p><p><strong>Public name</strong>:<input id="display_name"type="text"name="display_name"/></p><p id="registration_profile_info"><strong>First Name</strong>: <input id="first_name"type="text"name="first_name"  size="20"/><br/><strong>Last Name</strong>: <input id="last_name"type="text"name="last_name"  size="20"/><br/><strong>Address 1</strong>:<input id="address_1"type="text"name="address_1"/><br/><strong>Apt. #</strong> (optional): <input id="address_2"type="text"name="address_2"/><br/><strong>City</strong>: <input id="city"type="text" name="city" size="20"/><br/><strong>State</strong>: <select id="state" name="state"><option value="AL">AL</option><option value="AK">AK</option><option value="AZ">AZ</option><option value="AR">AR</option><option value="CA">CA</option><option value="CO">CO</option><option value="CT">CT</option><option value="DE">DE</option><option value="DC">DC</option><option value="FL">FL</option><option value="GA">GA</option><option value="HI">HI</option><option value="ID">ID</option><option value="IL">IL</option><option value="IN">IN</option><option value="IA">IA</option><option value="KS">KS</option><option value="KY">KY</option><option value="LA">LA</option><option value="ME">ME</option><option value="MD">MD</option><option value="MA">MA</option><option value="MI">MI</option><option value="MN">MN</option><option value="MS">MS</option><option value="MO">MO</option><option value="MT">MT</option><option value="NE">NE</option><option value="NV">NV</option><option value="NH">NH</option><option value="NJ">NJ</option><option value="NM">NM</option><option value="NY">NY</option><option value="NC">NC</option><option value="ND">ND</option><option value="OH">OH</option><option value="OK">OK</option><option value="OR">OR</option><option value="PA">PA</option><option value="RI">RI</option><option value="SC">SC</option><option value="SD">SD</option><option value="TN">TN</option><option value="TX">TX</option><option value="UT">UT</option><option value="VT">VT</option><option value="VA">VA</option><option value="WA">WA</option><option value="WV">WV</option><option value="WI">WI</option><option value="WY">WY</option></select>&nbsp;&nbsp;&nbsp;<strong>Zip</strong>: <input id="zip"type="text"name="zip" size="10"/><br/><strong>Country</strong>: <select id="country" name="country" size="1"><option value="AF">Afghanistan</option><option value="AX">Axland Islands</option><option value="AL">Albania</option><option value="DZ">Algeria</option><option value="AS">American Samoa</option><option value="AD">Andorra</option><option value="AO">Angola</option><option value="AI">Anguilla</option><option value="AQ">Antarctica</option><option value="AG">Antigua And Barbuda</option><option value="AR">Argentina</option><option value="AM">Armenia</option><option value="AW">Aruba</option><option value="AU">Australia</option><option value="AT">Austria</option><option value="AZ">Azerbaijan</option><option value="BS">Bahamas</option><option value="BH">Bahrain</option><option value="BD">Bangladesh</option><option value="BB">Barbados</option><option value="BY">Belarus</option><option value="BE">Belgium</option><option value="BZ">Belize</option><option value="BJ">Benin</option><option value="BM">Bermuda</option><option value="BT">Bhutan</option><option value="BO">Bolivia</option><option value="BA">Bosnia And Herzegovina</option><option value="BW">Botswana</option><option value="BV">Bouvet Island</option><option value="BR">Brazil</option><option value="IO">British Indian Ocean Territory</option><option value="BN">Brunei Darussalam</option><option value="BG">Bulgaria</option><option value="BF">Burkina Faso</option><option value="BI">Burundi</option><option value="KH">Cambodia</option><option value="CM">Cameroon</option><option value="CA">Canada</option><option value="CV">Cape Verde</option><option value="KY">Cayman Islands</option><option value="CF">Central African Republic</option><option value="TD">Chad</option><option value="CL">Chile</option><option value="CN">China</option><option value="CX">Christmas Island</option><option value="CC">Cocos (Keeling) Islands</option><option value="CO">Colombia</option><option value="KM">Comoros</option><option value="CG">Congo</option><option value="CD">Congo, The Democratic Republic Of The</option><option value="CK">Cook Islands</option><option value="CR">Costa Rica</option><option value="CI">Cote DIvoire</option><option value="HR">Croatia</option><option value="CU">Cuba</option><option value="CY">Cyprus</option><option value="CZ">Czech Republic</option><option value="DK">Denmark</option><option value="DJ">Djibouti</option><option value="DM">Dominica</option><option value="DO">Dominican Republic</option><option value="EC">Ecuador</option><option value="EG">Egypt</option><option value="SV">El Salvador</option><option value="GQ">Equatorial Guinea</option><option value="ER">Eritrea</option><option value="EE">Estonia</option><option value="ET">Ethiopia</option><option value="FK">Falkland Islands (Malvinas)</option><option value="FO">Faroe Islands</option><option value="FJ">Fiji</option><option value="FI">Finland</option><option value="FR">France</option><option value="GF">French Guiana</option><option value="PF">French Polynesia</option><option value="TF">French Southern Territories</option><option value="GA">Gabon</option><option value="GM">Gambia</option><option value="GE">Georgia</option><option value="DE">Germany</option><option value="GH">Ghana</option><option value="GI">Gibraltar</option><option value="GR">Greece</option><option value="GL">Greenland</option><option value="GD">Grenada</option><option value="GP">Guadeloupe</option><option value="GU">Guam</option><option value="GT">Guatemala</option><option value=" Gg">Guernsey</option><option value="GN">Guinea</option><option value="GW">Guinea-Bissau</option><option value="GY">Guyana</option><option value="HT">Haiti</option><option value="HM">Heard Island And Mcdonald Islands</option><option value="VA">Holy See (Vatican City State)</option><option value="HN">Honduras</option><option value="HK">Hong Kong</option><option value="HU">Hungary</option><option value="IS">Iceland</option><option value="IN">India</option><option value="ID">Indonesia</option><option value="IR">Iran, Islamic Republic Of</option><option value="IQ">Iraq</option><option value="IE">Ireland</option><option value="IM">Isle Of Man</option><option value="IL">Israel</option><option value="IT">Italy</option><option value="JM">Jamaica</option><option value="JP">Japan</option><option value="JE">Jersey</option><option value="JO">Jordan</option><option value="KZ">Kazakhstan</option><option value="KE">Kenya</option><option value="KI">Kiribati</option><option value="KP">Korea, Democratic People\'s Republic Of</option><option value="KR">Korea, Republic Of</option><option value="KW">Kuwait</option><option value="KG">Kyrgyzstan</option><option value="LA">Lao People\'s Democratic Republic</option><option value="LV">Latvia</option><option value="LB">Lebanon</option><option value="LS">Lesotho</option><option value="LR">Liberia</option><option value="LY">Libyan Arab Jamahiriya</option><option value="LI">Liechtenstein</option><option value="LT">Lithuania</option><option value="LU">Luxembourg</option><option value="MO">Macao</option><option value="MK">Macedonia, The Former Yugoslav Republic Of</option><option value="MG">Madagascar</option><option value="MW">Malawi</option><option value="MY">Malaysia</option><option value="MV">Maldives</option><option value="ML">Mali</option><option value="MT">Malta</option><option value="MH">Marshall Islands</option><option value="MQ">Martinique</option><option value="MR">Mauritania</option><option value="MU">Mauritius</option><option value="YT">Mayotte</option><option value="MX">Mexico</option><option value="FM">Micronesia, Federated States Of</option><option value="MD">Moldova, Republic Of</option><option value="MC">Monaco</option><option value="MN">Mongolia</option><option value="MS">Montserrat</option><option value="MA">Morocco</option><option value="MZ">Mozambique</option><option value="MM">Myanmar</option><option value="NA">Namibia</option><option value="NR">Nauru</option><option value="NP">Nepal</option><option value="NL">Netherlands</option><option value="AN">Netherlands Antilles</option><option value="NC">New Caledonia</option><option value="NZ">New Zealand</option><option value="NI">Nicaragua</option><option value="NE">Niger</option><option value="NG">Nigeria</option><option value="NU">Niue</option><option value="NF">Norfolk Island</option><option value="MP">Northern Mariana Islands</option><option value="NO">Norway</option><option value="OM">Oman</option><option value="PK">Pakistan</option><option value="PW">Palau</option><option value="PS">Palestinian Territory, Occupied</option><option value="PA">Panama</option><option value="PG">Papua New Guinea</option><option value="PY">Paraguay</option><option value="PE">Peru</option><option value="PH">Philippines</option><option value="PN">Pitcairn</option><option value="PL">Poland</option><option value="PT">Portugal</option><option value="PR">Puerto Rico</option><option value="QA">Qatar</option><option value="RE">Reunion</option><option value="RO">Romania</option><option value="RU">Russian Federation</option><option value="RW">Rwanda</option><option value="SH">Saint Helena</option><option value="KN">Saint Kitts And Nevis</option><option value="LC">Saint Lucia</option><option value="PM">Saint Pierre And Miquelon</option><option value="VC">Saint Vincent And The Grenadines</option><option value="WS">Samoa</option><option value="SM">San Marino</option><option value="ST">Sao Tome And Principe</option><option value="SA">Saudi Arabia</option><option value="SN">Senegal</option><option value="CS">Serbia And Montenegro</option><option value="SC">Seychelles</option><option value="SL">Sierra Leone</option><option value="SG">Singapore</option><option value="SK">Slovakia</option><option value="SI">Slovenia</option><option value="SB">Solomon Islands</option><option value="SO">Somalia</option><option value="ZA">South Africa</option><option value="GS">South Georgia And The South Sandwich Islands</option><option value="ES">Spain</option><option value="LK">Sri Lanka</option><option value="SD">Sudan</option><option value="SR">Suriname</option><option value="SJ">Svalbard And Jan Mayen</option><option value="SZ">Swaziland</option><option value="SE">Sweden</option><option value="CH">Switzerland</option><option value="SY">Syrian Arab Republic</option><option value="TW">Taiwan, Province Of China</option><option value="TJ">Tajikistan</option><option value="TZ">Tanzania, United Republic Of</option><option value="TH">Thailand</option><option value="TL">Timor-Leste</option><option value="TG">Togo</option><option value="TK">Tokelau</option><option value="TO">Tonga</option><option value="TT">Trinidad And Tobago</option><option value="TN">Tunisia</option><option value="TR">Turkey</option><option value="TM">Turkmenistan</option><option value="TC">Turks And Caicos Islands</option><option value="TV">Tuvalu</option><option value="UG">Uganda</option><option value="UA">Ukraine</option><option value="AE">United Arab Emirates</option><option value="GB">United Kingdom</option><option value="US" selected>United States</option><option value="UM">United States Minor Outlying Islands</option><option value="UY">Uruguay</option><option value="UZ">Uzbekistan</option><option value="VU">Vanuatu</option><option value="VE">Venezuela</option><option value="VN">Viet Nam</option><option value="VG">Virgin Islands, British</option><option value="VI">Virgin Islands, U.S.</option><option value="WF">Wallis And Futuna</option><option value="EH">Western Sahara</option><option value="YE">Yemen</option><option value="ZM">Zambia</option><option value="ZW">Zimbabwe</option></select><br/></p>');
request_registration_confirmation_buttons(jQuery("#login_status_pane"))}else jQuery("#login_status_pane").prepend("There was an error.")},"json")}
function send_confirmation(a,b,c,d){if(typeof b==undefined)b="";if(typeof c==undefined)c="";if(typeof d==undefined)d=false;jQuery("body").append("<div id='pending_email' style='display:none;'>"+a+"</div>");b={};b=d?{method:"account_confirmation_resend",email:a,page:slug,context:c}:{method:"account_confirmation",email:a,page:slug,context:c};$.post("/feedback/index.php",b,function(e){if(typeof e.result!=="undefined")if(e.result.toLowerCase()=="failure"){jQuery("#login_status_pane").html("");if(typeof e.reason!==
"undefined")e.reason.toLowerCase()=="account_pending"?pending_confirmation_buttons(jQuery("#login_status_pane")):ready_to_close_button(jQuery("#login_status_pane"));typeof e.message!=="undefined"&&jQuery("#login_status_pane").append("<p>"+e.message+"</p>")}else{pending_secret_confirmation_buttons(jQuery("#login_status_pane"));jQuery("#login_status_pane").html("Thank you. Buley's has sent an email to "+$("#registration_email").val()+'. Please click the verification link in that email or paste its "secret" into the box below:<br/><br/><strong>Secret</strong>: <input id="confirmation_hash" type="text" name="confirmation_hash" />')}},
"json")}
function account_login(a,b){var c=md5(b);data_to_send={method:"email_login",email:a,secret:c};$.post("/feedback/index.php",data_to_send,function(d){if(typeof d.result!=="undefined")if(d.result.toLowerCase()=="failure")typeof d.message!=="undefined"&&send_to_console("<p>"+d.message+"</p>");else if(d.result.toLowerCase()=="success"){jQuery("#login_status_pane").remove();typeof d.message!=="undefined"&&d.message!=null&&d.message!=""?send_to_console("<p>"+d.message+"</p>"):send_to_console("<p>Logged \tin successfully.</p>");jQuery("#register").fadeOut("fast");
jQuery("#login").fadeOut("fast");jQuery("#logout").fadeIn("fast");close_button(jQuery("#login_status_pane"))}},"json")}function cancel_confirmation(){}
function check_login_status(){var a=get_local_storage("session_id");if(typeof a=="undefined"||a==null||a=="")jQuery("#login_status_pane").length>=1?jQuery("#login_status_pane").html('<a href="#" id="get_settings_button" class="get_settings">Settings</a><a href="#" id="get_login" class="getloginform">Login or Signup</a>'):jQuery("#header").append('<div id=\'login_status_pane\'><a href="#" id="get_settings_button" class="get_settings">Settings</a><a href="#" id="get_login" class="getloginform">Login or Signup</a></div>');else jQuery("#login_status_pane").length>=
1?jQuery("#login_status_pane").html('<a href="#" id="get_settings_button" class="get_settings">Settings</a>'):jQuery("#header").append('<div id=\'login_status_pane\'><a href="#" id="get_settings_button" class="get_settings">Settings</a></div>')};
function new_categories_transaction(){try{var a=Buleys.db.transaction(["categories"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("categories")}catch(c){console.log("new_categories_transaction(): Could not open objectStore. You may have to create it first");a=0;if(Buleys.db.version>0)a=1;else a+=1;console.log(Buleys.db);a=Buleys.db.setVersion(a);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("categories",{keyPath:"id"},
true);Buleys.objectStore.createIndex("link","link",{unique:false});Buleys.objectStore.createIndex("slug","slug",{unique:false});Buleys.objectStore.createIndex("type","type",{unique:false});Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function add_category_controls(a){jQuery("#overlay .vote_up_category").remove();jQuery("#overlay .vote_down_category").remove();jQuery("#overlay .delete_category").remove();jQuery("#overlay .selected_category").removeClass(".selected_category");var c=jQuery(a).html(),e=jQuery(a).attr("link"),d=jQuery(a).attr("type"),f=jQuery(a).attr("slug");jQuery(a).html("<span class='vote_up_category thumb_up_icon' link='"+e+"' type='"+d+"' slug='"+f+"'></span><span class='vote_down_category thumb_icon' link='"+
e+"' type='"+d+"' slug='"+f+"'></span>"+c+"<div class='delete_category close_icon' link='"+e+"' type='"+d+"' slug='"+f+"'></div>")}function remove_category_for_item(a,c,e){new_categories_transaction();a=Buleys.objectStore["delete"](a+e+c);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
function remove_item_from_categories_database(a){new_categories_transaction();Buleys.index=Buleys.objectStore.index("link");var c=Buleys.index.get(a);c.onsuccess=function(){if(typeof c.result!=="undefined")if(typeof c.result!=="undefined"){var e="";e=c.result.link.replace(/[^a-zA-Z0-9-_]+/g,"")+c.result.slug.toLowerCase()+c.result.type.toLowerCase();new_categories_transaction();e=Buleys.objectStore["delete"](e);e.onsuccess=function(){delete Buleys.objectId};e.onerror=function(){}}else $.each(c.result,
function(d,f){var b="";b=f.link.replace(/[^a-zA-Z0-9-_]+/g,"")+f.slug.toLowerCase()+f.type.toLowerCase();new_categories_transaction();b=Buleys.objectStore["delete"](b);b.onsuccess=function(){delete Buleys.objectId};b.onerror=function(){}})};c.onerror=function(){}}
function add_categories_to_categories_database(a,c){jQuery.each(c,function(e,d){if(typeof d.key!=="undefined"){new_categories_transaction();var f={id:a.replace(/[^a-zA-Z0-9-_]+/g,"")+d.key.toLowerCase()+d.type.toLowerCase(),link:a,slug:d.key,type:d.type,value:d.value,modified:(new Date).getTime()};f=Buleys.objectStore.add(f);f.onsuccess=function(){if(typeof d.key!=="undefined"){var b=d.type.toLowerCase()+"_"+d.key.toLowerCase();if(typeof Buleys.queues.new_items[b]=="undefined")Buleys.queues.new_items[b]=
0;Buleys.queues.new_items[b]+=1}};f.onerror=function(){}}})}
function get_item_categories_for_overlay(a){new_categories_transaction();Buleys.objectStore.get(a);try{new_categories_transaction();Buleys.index=Buleys.objectStore.index("link");var c=Buleys.index.getAll(a);c.onsuccess=function(){var d=c.result;d&&d.length>=0&&jQuery.each(d,function(f,b){if(jQuery("#categories_"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).length<1){var g="<ul class='category_list' id='categories_"+a.replace(/[^a-zA-Z0-9-_]+/g,"")+"'></ul>";jQuery("#overlay_"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).append(g)}g=
"<li id='list_item_"+a.replace(/[^a-zA-Z0-9-_]+/g,"")+b.type.toLowerCase()+b.slug.toLowerCase()+"' class='category_list_item' link='"+a+"' type='"+b.type.toLowerCase()+"' slug='"+b.slug.toLowerCase()+"'><a id='"+a.replace(/[^a-zA-Z0-9-_]+/g,"")+b.type.toLowerCase()+b.slug.toLowerCase()+"'  class='category' link='"+a+"' type='"+b.type.toLowerCase()+"' slug='"+b.slug.toLowerCase()+"' href='/"+b.type.toLowerCase()+"/"+b.slug+"'>"+b.value+"</a></li>";jQuery("#categories_"+a.replace(/[^a-zA-Z0-9-_]+/g,
"")).append(g);get_vote_info(a,b.type.toLowerCase(),b.slug.toLowerCase())})};request.onerror=function(){}}catch(e){}};
function flash_console(a){send_to_console(a);jQuery("#console_wrapper").stop(true).animate({opacity:1},500);jQuery("#console_wrapper").stop(true).animate({opacity:0},500)}function send_text_to_console(a){jQuery("#console").html("").append("<p>"+a+"</p>")}function send_to_console(a){send_text_to_console(a);jQuery("#console_wrapper").stop(true).animate({opacity:1},500)}function fade_console_message(){jQuery("#console_wrapper").stop(true).animate({opacity:0},500)};
function do_work(){Buleys.queues.pending_crawls.length>0?do_pending_crawl():get_follows();var a=0;a=getKeys(Buleys.queues.new_items);if(a>0){var b=type+"_"+slug;typeof Buleys.queues.new_items[b]!=="undefined"&&delete Buleys.queues.new_items[b];if(getKeys(Buleys.queues.new_items)>0)typeof jQuery("#minimize_inbox")!=="undefined"&&a>0&&jQuery("#get_inbox").removeClass("inbox_icon").addClass("empty_inbox_icon").parent().parent().removeClass("empty_inbox").addClass("waiting_inbox");else jQuery("#get_inbox img").removeClass("empty_inbox_icon").addClass("inbox_icon").parent().parent().addClass("empty_inbox").removeClass("waiting_inbox");
save_queues();save_settings()}if(Buleys.mouse.mouse_y_snapshot===Buleys.mouse.mouse_y&&Buleys.mouse.mouse_x_snapshot===Buleys.mouse.mouse_x)if(Buleys.settings.crawl_speed>=Buleys.settings.crawl_min)Buleys.settings.crawl_speed*=Buleys.settings.crawl_increment;else Buleys.settings.crawl_speed=Buleys.settings.crawl_min;else{if(Buleys.settings.crawl_speed<=Buleys.settings.crawl_max)Buleys.settings.crawl_speed*=Buleys.settings.crawl_deincrement;else Buleys.settings.crawl_speed=Buleys.settings.crawl_max;
Buleys.mouse.mouse_y_snapshot=Buleys.mouse.mouse_y;Buleys.mouse.mouse_x_snapshot=Buleys.mouse.mouse_x}if(jQuery(".unseen").length>0){window.document.title=window.document.title.replace(/[|\s]*?Buley's/,"");window.document.title=window.document.title.replace(/\(.*?\)[|\s]*?/g,"")+" ("+jQuery(".unseen").length+") | Buley's"}else window.document.title=window.document.title.replace(/[\s]?\(.*?\)/g,"");setTimeout("do_work()",Buleys.settings.crawl_speed)};
function is_in_cursor_mode(){return jQuery(".cursor").length>0?true:false};
function new_favorite_transaction(){try{var a=Buleys.db.transaction(["favorites"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("favorites")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("favorites",{keyPath:"item_link"},true);Buleys.objectStore.createIndex("topic_slug","topic_slug",{unique:false});Buleys.objectStore.createIndex("topic_type","topic_type",
{unique:false});Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function add_favorite_to_results(a){var b=a.link.replace(/[^a-zA-Z0-9-_]+/g,"");jQuery("#"+b).length||jQuery("<li class='item' modified= '"+a.modified+"'  index-date= '"+a.index_date+"' published-date= '"+a.published_date+"' id='"+a.link.replace(/[^a-zA-Z0-9-_]+/g,"")+"'><a href='"+a.link+"'>"+a.title+"</a><a href='#' class='magnify_icon'></a></li>").hide().prependTo("#results").fadeIn("slow")}
function get_favorites(a,b,c,e){typeof c=="undefined"||parseInt(c);typeof e=="undefined"?(new Date).getTime():parseInt(e);new_categories_transaction();Buleys.index=Buleys.objectStore.index("slug");var h=Buleys.index.getAll(b);h.onsuccess=function(){var f=h.result;if(f)f.length>1?jQuery.each(f,function(j,d){new_favorite_transaction();var i=Buleys.objectStore.get(d.link);i.onsuccess=function(){if(typeof i.result!=="undefined"){new_item_transaction();var g=Buleys.objectStore.get(d.link);g.onsuccess=
function(){typeof g.result!=="undefined"&&typeof g.result.link!=="undefined"&&jQuery("#"+d.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw(g.result.link)}}};i.onerror=function(){if(jQuery("#"+d.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0){add_item_to_results(d);check_if_item_is_favorited(d.link);check_if_item_is_read(d.link);check_if_item_is_seen(d.link)}}}):get_item(f.link)};h.onerror=function(){}}
function get_favorite(a){if(typeof a!=="undefined"){new_favorite_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!="undefined"){new_archived_transaction();var c=Buleys.objectStore.get(a);c.onsuccess=function(){if(typeof c.result==="undefined")if(jQuery("#"+b.result.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0){add_favorite_to_results(b.result);check_if_favorite_is_favorited(b.result.link);check_if_favorite_is_read(b.result.link);check_if_favorite_is_seen(b.result.link)}};
c.onerror=function(){if(jQuery("#"+b.result.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0){add_favorite_to_results(b.result);check_if_favorite_is_favorited(b.result.link);check_if_favorite_is_read(b.result.link);check_if_favorite_is_seen(b.result.link)}}}};b.onerror=function(){}}}
function get_favorite_for_console(a){new_favorite_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!="undefined"&&typeof b.result.id=="string"){var c="<div id='console_"+b.result.id.replace(/[^a-zA-Z0-9-_]+/g,"")+"'>";c=c+"<h3><a href='"+b.result.id+"'>"+b.result.title+"</a></h3>";c=c+"<p>"+b.result.author+"</p>";c+="</div>";send_to_console(c)}};b.onerror=function(){}}
function get_favorite_for_overlay(a){new_favorite_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!="undefined"&&typeof b.result.link=="string"){var c='<div id="overlay_right"><div class="sidebar_close_link"><div href="#" class="close_sidebar_link close_icon" id="'+favorite_slug+"\"></div></div><h3 id='overlay_"+favorite_slug.replace(/[^a-zA-Z0-9-_]+/g,"")+"'><div href='"+b.result.link+"'>"+b.result.title+"</div></h3></div><div id='overlay_left'></div>";send_to_overlay(c)}};
b.onerror=function(){}}function add_item_as_favorite(a){new_status_transaction();a={link:a,status:"favorite",modified:(new Date).getTime()};var b=Buleys.objectStore.add(a);b.onsuccess=function(){Buleys.objectId=b.result};b.onerror=function(){}}
function check_if_item_is_favorited_for_overlay(a){new_favorite_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){checker=b;if(typeof b.result!="undefined"){jQuery("#overlay_left").prepend("<div class='overlay_favorite_status' id='favorite_"+a.replace(/[^a-zA-Z0-9-_]+/g,"")+"'><div href='"+a+"' class='unfav_link star_icon'></div></div>");jQuery("#overlay_left").addClass("favorited")}else{jQuery("#overlay_left").prepend("<div class='overlay_favorite_status' id='favorite_"+a.replace(/[^a-zA-Z0-9-_]+/g,
"")+"'><div href='"+a+"' class='fav_link empty_star_icon'></div></div>");jQuery("#overlay_left").addClass("unfavorited")}};b.onerror=function(){}}
function check_if_item_is_favorited(a){new_favorite_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){checker=b;if(typeof b.result!="undefined"){jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).prepend("<span class='favorite_status'><div href='"+a+"' class='unfav_link star_icon'></div></span>");jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("favorited")}else{jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).prepend("<span class='favorite_status'><div href='"+a+"' class='fav_link empty_star_icon'></div></span>");
jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("unfavorited")}};b.onerror=function(){}}function add_item_to_favorites_database(a,b,c){new_favorite_transaction();a={item_link:a,topic_slug:b,topic_type:c,modified:(new Date).getTime()};var e=Buleys.objectStore.add(a);e.onsuccess=function(){Buleys.objectId=e.result};e.onerror=function(){}}
function remove_item_from_favorites_database(a){new_favorite_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}};
function new_follows_transaction(){try{var a=Buleys.db.transaction(["follows"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("follows")}catch(c){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("follows",{keyPath:"key"},true);Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function get_follows(){try{new_follows_transaction();Buleys.index=Buleys.objectStore;var a=Buleys.index.getAll();a.onsuccess=function(){var b=a.result;b&&b.length>=0&&jQuery.each(b,function(d,e){parse_single_topic(e.key)})};request.onerror=function(){}}catch(c){}}$("html").bind("mousemove",function(a){Buleys.mouse.mouse_x=a.pageX;Buleys.mouse.mouse_y=a.pageY});function getKeys(a){var c=[];if(typeof a!=="undefined"){$.each(a,function(b){c.push(b)});return c.length}else return 0}
function get_follows_deleteme(){new_follows_transaction();try{new_categories_transaction();Buleys.index=Buleys.objectStore.index("id");var a=Buleys.index.getAll();a.onsuccess=function(){var b=a.result;b&&b.length>=0&&jQuery.each(b,function(d,e){send_to_console("get_follows(): "+e)})};request.onerror=function(){}}catch(c){}}
function get_page_follow_status(a,c){new_follows_transaction();var b=Buleys.objectStore.get(a+"_"+c);b.onsuccess=function(){typeof b.result=="undefined"||b.result==""?jQuery("#page_meta").append("<a href='#' class='follow_topic empty_heart_icon'></a>"):jQuery("#page_meta").append("<a href='#' class='unfollow_topic heart_icon'></a>")};b.onerror=function(){}}
function remove_follow(a,c){if(typeof a!=="undefined"&&typeof c!=="undefined"){new_follows_transaction();var b=Buleys.objectStore["delete"](a+"_"+c);b.onsuccess=function(){delete Buleys.objectId};b.onerror=function(){}}}function add_follow_if_doesnt_exist(a,c){if(typeof a!=="undefined"&&typeof c!=="undefined"){new_follows_transaction();var b=Buleys.objectStore.get(a+"_"+c);b.onsuccess=function(){typeof b.result=="undefined"&&add_follow_to_follows_database(a,c)};b.onerror=function(){}}}
function add_follow_to_follows_database(a,c){new_follows_transaction();var b={key:a+"_"+c,modified:(new Date).getTime()},d=Buleys.objectStore.add(b);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}};
function add_topics_to_mini_inbox(){jQuery("#mini_inbox_list").html("");var b=0;getKeys(Buleys.queues.new_items)>0?$.each(Buleys.queues.new_items,function(c,a){if(b<=Buleys.settings.mini_inbox_topic_count){add_topic_to_mini_inbox(c,a);b++}}):jQuery("#mini_inbox_list").html("<li>No new items</li>")}
function add_topic_to_mini_inbox(b,c){new_topics_transaction();var a=Buleys.objectStore.get(b);a.onsuccess=function(){if(typeof a.result=="undefined"||a.result==""){var d=b.split("_",1),e=d[0];d=b.replace(d[0]+"_","");jQuery("#mini_inbox_list").append("<li><a href='/"+e+"/"+d+"' class='topic_name'>"+b+"</a> ("+c+")</li>")}else typeof a.result.name!="undefined"&&jQuery("#mini_inbox_list").append("<li><a href='/"+a.result.type+"/"+a.result.key+"' class='topic_name'>"+a.result.name+"</a> ("+c+")</li>")};
a.onerror=function(){}};
function new_item_transaction(){try{var a=Buleys.db.transaction(["items"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("items")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version,10)+1);a.onsuccess=function(){Buleys.db.objectStore=Buleys.db.createObjectStore("items",{keyPath:"link"},false);Buleys.db.objectStore.createIndex("author","author",{unique:false});Buleys.db.objectStore.createIndex("published_date","published_date",
{unique:false});Buleys.db.objectStore.createIndex("index_date","index_date",{unique:false});Buleys.db.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function new_item_transaction_old(){try{var a=Buleys.db.transaction(["items"],1,1E3);a.oncomplete=function(){};a.onabort=function(){};Buleys.db.objectStore=a.objectStore("items");console.log("New Transaction",Buleys.db.objectStore)}catch(b){console.log("e",b);console.log("new_item_transaction(): Create object store; db: "+Buleys.db);console.log("Fail!",Buleys.db,typeof Buleys.db.setVersion);if(typeof Buleys.db.setVersion==="function"){a=Buleys.db.setVersion(parseInt(Buleys.db.version,10)+1);a.onsuccess=
function(){console.log("Version changed to ",Buleys.db.version,", so trying to create a database now.");Buleys.db.objectStore=Buleys.db.createObjectStore("items",{keyPath:"link"},false);Buleys.db.objectStore.createIndex("author","author",{unique:false});Buleys.db.objectStore.createIndex("published_date","published_date",{unique:false});Buleys.db.objectStore.createIndex("index_date","index_date",{unique:false});Buleys.db.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}}
function remove_item_from_items_database(a){new_item_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}function get_data_object_for_item(a){return{link:a.link,title:a.title,author:a.author,published_date:(new Date(a.published_date)).getTime(),index_date:(new Date(a.index_date)).getTime(),modified:(new Date).getTime()}}
function add_item_to_results(a){var b=a.link.replace(/[^a-zA-Z0-9-_]+/g,"");jQuery("#"+b).length||jQuery("<li class='item' modified= '"+a.modified+"'  index-date= '"+a.index_date+"' published-date= '"+a.published_date+"' id='"+a.link.replace(/[^a-zA-Z0-9-_]+/g,"")+"'><a href='"+a.link+"'>"+a.title+"</a><a class='examine_item magnify_icon' href='#'></a></li>").hide().prependTo("#results").fadeIn("slow")}
function add_item_to_items_database(a){var b=get_data_object_for_item(a);new_deleted_transaction();var c=Buleys.objectStore.get(a.link);c.onsuccess=function(){if(typeof c.result==="undefined"){new_item_transaction();var d=Buleys.objectStore.add(b);d.onsuccess=function(){if(a.categories.length>1&&typeof a.categories.type==="undefined"&&typeof a.categories.key==="undefined")$.each(a.categories,function(f,e){if(Buleys.view.type==="home"||typeof Buleys.view.slug==="undefined"||typeof Buleys.view.slug===
""||e.key!==null&&typeof e.key!=="null"&&e.key===slug)if(typeof page==="undefined"||page!=="favorites"&&page!=="seen"&&page!=="read"&&page!=="archive")add_item_to_results(get_data_object_for_item(a))});else if(a.categories.length===1&&typeof a.categories.key!=="undefined")if(Buleys.view.type==="home"||a.categories[0].key.toLowerCase()===slug&&a.categories[0].type.toLowerCase()===type)add_item_to_results(get_data_object_for_item(a))};d.onerror=function(){}}};c.onerror=function(){}}
function check_if_item_is_read(a){new_status_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){typeof b.result!=="undefined"?jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("read"):jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("unread")};b.onerror=function(){}}
function get_item_for_overlay(a){new_item_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!=="undefined"&&typeof b.result.link==="string"){var c='<div id="overlay_right"><div class="sidebar_close_link"><div class="close_sidebar_link cross_icon" id="'+a+"\"></div></div><h3 id='overlay_"+a.replace(/[^a-zA-Z0-9-_]+/g,"")+"'><a href='"+b.result.link+"'>"+b.result.title+"</a></h3></div><div id='overlay_left'></div><div id='overlay_controls'><a href='"+a+"' class='favorite_item'>Favorite</a>&nbsp;<a href='"+
a+"' class='unfavorite_item'>Unfavorite</a>&nbsp;<a href='"+a+"' class='mark_item_as_read'>Mark as read</a>&nbsp;<a href='"+a+"' class='mark_item_as_unread'>Mark as unread</a>&nbsp;<a href='"+a+"' class='mark_item_as_seen'>Mark as seen</a>&nbsp;<a href='"+a+"' class='mark_item_as_unseen'>Mark as unseen</a>&nbsp;<a href='"+a+"' class='archive_item'>Archive</a>&nbsp;<a href='"+a+"' class='delete_item'>Delete</a>&nbsp;<a href='"+a+"' class='unarchive_item'>Unarchive</a>&nbsp;<a href='"+a+"' class='vote_item_up'>Vote up</a>&nbsp;<a href='"+
a+"' class='vote_item_down'>Vote down</a>&nbsp;<a href='"+a+"' class='close_item_preview'>Close preview</a></div>";send_to_overlay(c)}};b.onerror=function(){}}
function get_item_raw_no_trash(a){if(typeof a!=="undefined"){new_item_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!=="undefined")if(jQuery("#"+b.result.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0){add_item_to_results(b.result);check_if_item_is_favorited(b.result.link);check_if_item_is_read(b.result.link);check_if_item_is_seen(b.result.link)}};b.onerror=function(){if(jQuery("#"+b.result.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0){add_item_to_results(b.result);
check_if_item_is_favorited(b.result.link);check_if_item_is_read(b.result.link);check_if_item_is_seen(b.result.link)}}}}
function get_item(a){if(typeof a!=="undefined"){new_deleted_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result==="undefined"){new_item_transaction();var c=Buleys.objectStore.get(a);c.onsuccess=function(){if(typeof c.result!=="undefined"){new_archived_transaction();var d=Buleys.objectStore.get(a);d.onsuccess=function(){typeof d.result==="undefined"&&get_item_raw_no_trash(c.result.link)};d.onerror=function(){if(jQuery("#"+c.result.link.replace(/[^a-zA-Z0-9-_]+/g,
"")).length<=0){add_item_to_results(c.result);check_if_item_is_favorited(c.result.link);check_if_item_is_read(c.result.link);check_if_item_is_seen(c.result.link)}}}};c.onerror=function(){}}};b.onerror=function(){}}}
function get_item_raw(a){if(typeof a!=="undefined"){new_item_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!=="undefined"){new_deleted_transaction();var c=Buleys.objectStore.get(a);c.onsuccess=function(){if(typeof c.result==="undefined")if(jQuery("#"+b.result.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0){add_item_to_results(b.result);check_if_item_is_favorited(b.result.link);check_if_item_is_read(b.result.link);check_if_item_is_seen(b.result.link)}}}};b.onerror=
function(){}}}
function get_items(a,b,c,d){var f=0;f=typeof c==="undefined"?0:parseInt(c,10);c=0;c=typeof d==="undefined"?(new Date).getTime():parseInt(d,10);if(typeof b==="undefined"||a==="home"){Buleys.keyRange=new IDBKeyRange.bound(f,c,true,false);console.log("Range Defined",Buleys.db,Buleys.keyRange);Buleys.db.onCursor=function(g){console.log("get_items callback objectStore",g,Buleys.db.objectStore);new_item_transaction();Buleys.db.indexItem=Buleys.db.objectStore.index("published_date");var h=Buleys.db.indexItem.openCursor(Buleys.keyRange);
h.onsuccess=function(){if(typeof h.result!=="undefined"){Buleys.cursor=h.result;console.log("get_items() cursor value ",Buleys.cursor.value);alert(Buleys.cursor.value.link);get_item(Buleys.cursor.value.link);if(typeof Buleys.cursor["continue"]==="function")Buleys.cursor["continue"]()}};h.onerror=function(){}};Buleys.db.onCursor(function(){})}else{new_categories_transaction();Buleys.index=Buleys.objectStore.index("slug");console.log("get_items db stuff ",Buleys.db,Buleys.index);var e=Buleys.index.getAll(b);
e.onsuccess=function(){var g=e.result;if(g)g.length>1?jQuery.each(g,function(h,i){console.log("get_item(): ",i.link);get_item(i.link)}):get_item(g.link)};e.onerror=function(){}}}
function get_item_for_console(a){new_item_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!=="undefined"&&typeof b.result.id==="string"){var c="<div id='console_"+b.result.id.replace(/[^a-zA-Z0-9-_]+/g,"")+"'>";c=c+"<h3><a href='"+b.result.id+"'>"+b.result.title+"</a></h3>";c=c+"<p>"+b.result.author+"</p>";c+="</div>";send_to_console(c)}};b.onerror=function(){}}
function fire_off_request(){$.ajax({url:typeof Buleys.view.type==="undefined"||Buleys.view.type===""?"/feedback/index.php":"http://static.buleys.com/js/collections/"+Buleys.view.type+"/"+Buleys.view.slug+".js",dataType:"jsonp",jsonpCallback:"load_collection",error:function(){$("#index").html("<li class='item'>No results.</li>")},success:function(a){Buleys.view.slug=a.info.key;Buleys.view.type=a.info.type;populate_and_maybe_setup_indexeddbs(a.items);get_data_for_items(a.items);add_items(a.items,a.info.type,
a.info.key);load_page_title_info(a.info);add_or_update_topic(a.info.type+"_"+a.info.key,a.info)}})}function get_data_for_items(a){$.each(a,function(b,c){get_item(c.link)})}function add_items(a,b,c){$.each(a,function(d,f){add_item_if_new(f,b,c)})}function populate_and_maybe_setup_indexeddbs(a){$.each(a,function(b,c){add_item_if_doesnt_exist(c)})}
function add_item_if_new(a,b,c){new_item_transaction();var d=Buleys.objectStore.get(a.link);d.onsuccess=function(f){if(typeof f.target.result==="undefined"){new_deleted_transaction();Buleys.objectStore.get(a.link).onsuccess=function(e){if(typeof e.target.result==="undefined"){add_item_to_items_database(a);add_categories_to_categories_database(a.link,a.categories);send_to_console("<p>Added: <a href='"+a.link+"'>"+a.title+"</a></p>");e=b.toLowerCase()+"_"+c.toLowerCase();if(typeof Buleys.queues.new_items[e]===
"undefined")Buleys.queues.new_items[e]=0;Buleys.queues.new_items[e]+=1}};d.onerror=function(){}}};d.onerror=function(){}}function add_item_if_doesnt_exist_old(a){new_item_transaction();var b=Buleys.objectStore.get(a.link);b.onsuccess=function(){if(typeof b.result==="undefined"){add_item_to_items_database(a);add_categories_to_categories_database(a.link,a.categories)}};b.onerror=function(){}}
function add_item_if_doesnt_exist(a){new_item_transaction();var b=Buleys.objectStore.get(a.link);b.onsuccess=function(){if(typeof b.result==="undefined"){add_item_to_items_database(a);add_categories_to_categories_database(a.link,a.categories);a.categories.length>0&&$.each(a.categories,function(c,d){if(Buleys.view.type==="home"||typeof Buleys.view.slug==="undefined"||typeof Buleys.view.slug===""||d.key!==null&&typeof d.key!=="null"&&d.key===Buleys.view.slug&&d.type===Buleys.view.type){add_item_to_results(get_data_object_for_item(a));
check_if_item_is_favorited(a.link);check_if_item_is_read(a.link);check_if_item_is_seen(a.link)}})}};b.onerror=function(){}};
function post_feedback(a,b,c,d){$.post("/feedback/index.php",{event:a,item:b,context:c,type:d},function(){},dataType="json")};
$("#dologin").live("click",function(a){a.preventDefault();$("#dologin").remove();$("#login_status_pane").append('<div id="minimize_login_controls"><a href="#" id="dologinboxminimize" class="loginboxminimizelink enter_door_icon"></a></div><div id="login_form"><a href="#" id="doregistration" class="registrationlink">Register</a> or Login:<br/><input id="email" type="text" value="your@email.here" name="email" class="defaulttext" /><br/><input id="password"  class="defaulttext" type="password" value="p4s5w0rd" name="password" /></div><div id="login_buttons"><a href="#" id="doresetpassword" class="resetpasswordlink">Reset Password</a><br/><a href="#" id="dologinsubmit" class="submitloginform">Login</a></div></div>')});
$("a#get_inbox").live("click",function(a){a.preventDefault();$("#mini_inbox_box").html('<div id="mini_inbox_wrapper"><div id="minimize_mini_inbox_controls"><a href="#" id="minimize_inbox cross_link"></a></div><ul id="mini_inbox_list"><li>Loading...</li></ul></div>');add_topics_to_mini_inbox()});$("#minimize_inbox").live("click",function(a){a.preventDefault();$("#mini_inbox_box").hasClass("waiting_inbox")?$("#mini_inbox_box").html('<a href="#" id="get_inbox inbox"></a>'):$("#mini_inbox_box").html('<a href="#" id="get_inbox empty_inbox"></a>')});
$("#dologinboxminimize").live("click",function(a){a.preventDefault();$("#login_status_pane").html('<a href="#" id="dologin" class="getloginform exit_door_link"></a>')});$("#show_commands").live("click",function(a){a.preventDefault();$("#result_controls").show()});$("#hide_commands").live("click",function(a){a.preventDefault();$("#result_controls").hide()});
$("html").live("keyup",function(a){if(a.keyCode==68)Buleys.shortcuts.d_depressed=false;else if(a.keyCode==83)Buleys.shortcuts.s_depressed=false;else if(a.keyCode==16)Buleys.shortcuts.shift_depressed=false;else if(a.keyCode==72)Buleys.shortcuts.s_depressed||Buleys.shortcuts.d_depressed||(Buleys.shortcuts.shift_depressed?$("#view_index").click():$("#close_item_preview").click());else if(a.keyCode==76){if(!Buleys.shortcuts.s_depressed)if(!Buleys.shortcuts.d_depressed)if(Buleys.shortcuts.shift_depressed)$("#view_home").click();
else{$("#preview_item").click();jQuery(".cursor")}}else if(a.keyCode==78){$("#preview_item").click();jQuery(".selected").length>0?jQuery("#results li.selected:first").addClass("cursor"):jQuery("#results li:first").addClass("cursor")}else if(a.keyCode==74)if(jQuery(".cursor").next().length>0)jQuery(".cursor").removeClass("cursor").next().addClass("cursor");else{jQuery(".cursor").removeClass("cursor");jQuery("#results li:first").addClass("cursor")}else if(a.keyCode==75)if(jQuery(".cursor").prev().length>
0)jQuery(".cursor").removeClass("cursor").prev().addClass("cursor");else{jQuery(".cursor").removeClass("cursor");jQuery("#results li:last").addClass("cursor")}else if(a.keyCode==27){jQuery(".cursor").removeClass("cursor");$("#close_all").click()}else if(a.keyCode==77)jQuery(".cursor").removeClass("cursor");else if(a.keyCode==219)$("#preview_item").click();else if(a.keyCode==221)$("#close_item_preview").click();else if(a.keyCode==89)$("#show_commands").click();else if(a.keyCode==85)$("#hide_commands").click();
else if(a.keyCode==65)if(Buleys.shortcuts.s_depressed)$("#select_all").click();else Buleys.shortcuts.d_depressed&&$("#select_none").click();else if(a.keyCode==82)if(Buleys.shortcuts.s_depressed)$("#select_unread").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_unread").click();else Buleys.shortcuts.shift_depressed?$("#view_unread").click():$("#mark_unread").click();else if(a.keyCode!=13)if(a.keyCode==73)$("#select").click();else if(a.keyCode==79)$("#deselect").click();else if(a.keyCode==
69)if(Buleys.shortcuts.s_depressed)$("#select_read").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_read").click();else Buleys.shortcuts.shift_depressed?$("#view_read").click():$("#mark_read").click();else if(a.keyCode==88)if(Buleys.shortcuts.s_depressed)$("#select_none").click();else Buleys.shortcuts.d_depressed||(Buleys.shortcuts.shift_depressed?$("#view_trash").click():$("#delete").click());else if(a.keyCode==67)if(Buleys.shortcuts.s_depressed)$("#select_archived").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_archived").click();
else Buleys.shortcuts.shift_depressed?$("#view_archive").click():$("#archive").click();else if(a.keyCode==86)if(Buleys.shortcuts.s_depressed)$("#select_unarchived").click();else Buleys.shortcuts.d_depressed?$("#deselect_unarchived").click():$("#unarchive").click();else if(a.keyCode==70)if(Buleys.shortcuts.s_depressed)$("#select_favorites").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_favorites").click();else Buleys.shortcuts.shift_depressed?$("#view_favorites").click():$("#favorite").click();
else if(a.keyCode==71)if(Buleys.shortcuts.s_depressed)$("#select_unfavorite").click();else Buleys.shortcuts.d_depressed?$("#deselect_unfavorite").click():$("#unfavorite").click();else if(a.keyCode==81)if(Buleys.shortcuts.s_depressed)$("#select_seen").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_seen").click();else Buleys.shortcuts.shift_depressed?$("#view_seen").click():$("#mark_seen").click();else if(a.keyCode==87)if(Buleys.shortcuts.s_depressed)$("#select_unseen").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_unseen").click();
else Buleys.shortcuts.shift_depressed?$("#view_unseen").click():$("#mark_unseen").click();else if(a.keyCode==90)if(Buleys.shortcuts.s_depressed)$("#select_inverse").click();else Buleys.shortcuts.d_depressed||(Buleys.shortcuts.shift_depressed?$("#view_index").click():$("#refresh").click());else if(a.keyCode==73)$("#deselect").click();else a.keyCode==79&&$("#select").click()});
$("html").live("keydown",function(a){if(a.keyCode==68)Buleys.shortcuts.d_depressed=true;else if(a.keyCode==83)Buleys.shortcuts.s_depressed=true;else if(a.keyCode==16)Buleys.shortcuts.shift_depressed=true});$(window).bind("popstate",function(){console.log(location.pathname);if(Buleys.session.database_is_open){reload_results();Buleys.session.database_is_open=true}});
$(".get_settings").live("click",function(a){a.preventDefault();console.log(location.pathname);console.log("view_settings clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};console.log(history);history.pushState(a,"settings","http://buleys.com/settings");reload_results()});
$("#get_login").live("click",function(a){a.preventDefault();console.log(location.pathname);console.log("get_login clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};history.pushState(a,"login","http://buleys.com/start");reload_results()});
$("#view_seen").live("click",function(a){a.preventDefault();console.log(location.pathname);console.log("view_seen clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_seen",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/seen":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/seen":"http://buleys.com/seen");reload_results()});
$("#view_unseen").live("click",function(a){a.preventDefault();console.log(location.pathname);console.log("view_unseen clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_unseen",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/unseen":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/unseen":"http://buleys.com/unseen");reload_results()});
$("#view_read").live("click",function(a){a.preventDefault();console.log(location.pathname);console.log("view_read clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_read",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/read":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/read":"http://buleys.com/read");reload_results()});
$("#view_unread").live("click",function(a){a.preventDefault();console.log(location.pathname);console.log("view_unread clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_unread",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/unread":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/unread":"http://buleys.com/unread");reload_results()});
$("#view_trash").live("click",function(a){a.preventDefault();console.log(location.pathname);console.log("view_trash clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_trash",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/trash":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/trash":"http://buleys.com/trash");reload_results()});
$("#view_archive").live("click",function(a){a.preventDefault();console.log(location.pathname);console.log("view_archive clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_archive",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/archive":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/archive":"http://buleys.com/archive");reload_results()});
$("#view_favorites").live("click",function(a){a.preventDefault();console.log(location.pathname);console.log("view_favorites clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_favorites",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/favorites":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/favorites":"http://buleys.com/favorites");reload_results()});
$("#view_index").live("click",function(a){a.preventDefault();console.log(location.pathname);console.log("view_index clicked");jQuery("#page_meta").html("");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};history.pushState(a,"view_index","http://buleys.com/");reload_results()});
$("#view_home").live("click",function(a){a.preventDefault();console.log(location.pathname);console.log("view_home clicked");jQuery("#page_meta").html("");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";if(typeof slug!="undefined"&&slug!="")c="http://buleys.com/"+type+"/"+slug+"/";else if(typeof type!="undefined"&&type!="")c="http://buleys.com/"+type+"/";history.pushState(a,"view_home",c);reload_results()});
$("#dologinsubmit").live("click",function(a){a.preventDefault();$('[name="password"]').val()&&request_login($('[name="email"]').val(),$('[name="password"]').val())});
$(".unfav_link").live("click",function(a){a.preventDefault();jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("empty_star_icon").addClass("star_icon");jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("unfav_link").addClass("fav_link");
jQuery("#favorite_"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("star_icon").addClass("empty_star_icon");jQuery("#favorite_"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("unfav_link").addClass("fav_link");remove_item_from_favorites_database($(this).attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("unstar",$(this).attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item removed from favorites</p>");
setTimeout("fade_console_message()",1E3)});
$("#favorite").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){jQuery("#"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("empty_star_icon").addClass("star_icon");jQuery("#"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("unfav_link");
jQuery("#favorite_"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("empty_star_icon").addClass("star_icon");jQuery("#favorite_"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("fav_link").addClass("unfav_link");add_item_to_favorites_database($(".cursor a").attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("star",$(".cursor a").attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item favorited</p>");
setTimeout("fade_console_message()",1E3)}else $.each($(".selected"),function(c,b){jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("empty_star_icon").addClass("star_icon");jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("unfav_link");
jQuery("#favorite_"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("empty_star_icon").addClass("star_icon");jQuery("#favorite_"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("fav_link").addClass("unfav_link");add_item_to_favorites_database($(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("star",$(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);
send_to_console("<p>item favorited</p>");setTimeout("fade_console_message()",1E3)})});
$("#unfavorite").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){jQuery("#"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("star_icon").addClass("empty_star_icon");jQuery("#"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("unfav_link");
jQuery("#favorite_"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("star_icon").addClass("empty_star_icon");jQuery("#favorite_"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("unfav_link").addClass("fav_link");remove_item_from_favorites_database($(".cursor > a").attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("unstar",$(".cursor > a").attr("href"),Buleys.view.slug,Buleys.view.type);
send_to_console("<p>item removed from favorites</p>");setTimeout("fade_console_message()",1E3)}else $.each($(".selected"),function(c,b){jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("star_icon").addClass("empty_star_icon");jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,
"")).children(".favorite_status").children("a").removeClass("unfav_link");jQuery("#favorite_"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("star_icon").addClass("empty_star_icon");jQuery("#favorite_"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("unfav_link").addClass("fav_link");remove_item_from_favorites_database($(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);
post_feedback("unstar",$(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item removed from favorites</p>");setTimeout("fade_console_message()",1E3)})});
$(".fav_link").live("click",function(a){a.preventDefault();jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("empty_star_icon").addClass("star_icon");jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("fav_link").addClass("unfav_link");
jQuery("#favorite_"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("empty_star_icon").addClass("star_icon");jQuery("#favorite_"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("fav_link").addClass("unfav_link");add_item_to_favorites_database($(this).attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("star",$(this).attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item favorited</p>");
setTimeout("fade_console_message()",1E3)});$(".close_item_preview").live("click",function(a){a.preventDefault();jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})});$(".sidebar_close_link").live("click",function(a){a.preventDefault();jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})});$("#close_all").live("click",function(a){a.preventDefault();jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})});
$(".mark_item_as_unread").live("click",function(a){a.preventDefault();$(this).removeClass("empty_star_icon").addClass("star_icon");$(this).removeClass("unfav_link");$(this).addClass("fav_link");a=jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));if(a.hasClass("read")){a.removeClass("read");a.addClass("unread")}remove_item_from_read_database($(this).attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>marked as unread</p>");setTimeout("fade_console_message()",1E3)});
$("#mark_all_items_as_read").live("click",function(a){a.preventDefault();jQuery.each(jQuery(".unread"),function(c,b){var d=jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));if(d.hasClass("unread")){d.removeClass("unread");d.addClass("read")}mark_item_as_read(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type)})});
$("#mark_seen").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){jQuery(".cursor").removeClass("seen");jQuery(".cursor").addClass("unseen");jQuery(item_to_mark).attr("status",jQuery(item_to_mark).attr("status")+" unseen");jQuery(item_to_mark).attr("status",jQuery(item_to_mark).attr("status").replace(" seen",""));mark_item_as_unseen(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type)}else jQuery.each(jQuery(".selected"),function(c,b){jQuery(b).removeClass("unseen");
jQuery(b).addClass("seen");typeof jQuery(b).attr("status")!=="undefined"&&jQuery(b).attr("status",jQuery(b).attr("status").replace(" unseen",""));jQuery(b).attr("status",jQuery(b).attr("status")+" seen");mark_item_as_seen(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type)})});
$("#mark_unseen").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){jQuery(".cursor").removeClass("seen");jQuery(".cursor").addClass("unseen");jQuery(item_to_mark).attr("status",jQuery(item_to_mark).attr("status")+" seen");jQuery(item_to_mark).attr("status",jQuery(item_to_mark).attr("status").replace(" unseen",""));mark_item_as_unseen(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type)}else jQuery.each(jQuery(".selected"),function(c,b){jQuery(b).removeClass("seen");
jQuery(b).addClass("unseen");var d=jQuery(b).attr("status");typeof d!=="undefined"&&jQuery(b).attr("status",d.replace(" seen",""));jQuery(b).attr("status",jQuery(b).attr("status")+" unseen");mark_item_as_unseen(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type)})});
$("#select_all").live("click",function(a){a.preventDefault();$.each($("#results > li"),function(c,b){if(!jQuery(b).hasClass("selected")){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")}})});
$("#select_none").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){jQuery(".cursor").removeClass("selected");jQuery(".cursor").attr("status",jQuery(item_to_mark).attr("status").replace(" selected",""))}else $.each($(".selected"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
$("#select_inverse").live("click",function(a){a.preventDefault();if(is_in_cursor_mode())if(jQuery(".cursor").hasClass("selected")){jQuery(".cursor").removeClass("selected");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" selected",""))}else{jQuery(".cursor").addClass("selected");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status")+" selected")}else $.each($("#results li"),function(c,b){if(jQuery(b).hasClass("selected")){jQuery(b).removeClass("selected");jQuery(b).attr("status",
jQuery(b).attr("status").replace(" selected",""))}else{jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")}})});$("#select_favorites").live("click",function(a){a.preventDefault();$.each($(".favorited"),function(c,b){if(!jQuery(b).hasClass("selected")){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")}})});
$("#deselect_seen").live("click",function(a){a.preventDefault();$.each($(".seen"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});$("#deselect_unseen").live("click",function(a){a.preventDefault();$.each($(".unseen"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
$("#deselect_favorites").live("click",function(a){a.preventDefault();$.each($(".favorited"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});$("#deselect_read").live("click",function(a){a.preventDefault();$.each($(".read"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
$("#deselect_unread").live("click",function(a){a.preventDefault();$.each($(".unread"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});$("#deselect_archived").live("click",function(a){a.preventDefault();$.each($(".archived"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
$("#deselect_unarchived").live("click",function(a){a.preventDefault();$.each($(".unarchived"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});$("#deselect_unseen").live("click",function(a){a.preventDefault();$.each($(".unseen"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
$("#deselect_unread").live("click",function(a){a.preventDefault();$.each($(".unread"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});$("#deselect_unarchived").live("click",function(a){a.preventDefault();$.each($(".unarchived"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
$("#select_seen").live("click",function(a){a.preventDefault();$.each($(".seen"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});$("#select_unseen").live("click",function(a){a.preventDefault();$.each($(".unseen"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});
$("#select_read").live("click",function(a){a.preventDefault();$.each($(".read"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});$("#select_unread").live("click",function(a){a.preventDefault();$.each($(".unread"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});
$("#select_archived").live("click",function(a){a.preventDefault();$.each($(".archived"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});$("#select_unarchived").live("click",function(a){a.preventDefault();$.each($(".unarchived"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});
$("#delete").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){delete_item(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);if(jQuery(".cursor").next().length>0)jQuery(".cursor").next().addClass("cursor").prev().remove();else{jQuery(".cursor").remove();jQuery("#results li:first").addClass("cursor")}}else $.each($(".selected"),function(c,b){delete_item(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(b).remove()})});
$("#select").live("click",function(a){a.preventDefault();is_in_cursor_mode()?$.each($(".cursor"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")}):$.each($(".selected"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});
$("#deselect").live("click",function(a){a.preventDefault();is_in_cursor_mode()?$.each($(".cursor"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))}):$.each($(".selected"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
$("#archive").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){archive_item(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);if(jQuery(".cursor").next().length>0){jQuery(".cursor").next().addClass("cursor").prev().remove();jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" cursor",""))}else{jQuery(".cursor").remove();jQuery("#results li:first").addClass("cursor");jQuery("#results li:first").attr("status",jQuery(item_to_mark).attr("status").replace(" cursor",
""))}}else $.each($(".selected"),function(c,b){archive_item(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);Buleys.view.page!=="favorites"&&Buleys.view.page!=="archive"&&jQuery(b).remove()})});
$("#read").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){window.open(jQuery(".cursor > a").attr("href"),jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));mark_item_as_read(jQuery(".cursor > a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(".cursor").addClass("read");jQuery(".cursor").removeClass("unread");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status")+" read");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" unread",
""))}else $.each($(".selected"),function(c,b){window.open(jQuery(b).children("a").attr("href"),jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));mark_item_as_read(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(b).addClass("read");jQuery(b).removeClass("unread");jQuery(b).attr("status",jQuery(b).attr("status")+" read");jQuery(b).attr("status",jQuery(b).attr("status").replace(" unread",""))})});
$("#unarchive").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){unarchive_item(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(".cursor").removeClass("archived").addClass(".unarchived");Buleys.view.page=="archive"&&jQuery(".cursor").remove()}else $.each($(".selected"),function(c,b){unarchive_item(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);Buleys.view.page=="archive"&&jQuery(b).remove()})});
$("#mark_read").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){mark_item_as_read(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(".cursor").addClass("read");jQuery(".cursor").removeClass("unread");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status")+" read");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" unread",""))}else $.each($(".selected"),function(c,b){mark_item_as_read(jQuery(b).children("a").attr("href"),
Buleys.view.slug,Buleys.view.type);jQuery(b).addClass("read");jQuery(b).removeClass("unread");jQuery(b).attr("status",jQuery(b).attr("status")+" read");jQuery(b).attr("status",jQuery(b).attr("status").replace(" unread",""))})});
$("#mark_unread").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){remove_item_from_read_database(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(".cursor").addClass("unread");jQuery(".cursor").removeClass("read");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status")+" unread");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" read",""))}else $.each($(".selected"),function(c,b){remove_item_from_read_database(jQuery(b).children("a").attr("href"),
Buleys.view.slug,Buleys.view.type);jQuery(b).addClass("unread");jQuery(b).removeClass("read");jQuery(b).attr("status",jQuery(b).attr("status")+" read");jQuery(b).attr("status",jQuery(b).attr("status").replace(" unread",""))})});
$("#mark_all_items_as_unread").live("click",function(a){a.preventDefault();jQuery.each(jQuery(".read"),function(c,b){var d=jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));if(d.hasClass("read")){d.removeClass("read");d.addClass("unread");jQuery(d).attr("status",jQuery(b).attr("status")+" unread");jQuery(d).attr("status",jQuery(b).attr("status").replace(" read",""))}remove_item_from_read_database(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type)});
jQuery("#logout").live("click",function(){account_logout()});jQuery(".do_logout").live("click",function(){account_logout()});jQuery(".do_logout").live("click",function(){account_logout()});jQuery(".submitthelogin").live("click",function(){});jQuery(".defaulttext").live("click",function(){jQuery(this).val("");jQuery(this).removeClass("defaulttext")})});
$(".delete_category").live("click",function(a){a.preventDefault();a=$(this).attr("link");var c=$(this).attr("type"),b=$(this).attr("slug");$(this).parent().parent().remove();remove_category_for_item(a.replace(/[^a-zA-Z0-9-_]+/g,""),c,b);$(this).hasClass("voted")||post_feedback("delete_category",a,c,b)});
$(".follow_topic").live("click",function(a){a.preventDefault();a=$(this).attr("key");var c=$(this).attr("type");if(typeof a=="undefined")a=slug;if(typeof c=="undefined"||c=="")c=type;add_follow_if_doesnt_exist(c,a);post_feedback("follow","",a,c);$(this).removeClass("empty_heart_icon").addClass("heart_icon");$(this).removeClass("follow_topic");$(this).addClass("unfollow_topic")});
$(".unfollow_topic").live("click",function(a){a.preventDefault();a=$(this).attr("key");var c=$(this).attr("type");if(typeof a=="undefined")a=slug;if(typeof c=="undefined"||c=="")c=type;remove_follow(c,a);post_feedback("unfollow","",a,c);$(this).removeClass("heart_icon").addClass("empty_heart_icon");$(this).removeClass("unfollow_topic");$(this).addClass("follow_topic")});
$(".subscribe_topic").live("click",function(a){a.preventDefault();a=$(this).attr("key");var c=$(this).attr("type");if(typeof a=="undefined")a=slug;if(typeof c=="undefined"||c=="")c=type;add_subscription_if_doesnt_exist(c,a);post_feedback("subscribe","",a,c);$(this).removeClass("empty_inbox_icon").addClass("inbox_icon");$(this).removeClass("subscribe_topic");$(this).addClass("unsubscribe_topic")});
$(".unsubscribe_topic").live("click",function(a){a.preventDefault();a=$(this).attr("key");var c=$(this).attr("type");if(typeof a=="undefined")a=slug;if(typeof c=="undefined"||c=="")c=type;remove_subscription(c,a);post_feedback("subscribe","",a,c);$(this).removeClass("inbox_icon").addClass("empty_inbox_icon");$(this).removeClass("unsubscribe_topic");$(this).addClass("subscribe_topic")});
$(".vote_up_category").live("click",function(a){a.preventDefault();a=$(this).attr("link");var c=$(this).attr("type"),b=$(this).attr("slug"),d="";d=a.replace(/[^a-zA-Z0-9-_]+/g,"")+c.toLowerCase()+b.toLowerCase();add_or_update_vote(d,1);$(this).hasClass("voted")||post_feedback("category_upvote",a,c,b);$(this).addClass("voted")});
$(".vote_down_category").live("click",function(a){a.preventDefault();a=$(this).attr("link");var c=$(this).attr("type"),b=$(this).attr("slug"),d="";d=a.replace(/[^a-zA-Z0-9-_]+/g,"")+c.toLowerCase()+b.toLowerCase();add_or_update_vote(d,-1);$(this).hasClass("voted")||post_feedback("category_downvote",a,c,b);$(this).addClass("voted")});
$(".vote_up").live("click",function(a){a.preventDefault();a=$(this).attr("link").replace(/[^a-zA-Z0-9-_]+/g,"");if(jQuery("#overlay_upvote_"+a).hasClass("vote")){jQuery("#overlay_upvote_"+a).removeClass("thumb_up_icon").addClass("empty_thumb_up_icon");$(".vote").removeClass("vote");$(this).parent().removeClass("voted");post_feedback("item_remove_upvote",a,Buleys.view.type,Buleys.view.slug);remove_vote(a)}else{jQuery("#overlay_downvote_"+a).removeClass("thumb_icon").addClass("empty_thumb_icon");jQuery("#overlay_upvote_"+
a).removeClass("empty_thumb_up_icon").addClass("thumb_up_icon");$(".vote").removeClass("vote");$(this).parent().addClass("voted");$(this).addClass("vote");post_feedback("item_upvote",a,Buleys.view.type,Buleys.view.slug);add_or_update_vote(a,1)}});
$(".vote_down").live("click",function(a){a.preventDefault();a=$(this).attr("link").replace(/[^a-zA-Z0-9-_]+/g,"");var c=a.replace(/[^a-zA-Z0-9-_]+/g,"");if(jQuery("#overlay_downvote_"+c).hasClass("vote")){jQuery("#overlay_downvote_"+c).removeClass("empty_thumb_icon").addClass("thumb_icon");$(".vote").removeClass("vote");$(this).parent().removeClass("voted");post_feedback("item_remove_downvote",a,Buleys.view.type,Buleys.view.slug);remove_vote(a)}else{jQuery("#overlay_downvote_"+c).removeClass("empty_thumb_icon").addClass("thumb_icon");
jQuery("#overlay_upvote_"+c).removeClass("thumb_up_icon").addClass("empty_thumb_up_icon");$(".vote").removeClass("vote");$(this).parent().addClass("voted");$(this).addClass("vote");post_feedback("item_downvote",a,Buleys.view.type,Buleys.view.slug);add_or_update_vote(a,-1)}});jQuery("#console_wrapper").stop(true).animate({opacity:0},0,function(){});jQuery("#overlay").stop(true).animate({opacity:0},0,function(){}).html("");$("#overlay .category").live("mouseenter",function(a){a.preventDefault();add_category_controls(jQuery(this))});
$("#overlay .category").live("mouseleave",function(a){a.preventDefault();jQuery("#overlay .vote_up_category").remove();jQuery("#overlay .vote_down_category").remove();jQuery("#overlay .delete_category").remove()});
$(".headline a").live("click",function(){var a=$(this).attr("href");c={event:"click",item:$(this).attr("href"),page:slug};var c;c={event:"clickthrough",item:$(this).attr("href"),context:Buleys.view.slug,type:Buleys.view.type};$.post("/feedback/index.php",c,dataType="json",function(){new_window=window.open(a,click_window)})});
$(".sidebar_headline a").live("click",function(){var a=$(this).attr("href"),c;c={event:"click",item:$(this).attr("href"),context:Buleys.view.slug,type:Buleys.view.type};$.post("/feedback/index.php",c,dataType="json",function(){new_window=window.open(a,click_window)})});
jQuery("#results li").live("mouseenter",function(){var a=jQuery(this);if(a.hasClass("unseen")){a.removeClass("unseen");a.addClass("seen")}url_to_preview=a.children("a").attr("href");mark_item_as_seen(url_to_preview,Buleys.view.slug,Buleys.view.type)});
jQuery("#preview_item").live("click",function(a){a.preventDefault();if(!is_in_cursor_mode()&&$(".selected").length>0)$.each($(".selected"),function(c,b){var d=jQuery(b);if(d.hasClass("unseen")){d.removeClass("unseen");d.addClass("seen")}url_to_preview=d.children("a").attr("href");mark_item_as_seen(url_to_preview,Buleys.view.slug,Buleys.view.type);load_item_to_overlay(url_to_preview);jQuery("#overlay").stop(true).animate({opacity:1},100,function(){})});else if($(".selected").length>0){a=jQuery(".cursor");
if(a.hasClass("unseen")){a.removeClass("unseen");a.addClass("seen")}url_to_preview=a.children("a").attr("href");mark_item_as_seen(url_to_preview,Buleys.view.slug,Buleys.view.type);load_item_to_overlay(url_to_preview);jQuery("#overlay").stop(true).animate({opacity:1},100,function(){})}});
$("#close_item_preview").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){a=jQuery(".cursor");if(a.hasClass("unseen")){a.removeClass("unseen");a.addClass("seen")}url_to_preview=a.children("a").attr("href");a="#overlay_"+url_to_preview.replace(/[^a-zA-Z0-9-_]+/g,"");jQuery(a).length>0&&jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})}else $(".selected").length>0?$.each($(".selected"),function(c,b){var d=jQuery(b),e=d.children("a").attr("href");
if(d.hasClass("unread")){d.removeClass("unread");d.addClass("read")}d="#overlay_"+e.replace(/[^a-zA-Z0-9-_]+/g,"");if(jQuery(d).length>0){d=jQuery(b);if(d.hasClass("unseen")){d.removeClass("unseen");d.addClass("seen")}e=d.children("a").attr("href");jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})}}):jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})});
jQuery("#results li").live("click",function(){var a=jQuery(this),c=a.children("a").attr("href");if(a.hasClass("unread")){a.removeClass("unread");a.addClass("read")}var b="#overlay_"+c.replace(/[^a-zA-Z0-9-_]+/g,"");if(jQuery(b).length>0&&jQuery(a).hasClass("selected"))jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")});else if(!jQuery(a).hasClass("selected")){jQuery("#overlay").stop(true).animate({opacity:1},100,function(){});load_item_to_overlay(c)}a.addClass("selected")});
$(".selected").live("click",function(){$(this).removeClass("selected")});$("#results li").live("mouseleave",function(){});$("#show_button").live("click",function(){send_notification_to_desktop()});
function createNotificationInstance(a){if(a.notificationType=="simple")return window.webkitNotifications.createNotification("fire.png","Notification Title","Notification content...");else if(a.notificationType=="html")return window.webkitNotifications.createHTMLNotification("http://someurl.com")}
function send_notification_to_desktop(){if(window.webkitNotifications.checkPermission()==0){notification_test=createNotificationInstance({notificationType:"html"});notification_test.ondisplay=function(){};notification_test.onclose=function(){};notification_test.show()}else window.webkitNotifications.requestPermission()}
function notify_user_of_new_items(a,b,c){if(Buleys.view.type===b&&c===Buleys.view.slug||Buleys.view.type=="home"||typeof Buleys.view.type==="undefined")flash_console("<p>"+a+" new items added to "+b+" "+c+" </p>")}
function do_pending_crawl(){var a=Buleys.queues.pending_crawls.splice(0,1),b=a[0].split("_",1),c=b[0],d=a[0].replace(b[0]+"_","");$.ajax({url:"http://static.buleys.com/js/collections/"+c+"/"+d+".js",dataType:"jsonp",jsonpCallback:"load_collection",error:function(){$("#index").html("<li class='item'>No results.</li>")},success:function(e){add_items(e.items,c,d)}})}function check_for_waiting_items(){notify_user_of_new_items(Buleys.queues.new_items,type_to_get,company_to_get)};
function send_text_to_overlay(a){jQuery("#overlay").html("").append(a)}function send_to_overlay(a){send_text_to_overlay(a);jQuery("#overlay").stop(true).animate({opacity:1},500)}function load_item_to_overlay(a){get_item_for_overlay(a);check_if_item_is_favorited_for_overlay(a);check_item_vote_status_for_overlay(a)};
function save_queues(){add_or_update_queue("new_items",Buleys.queues.new_items);add_or_update_queue("pending_crawls",Buleys.queues.pending_crawls)}function get_queues(){try{new_queue_transaction();Buleys.index=Buleys.objectStore.index("queue_name");var a=Buleys.index.getAll();a.onsuccess=function(){var b=a.result;b&&b.length>=0&&jQuery.each(b,function(){})};request.onerror=function(){}}catch(c){}}
function remove_queue(a){new_queue_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}function load_all_queues_into_dom(){new_queue_transaction();var a=Buleys.objectStore.getAll();a.onsuccess=function(){typeof a.result!=="undefined"&&a.result.length>=0&&jQuery.each(a.result,function(c,b){Buleys.queues[b.queue_name]=b.queue_value})};a.onerror=function(){}}
function add_or_update_queue(a,c){new_queue_transaction();if(typeof c=="undefined")c="";var b=Buleys.objectStore.get(a);b.onsuccess=function(){typeof b.result=="undefined"?add_queue_to_queues_database(a,c):update_queue_in_queues_database(a,c)};b.onerror=function(){}}function add_queue_to_queues_database(a,c){new_queue_transaction();var b={queue_name:a,queue_value:c,modified:(new Date).getTime()},d=Buleys.objectStore.add(b);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}
function update_queue_in_queues_database(a,c){new_queue_transaction();var b={queue_name:a,queue_value:c,modified:(new Date).getTime()},d=Buleys.objectStore.put(b);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}
function new_queue_transaction(){try{var a=Buleys.db.transaction(["queue"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("queue")}catch(c){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("queue",{keyPath:"queue_name"},true);Buleys.objectStore.createIndex("queue_value","queue_value",{unique:false})};a.onerror=function(){}}};
function get_read(a,c,d,b,e){if(typeof e=="undefined")e=false;typeof d=="undefined"||d==null||parseInt(d);typeof b=="undefined"||b==null?(new Date).getTime():parseInt(b);new_categories_transaction();Buleys.index=Buleys.objectStore.index("slug");var i=Buleys.index.getAll(c);i.onsuccess=function(){var f=i.result;if(f)f.length>1?jQuery.each(f,function(j,g){new_status_transaction();var h=Buleys.objectStore.get(g.link);h.onsuccess=function(){if(typeof h.result!=="undefined"&&e!==true)jQuery("#"+g.link.replace(/[^a-zA-Z0-9-_]+/g,
"")).length<=0&&get_item_raw(h.result.link);else typeof h.result=="undefined"&&e==true&&jQuery("#"+g.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw(g.link)}}):get_item(f.link)};i.onerror=function(){}}function mark_item_as_read(a,c,d){new_status_transaction();a={link:a,topic_slug:c,topic_type:d,modified:(new Date).getTime()};var b=Buleys.objectStore.add(a);b.onsuccess=function(){Buleys.objectId=b.result};b.onerror=function(){}}
function new_status_transaction(){try{var a=Buleys.db.transaction(["status"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("status")}catch(c){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("status",{keyPath:"link"},true);Buleys.objectStore.createIndex("topic_slug","topic_slug",{unique:false});Buleys.objectStore.createIndex("topic_type","topic_type",{unique:false});
Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}function remove_item_from_read_database(a){new_status_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
function add_item_to_readstatus_database(a,c){if(typeof c=="undefined")c="unread";new_status_transaction();var d={link:a.link,status:c,modified:(new Date).getTime()},b=Buleys.objectStore.add(d);b.onsuccess=function(){Buleys.objectId=b.result};b.onerror=function(){}};
function new_seen_transaction(){try{var a=Buleys.db.transaction(["seen"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("seen")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("seen",{keyPath:"link"},true);Buleys.objectStore.createIndex("topic_slug","topic_slug",{unique:false});Buleys.objectStore.createIndex("topic_type","topic_type",{unique:false});
Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function get_seen(a,b,d,c,e){if(typeof e=="undefined")e=false;typeof d=="undefined"||d==null||parseInt(d);typeof c=="undefined"||c==null?(new Date).getTime():parseInt(c);new_categories_transaction();Buleys.index=Buleys.objectStore.index("slug");var i=Buleys.index.getAll(b);i.onsuccess=function(){var f=i.result;if(f)f.length>1?jQuery.each(f,function(j,g){new_seen_transaction();var h=Buleys.objectStore.get(g.link);h.onsuccess=function(){if(typeof h.result!=="undefined"&&e!==true)jQuery("#"+g.link.replace(/[^a-zA-Z0-9-_]+/g,
"")).length<=0&&get_item(h.result.link);else typeof h.result=="undefined"&&e==true&&jQuery("#"+g.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item(g.link)}}):get_item(f.link)};i.onerror=function(){}}function mark_item_as_seen(a,b,d){new_seen_transaction();a={link:a,topic_slug:b,topic_type:d,modified:(new Date).getTime()};var c=Buleys.objectStore.add(a);c.onsuccess=function(){Buleys.objectId=c.result};c.onerror=function(){}}
function mark_item_as_unseen(a){new_seen_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}function add_item_as_seen(a){new_seen_transaction();a={link:a,modified:(new Date).getTime()};var b=Buleys.objectStore.add(a);b.onsuccess=function(){Buleys.objectId=b.result};b.onerror=function(){}}
function check_if_item_is_seen(a){new_seen_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){checker=b;typeof b.result!="undefined"?jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("seen"):jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("unseen")};b.onerror=function(){}}
function add_item_to_seens_database(a,b,d){new_seen_transaction();a={item_link:a,topic_slug:b,topic_type:d,modified:(new Date).getTime()};var c=Buleys.objectStore.add(a);c.onsuccess=function(){Buleys.objectId=c.result};c.onerror=function(){}}function remove_item_from_seens_database(a){new_seen_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}};
function new_settings_transaction(){try{var a=Buleys.db.transaction(["settings"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("settings")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("settings",{keyPath:"option_name"},true);Buleys.objectStore.createIndex("option_value","option_value",{unique:false})};a.onerror=function(){}}}
function get_settings(){console.log("get_settings(): ");Buleys.view.loaded="account";get_settings();var a=get_local_storage("session_id");typeof a=="undefined"||a==null||a==""?jQuery("#main").append('<div id="account"><input id="password"  class="defaulttext" type="password" value="p4s5w0rd" name="password" /><br/><br/><a href="#" id="update_settings_button" class="update_settings">Update</a> or <a href="#" id="clear_form_button" class="clear_form">Clear</a></div></div></div>'):jQuery("#main").append("<div id='account'>Already logged in with session id <code>"+
a+"</code>.<br/><br/><a href='#' class='do_logout'>Click here</a> to log out.</div>");Buleys.view.loaded="signin"}function get_settings_old(){try{new_settings_transaction();Buleys.index=Buleys.objectStore.index("option_name");var a=Buleys.index.getAll();a.onsuccess=function(){var c=a.result;if(c)if(c.length>=0){Buleys.view.type="settings";jQuery.each(c,function(d,e){console.log("get_settings(): "+e)})}};request.onerror=function(){}}catch(b){}}
function save_settings(){add_or_update_setting("profile",Buleys.profile)}function load_settings_into_dom(){new_settings_transaction();Buleys.index=Buleys.objectStore.index();var a=Buleys.objectStore.getAll();a.onsuccess=function(){new_settings_transaction();var b=a.result;b&&b.length>=0&&jQuery.each(b,function(c,d){Buleys.settings[c]=d})};request.onerror=function(){}}
function remove_setting(a){new_settings_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}function load_all_settings_into_dom(){new_settings_transaction();var a=Buleys.objectStore.getAll();a.onsuccess=function(){typeof a.result!=="undefined"&&a.result.length>=0&&jQuery.each(a.result,function(b,c){Buleys.settings[c.option_name]=c.option_value})};a.onerror=function(){}}
function add_or_update_setting(a,b){new_settings_transaction();if(typeof b=="undefined")b="";var c=Buleys.objectStore.get(a);c.onsuccess=function(){typeof c.result=="undefined"?add_setting_to_settings_database(a,b):update_setting_in_settings_database(a,b)};c.onerror=function(){}}
function add_setting_to_settings_database(a,b){new_settings_transaction();var c={option_name:a,option_value:b,modified:(new Date).getTime()},d=Buleys.objectStore.add(c);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}function update_setting_in_settings_database(a,b){new_settings_transaction();var c={option_name:a,option_value:b,modified:(new Date).getTime()},d=Buleys.objectStore.put(c);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}
function get_settings_page(){console.log("get_settings_page()");jQuery("#main").append("<div od='login_prompt'>Logged in with session id <code>"+get_local_storage("session_id")+"</code>.<br/><br/><a href='#' class='do_logout'>Click here</a> to log out.</div>")}function get_setting_type(a){return get_local_storage("setting_type_"+a)}function set_setting_type(a,b){return set_local_storage("setting_type_"+a,b)}function get_setting(a){return get_local_storage("setting_type_"+a)}
function set_setting(a,b){return set_local_storage("setting_type_"+a,b)};
function new_social_transaction(){try{var a=Buleys.db.transaction(["social"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("social")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("social",{keyPath:"link"},true);Buleys.objectStore.createIndex("source","source",{unique:false});Buleys.objectStore.createIndex("type","type",{unique:false});Buleys.objectStore.createIndex("modified",
"modified",{unique:false})};a.onerror=function(){}}};
function set_local_storage(a,b){return Buleys.store.setItem(a,b)}function get_local_storage(a){return Buleys.store.getItem(a)}function open_database(){var a=window.indexedDB.open("Buleys-317");a.onsuccess=function(){console.log("!!!",a.result);database_is_open(a.result)};a.onerror=function(){}}function database_is_open(a){Buleys.db=a;console.log("open!",Buleys.db,Buleys.session.database_is_open);Buleys.session.database_is_open=true;load_current_page()};
function getURLSlug(b){if(typeof b!="object")if(b!=null&&b!="undefined"&&b!=""){var a="";b.toLowerCase();a=b.replace(/ - /g,"_");a=a.replace(/ /g,"_");a=a.replace(/\'s/g,"");a=a.replace(/ - /g,"_");a=a.replace(/-/g,"_");a=a.replace("/%20/g","_");a=a.replace(/&/,"and");a=a.replace("/%26/g","and");return a=a.replace(".","")}};
function new_subscriptions_transaction(){try{var a=Buleys.db.transaction(["subscriptions"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("subscriptions")}catch(c){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("subscriptions",{keyPath:"key"},true);Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function add_subscription_to_subscriptions_database(a,c){new_subscriptions_transaction();var b={key:a+"_"+c,modified:(new Date).getTime()},d=Buleys.objectStore.add(b);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}
function get_page_subscription_status(a,c){new_subscriptions_transaction();var b=Buleys.objectStore.get(a+"_"+c);b.onsuccess=function(){typeof b.result=="undefined"||b.result==""?jQuery("#page_meta").append("<a href='#' class='subscribe_topic empty_mail_icon'></a>"):jQuery("#page_meta").append("<a href='#' class='unsubscribe_topic mail_icon'></a>")};b.onerror=function(){}}
function remove_subscription(a,c){new_subscriptions_transaction();var b=Buleys.objectStore["delete"](a+"_"+c);b.onsuccess=function(){delete Buleys.objectId};b.onerror=function(){}}function add_subscription_if_doesnt_exist(a,c){if(typeof a!=="undefined"&&typeof c!=="undefined"){new_subscriptions_transaction();var b=Buleys.objectStore.get(a+"_"+c);b.onsuccess=function(){typeof b.result=="undefined"&&add_subscription_to_subscriptions_database(a,c)};b.onerror=function(){}}}
function get_subscriptions(){new_subscriptions_transaction();try{new_categories_transaction();Buleys.index=Buleys.objectStore.index("id");var a=Buleys.index.getAll();a.onsuccess=function(){var b=a.result;b&&b.length>=0&&jQuery.each(b,function(){})};request.onerror=function(){}}catch(c){}};
function load_page_title_info(a){typeof a.name!="undefined"&&jQuery("a .topic_name").length>0&&!jQuery("#page_meta").indexOf("<a href='/"+a.type+"/"+a.key+"' class='topic_name'>"+a.name+"</a>")&&jQuery("#page_meta").append("<a href='/"+a.type+"/"+a.key+"' class='topic_name'>"+a.name+"</a>");typeof a.subsector!="undefined"&&jQuery("a .sector_name").length>0&&!jQuery("#page_meta").indexOf("<a href='/sector/"+getURLSlug(a.subsector).toLowerCase()+"' class='sector_name'>"+a.subsector+"</a>")&&jQuery("#page_meta").append("<a href='/sector/"+
getURLSlug(a.subsector).toLowerCase()+"' class='sector_name'>"+a.subsector+"</a>");typeof a.sector!="undefined"&&jQuery("a .subsector_name").length>0&&!jQuery("#page_meta").indexOf("<a href='/sector/"+getURLSlug(a.sector).toLowerCase()+"' class='subsector_name'>"+a.sector+"</a>")&&jQuery("#page_meta").append("<a href='/sector/"+getURLSlug(a.sector).toLowerCase()+"' class='subsector_name'>"+a.sector+"</a>")}function show_loading(){$("#index").html("<div class='loading'>&nbsp;</div>")}
function hide_loading(){$("#index .loading").hide()}
function load_profile_info(){$.post("/feedback/index.php",{method:"get_user_attributes"},function(a){jQuery("#small_profile").show();if(typeof a.display_name!="undefined"&&a.display_name!=null){jQuery("#small_profile").append("<div id='small_profile_image'><a href='/profile/'><img src='http://www.gravatar.com/avatar/"+a.email_hash+"?s=42'></a></div><div><div id='small_profile_display_name'><a href='/profile/'>"+a.display_name+"</a></div></div>");jQuery.each(a,function(b,c){add_or_update_setting(b,
c)})}},dataType="json")}function clear_page(){jQuery("#right").html("<ul id='results'></ul>");jQuery("#main").html("")}
function load_current_page(){Buleys.view.type=="account"&&load_profile_info();if(Buleys.view.type!=="account"&&Buleys.view.type!=="home"&&Buleys.view.type!=="signin"&&Buleys.view.type!==""&&Buleys.view.type!=="start"&&Buleys.view.type!=="settings"&&Buleys.view.type!=="favorites"&&Buleys.view.type!=="read"&&Buleys.view.type!=="unread"&&Buleys.view.type!=="seen"&&Buleys.view.type!=="unseen"&&Buleys.view.type!=="unarchived"&&Buleys.view.type!=="archived"){get_page_follow_status(Buleys.view.type,Buleys.view.slug);
get_page_subscription_status(Buleys.view.type,Buleys.view.slug);get_page_topic_info(Buleys.view.type,Buleys.view.slug)}if(Buleys.view.type=="settings"||Buleys.view.type=="account")get_settings_page();else if(Buleys.view.type=="signin"||"signin"==Buleys.view.type||"start"==Buleys.view.type)Buleys.view.loaded!="signin"&&get_signin();else if(Buleys.view.type=="register")get_registration();else if(Buleys.view.type=="confirm")get_confirmation();else if(Buleys.view.type=="favorites"||Buleys.view.page==
"favorites"||Buleys.view.page=="favs")get_favorites(Buleys.view.type,Buleys.view.slug);else if(Buleys.view.type=="archive"||Buleys.view.page=="archive"||Buleys.view.page=="archived")get_archived(Buleys.view.type,Buleys.view.slug);else if(Buleys.view.type=="trash"||Buleys.view.page=="trash"||Buleys.view.page=="trashed"||Buleys.view.page=="deleted")get_deleted(Buleys.view.type,Buleys.view.slug);else if(Buleys.view.type=="read"||Buleys.view.page=="read")get_read(Buleys.view.type,Buleys.view.slug,null,
null,false);else if(Buleys.view.type=="unread"||Buleys.view.page=="unread")get_read(Buleys.view.type,Buleys.view.slug,null,null,true);else if(Buleys.view.type=="seen"||Buleys.view.page=="seen")get_seen(Buleys.view.type,Buleys.view.slug,null,null,false);else Buleys.view.type=="unseen"||Buleys.view.page=="unseen"?get_seen(Buleys.view.type,Buleys.view.slug,null,null,true):get_items(Buleys.view.type,Buleys.view.slug);Buleys.view.loaded=Buleys.view.type}
function reload_results(){clear_page();load_current_page()}function set_page_vars(){console.log("Setting page vars: ",location.pathname);var a=location.pathname;a=a.replace(/^\//,"");a=a.replace(/\/$/,"");a=a.split("/");Buleys.view.type=a[0];Buleys.view.slug=a[1];Buleys.view.page=a[2]};
function minutes_ago(a){a=Date.parse(a);return((new Date).getTime()-a)/1E3/60};
function parse_single_topic(b){b.split("_");Buleys.queues.pending_crawls.slice(0,1);Buleys.queues.pending_crawls.push(b)}
function update_topic_in_topics_database(b,c){new_topics_transaction();c.topic_key=b;c.modified=new Date;if(typeof c.last_updated!="undefined")c.last_updated=new Date(parseInt(c.last_updated)*1E3);if(typeof c.updated!="undefined")c.updated=new Date(parseInt(c.updated)*1E3);if(typeof c.last_attempt!="undefined")c.last_attempt=new Date(parseInt(c.last_attempt)*1E3);var a=Buleys.objectStore.put(c);a.onsuccess=function(){Buleys.objectId=a.result};a.onerror=function(){}}
function get_page_topic_info(b,c){new_topics_transaction();var a=Buleys.objectStore.get(b+"_"+c);a.onsuccess=function(){if(!(typeof a.result=="undefined"||a.result=="")){if(typeof a.result.name!="undefined"){jQuery("#page_meta").append("<a href='/"+a.result.type+"/"+a.result.key+"' class='topic_name'>"+a.result.name+"</a>");window.document.title=window.document.title.replace(/[|\s]*?Buley's/,"");window.document.title=window.document.title+a.result.name+" | Buley's"}typeof a.result.subsector!="undefined"&&
jQuery("#page_meta").append("<a href='/sector/"+getURLSlug(a.result.subsector).toLowerCase()+"' class='sector_name'>"+a.result.subsector+"</a>");typeof a.result.sector!="undefined"&&jQuery("#page_meta").append("<a href='/sector/"+getURLSlug(a.result.sector).toLowerCase()+"' class='subsector_name'>"+a.result.sector+"</a>")}};a.onerror=function(){}}
function get_topics(){try{new_topics_transaction();Buleys.index=Buleys.objectStore.index("topic_key");var b=Buleys.index.getAll();b.onsuccess=function(){var a=b.result;a&&a.length>=0&&jQuery.each(a,function(){})};request.onerror=function(){}}catch(c){}}function remove_topic(b){new_topics_transaction();b=Buleys.objectStore["delete"](b);b.onsuccess=function(){delete Buleys.objectId};b.onerror=function(){}}
function add_or_update_topic(b,c){new_topics_transaction();if(typeof c=="undefined")c={};var a=Buleys.objectStore.get(b);a.onsuccess=function(){typeof a.result=="undefined"?add_topic_to_topics_database(b,c):update_topic_in_topics_database(b,c)};a.onerror=function(){}}
function add_topic_to_topics_database(b,c){new_topics_transaction();if(typeof c=="undefined")c={};c.topic_key=b;c.modified=new Date;var a=Buleys.objectStore.add(c);a.onsuccess=function(){Buleys.objectId=a.result};a.onerror=function(){}}
function new_topics_transaction(){try{var b=Buleys.db.transaction(["topic"],1,1E3);b.oncomplete=function(){delete Buleys.objectStore};b.onabort=function(){};Buleys.objectStore=b.objectStore("topic")}catch(c){b=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);b.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("topic",{keyPath:"topic_key"},true);Buleys.objectStore.createIndex("slug","slug",{unique:false});Buleys.objectStore.createIndex("type","type",{unique:false});Buleys.objectStore.createIndex("last_updated",
"last_updated",{unique:false})};b.onerror=function(){}}};
function new_deleted_transaction(){try{var a=Buleys.db.transaction(["deleted"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("deleted")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("deleted",{keyPath:"link"},true);Buleys.objectStore.createIndex("topic_slug","topic_slug",{unique:false});Buleys.objectStore.createIndex("topic_type","topic_type",{unique:false});
Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function get_deleted(a,b,c,d,e){if(typeof e=="undefined")e=false;typeof c=="undefined"||c==null||parseInt(c);typeof d=="undefined"||d==null?(new Date).getTime():parseInt(d);new_categories_transaction();Buleys.index=Buleys.objectStore.index("slug");var j=Buleys.index.getAll(b);j.onsuccess=function(){var g=j.result;if(g)g.length>1?jQuery.each(g,function(k,h){new_deleted_transaction();var i=Buleys.objectStore.get(h.link);i.onsuccess=function(){if(typeof i.result!=="undefined"&&e!==true){new_item_transaction();
var f=Buleys.objectStore.get(i.result.link);f.onsuccess=function(){typeof f.result!=="undefined"&&e!==true&&jQuery("#"+h.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw_no_trash(f.result.link)}}else if(typeof i.result=="undefined"&&e==true){new_item_transaction();f=Buleys.objectStore.get(h.link);f.onsuccess=function(){typeof f.result!=="undefined"&&typeof f.result!=="undefined"&&jQuery("#"+h.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw(f.result.link)}}}}):get_item(g.link)};
j.onerror=function(){}}function mark_item_as_deleted(a,b,c){new_deleted_transaction();a={link:a,topic_slug:b,topic_type:c,modified:(new Date).getTime()};var d=Buleys.objectStore.add(a);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}function mark_item_as_undeleted(a){new_deleted_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
function delete_item(a,b,c){new_deleted_transaction();var d={link:a,modified:(new Date).getTime()},e=Buleys.objectStore.add(d);e.onsuccess=function(){Buleys.objectId=e.result};e.onerror=function(){};remove_item_from_favorites_database(a,b,c);remove_item_from_categories_database(a,b,c);remove_item_from_archives_database(a,b,c);remove_item_from_seens_database(a,b,c);remove_item_from_read_database(a,b,c)}
function check_if_item_is_deleted(a){new_deleted_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){checker=b;if(typeof b.result!="undefined"){jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).prepend("<span class='delete_status'><a href='"+a+"' class='fav_link star_icon'></a></span>");jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("deleted")}else jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).prepend("<span class='delete_status'><a href='"+a+"' class='unfav_link empty_star_icon'></a></span>")};
b.onerror=function(){}}function add_item_to_deletes_database(a,b,c){new_deleted_transaction();a={item_link:a,topic_slug:b,topic_type:c,modified:(new Date).getTime()};var d=Buleys.objectStore.add(a);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}function remove_item_from_deletes_database(a){new_deleted_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}};
jQuery("body").bind("dologin",function(a){a.preventDefault();$("#dologin").remove();$("#login_status_pane").append('<div id="minimize_login_controls"><a href="#" id="dologinboxminimize" class="loginboxminimizelink"><img src="http://buleys.com/images/icons/fugue-shadowless/door-open-in.png"></a></div><div id="login_form"><a href="#" id="doregistration" class="registrationlink">Register</a> or Login:<br/><input id="email" type="text" value="your@email.here" name="email" class="defaulttext" /><br/><input id="password"  class="defaulttext" type="password" value="p4s5w0rd" name="password" /></div><div id="login_buttons"><a href="#" id="doresetpassword" class="resetpasswordlink">Reset Password</a><br/><a href="#" id="dologinsubmit" class="submitloginform">Login</a></div></div>')});
jQuery("body").bind("a#get_inbox",function(a){a.preventDefault();$("#mini_inbox_box").html('<div id="mini_inbox_wrapper"><div id="minimize_mini_inbox_controls"><a href="#" id="minimize_inbox"><img src="/images/icons/fugue-shadowless/cross-button.png"></a></div><ul id="mini_inbox_list"><li>Loading...</li></ul></div>');add_topics_to_mini_inbox()});
jQuery("body").bind("minimize_inbox",function(a){a.preventDefault();$("#mini_inbox_box").hasClass("waiting_inbox")?$("#mini_inbox_box").html('<a href="#" id="get_inbox"><img src="http://buleys.com/images/icons/fugue-shadowless/inbox-document.png"></a>'):$("#mini_inbox_box").html('<a href="#" id="get_inbox"><img src="http://buleys.com/images/icons/fugue-shadowless/inbox.png"></a>')});jQuery("body").bind("dologinboxminimize",function(a){a.preventDefault();$("#login_status_pane").html('<a href="#" id="dologin" class="getloginform"><img src="http://buleys.com/images/icons/fugue-shadowless/door-open-out.png"></a>')});
jQuery("body").bind("show_commands",function(a){a.preventDefault();$("#result_controls").show()});jQuery("body").bind("hide_commands",function(a){a.preventDefault();$("#result_controls").hide()});
$("html").live("keyup",function(a){if(a.keyCode==68)Buleys.shortcuts.d_depressed=false;else if(a.keyCode==83)Buleys.shortcuts.s_depressed=false;else if(a.keyCode==16)Buleys.shortcuts.shift_depressed=false;else if(a.keyCode==72)Buleys.shortcuts.s_depressed||Buleys.shortcuts.d_depressed||(Buleys.shortcuts.shift_depressed?$("#view_index").click():$("#close_item_preview").click());else if(a.keyCode==76){if(!Buleys.shortcuts.s_depressed)if(!Buleys.shortcuts.d_depressed)if(Buleys.shortcuts.shift_depressed)$("#view_home").click();
else{$("#preview_item").click();jQuery(".cursor")}}else if(a.keyCode==78){$("#preview_item").click();jQuery(".selected").length>0?jQuery("#results li.selected:first").addClass("cursor"):jQuery("#results li:first").addClass("cursor")}else if(a.keyCode==74)if(jQuery(".cursor").next().length>0)jQuery(".cursor").removeClass("cursor").next().addClass("cursor");else{jQuery(".cursor").removeClass("cursor");jQuery("#results li:first").addClass("cursor")}else if(a.keyCode==75)if(jQuery(".cursor").prev().length>
0)jQuery(".cursor").removeClass("cursor").prev().addClass("cursor");else{jQuery(".cursor").removeClass("cursor");jQuery("#results li:last").addClass("cursor")}else if(a.keyCode==27){jQuery(".cursor").removeClass("cursor");$("#close_all").click()}else if(a.keyCode==77)jQuery(".cursor").removeClass("cursor");else if(a.keyCode==219)$("#preview_item").click();else if(a.keyCode==221)$("#close_item_preview").click();else if(a.keyCode==89)$("#show_commands").click();else if(a.keyCode==85)$("#hide_commands").click();
else if(a.keyCode==65)if(Buleys.shortcuts.s_depressed)$("#select_all").click();else Buleys.shortcuts.d_depressed&&$("#select_none").click();else if(a.keyCode==82)if(Buleys.shortcuts.s_depressed)$("#select_unread").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_unread").click();else Buleys.shortcuts.shift_depressed?$("#view_unread").click():$("#mark_unread").click();else if(a.keyCode!=13)if(a.keyCode==73)$("#select").click();else if(a.keyCode==79)$("#deselect").click();else if(a.keyCode==
69)if(Buleys.shortcuts.s_depressed)$("#select_read").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_read").click();else Buleys.shortcuts.shift_depressed?$("#view_read").click():$("#mark_read").click();else if(a.keyCode==88)if(Buleys.shortcuts.s_depressed)$("#select_none").click();else Buleys.shortcuts.d_depressed||(Buleys.shortcuts.shift_depressed?$("#view_trash").click():$("#delete").click());else if(a.keyCode==67)if(Buleys.shortcuts.s_depressed)$("#select_archived").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_archived").click();
else Buleys.shortcuts.shift_depressed?$("#view_archive").click():$("#archive").click();else if(a.keyCode==86)if(Buleys.shortcuts.s_depressed)$("#select_unarchived").click();else Buleys.shortcuts.d_depressed?$("#deselect_unarchived").click():$("#unarchive").click();else if(a.keyCode==70)if(Buleys.shortcuts.s_depressed)$("#select_favorites").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_favorites").click();else Buleys.shortcuts.shift_depressed?$("#view_favorites").click():$("#favorite").click();
else if(a.keyCode==71)if(Buleys.shortcuts.s_depressed)$("#select_unfavorite").click();else Buleys.shortcuts.d_depressed?$("#deselect_unfavorite").click():$("#unfavorite").click();else if(a.keyCode==81)if(Buleys.shortcuts.s_depressed)$("#select_seen").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_seen").click();else Buleys.shortcuts.shift_depressed?$("#view_seen").click():$("#mark_seen").click();else if(a.keyCode==87)if(Buleys.shortcuts.s_depressed)$("#select_unseen").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_unseen").click();
else Buleys.shortcuts.shift_depressed?$("#view_unseen").click():$("#mark_unseen").click();else if(a.keyCode==90)if(Buleys.shortcuts.s_depressed)$("#select_inverse").click();else Buleys.shortcuts.d_depressed||(Buleys.shortcuts.shift_depressed?$("#view_index").click():$("#refresh").click());else if(a.keyCode==73)$("#deselect").click();else a.keyCode==79&&$("#select").click()});
$("html").live("keydown",function(a){if(a.keyCode==68)Buleys.shortcuts.d_depressed=true;else if(a.keyCode==83)Buleys.shortcuts.s_depressed=true;else if(a.keyCode==16)Buleys.shortcuts.shift_depressed=true});$(window).bind("popstate",function(){console.log(location.pathname);if(Buleys.session.database_is_open){reload_results();Buleys.session.database_is_open=true}});
jQuery("body").bind("get_settings",function(a){a.preventDefault();console.log(location.pathname);console.log("view_settings clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};console.log(history);history.pushState(a,"settings","http://buleys.com/settings");reload_results()});
jQuery("body").bind("get_login",function(a){a.preventDefault();console.log(location.pathname);console.log("get_login clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};history.pushState(a,"login","http://buleys.com/start");reload_results()});
jQuery("body").bind("view_seen",function(a){a.preventDefault();console.log(location.pathname);console.log("view_seen clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_seen",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/seen":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/seen":"http://buleys.com/seen");reload_results()});
jQuery("body").bind("view_unseen",function(a){a.preventDefault();console.log(location.pathname);console.log("view_unseen clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_unseen",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/unseen":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/unseen":"http://buleys.com/unseen");reload_results()});
jQuery("body").bind("view_read",function(a){a.preventDefault();console.log(location.pathname);console.log("view_read clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_read",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/read":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/read":"http://buleys.com/read");reload_results()});
jQuery("body").bind("view_unread",function(a){a.preventDefault();console.log(location.pathname);console.log("view_unread clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_unread",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/unread":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/unread":"http://buleys.com/unread");reload_results()});
jQuery("body").bind("view_trash",function(a){a.preventDefault();console.log(location.pathname);console.log("view_trash clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_trash",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/trash":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/trash":"http://buleys.com/trash");reload_results()});
jQuery("body").bind("view_archive",function(a){a.preventDefault();console.log(location.pathname);console.log("view_archive clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_archive",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/archive":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/archive":"http://buleys.com/archive");reload_results()});
jQuery("body").bind("view_favorites",function(a){a.preventDefault();console.log(location.pathname);console.log("view_favorites clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";history.pushState(a,"view_favorites",typeof page!="undefined"&&page!=""?"http://buleys.com/"+type+"/"+slug+"/favorites":typeof slug!="undefined"&&slug!=""?"http://buleys.com/"+type+"/"+slug+"/favorites":"http://buleys.com/favorites");reload_results()});
jQuery("body").bind("view_index",function(a){a.preventDefault();console.log(location.pathname);console.log("view_index clicked");jQuery("#page_meta").html("");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};history.pushState(a,"view_index","http://buleys.com/");reload_results()});
jQuery("body").bind("view_home",function(a){a.preventDefault();console.log(location.pathname);console.log("view_home clicked");jQuery("#page_meta").html("");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";if(typeof slug!="undefined"&&slug!="")c="http://buleys.com/"+type+"/"+slug+"/";else if(typeof type!="undefined"&&type!="")c="http://buleys.com/"+type+"/";history.pushState(a,"view_home",c);reload_results()});
jQuery("body").bind("dologinsubmit",function(a){a.preventDefault();$('[name="password"]').val()&&request_login($('[name="email"]').val(),$('[name="password"]').val())});
jQuery("body").bind("unfav_link",function(a){a.preventDefault();jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/star-empty.png");jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("unfav_link").addClass("fav_link");
jQuery("#favorite_"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/star-empty.png");jQuery("#favorite_"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("unfav_link").addClass("fav_link");remove_item_from_favorites_database($(this).attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("unstar",$(this).attr("href"),Buleys.view.slug,Buleys.view.type);
send_to_console("<p>item removed from favorites</p>");setTimeout("fade_console_message()",1E3)});
jQuery("body").bind("favorite",function(a){a.preventDefault();if(is_in_cursor_mode()){jQuery("#"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/star.png");jQuery("#"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,
"")).children(".favorite_status").children("a").removeClass("unfav_link");jQuery("#favorite_"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/star.png");jQuery("#favorite_"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("fav_link").addClass("unfav_link");add_item_to_favorites_database($(".cursor a").attr("href"),Buleys.view.slug,Buleys.view.type);
post_feedback("star",$(".cursor a").attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item favorited</p>");setTimeout("fade_console_message()",1E3)}else $.each($(".selected"),function(c,b){jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/star.png");jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");
jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("unfav_link");jQuery("#favorite_"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/star.png");jQuery("#favorite_"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("fav_link").addClass("unfav_link");
add_item_to_favorites_database($(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("star",$(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item favorited</p>");setTimeout("fade_console_message()",1E3)})});
jQuery("body").bind("unfavorite",function(a){a.preventDefault();if(is_in_cursor_mode()){jQuery("#"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/star-empty.png");jQuery("#"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,
"")).children(".favorite_status").children("a").removeClass("unfav_link");jQuery("#favorite_"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/star-empty.png");jQuery("#favorite_"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("unfav_link").addClass("fav_link");remove_item_from_favorites_database($(".cursor > a").attr("href"),
Buleys.view.slug,Buleys.view.type);post_feedback("unstar",$(".cursor > a").attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item removed from favorites</p>");setTimeout("fade_console_message()",1E3)}else $.each($(".selected"),function(c,b){jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/star-empty.png");jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,
"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("unfav_link");jQuery("#favorite_"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/star-empty.png");jQuery("#favorite_"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,
"")).children(".unfav_link").removeClass("unfav_link").addClass("fav_link");remove_item_from_favorites_database($(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("unstar",$(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item removed from favorites</p>");setTimeout("fade_console_message()",1E3)})});
jQuery("body").bind("fav_link",function(a){a.preventDefault();jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/star.png");jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("a").removeClass("fav_link").addClass("unfav_link");
jQuery("#favorite_"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/star.png");jQuery("#favorite_"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("fav_link").addClass("unfav_link");add_item_to_favorites_database($(this).attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("star",$(this).attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item favorited</p>");
setTimeout("fade_console_message()",1E3)});jQuery("body").bind("close_item_preview",function(a){a.preventDefault();jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})});jQuery("body").bind("sidebar_close_link",function(a){a.preventDefault();jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})});jQuery("body").bind("close_all",function(a){a.preventDefault();jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})});
jQuery("body").bind("mark_item_as_unread",function(a){a.preventDefault();$(this).children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/star.png");$(this).removeClass("unfav_link");$(this).addClass("fav_link");a=jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));if(a.hasClass("read")){a.removeClass("read");a.addClass("unread")}remove_item_from_read_database($(this).attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>marked as unread</p>");setTimeout("fade_console_message()",
1E3)});jQuery("body").bind("mark_all_items_as_read",function(a){a.preventDefault();jQuery.each(jQuery(".unread"),function(c,b){var d=jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));if(d.hasClass("unread")){d.removeClass("unread");d.addClass("read")}mark_item_as_read(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type)})});
jQuery("body").bind("mark_seen",function(a){a.preventDefault();if(is_in_cursor_mode()){jQuery(".cursor").removeClass("seen");jQuery(".cursor").addClass("unseen");jQuery(item_to_mark).attr("status",jQuery(item_to_mark).attr("status")+" unseen");jQuery(item_to_mark).attr("status",jQuery(item_to_mark).attr("status").replace(" seen",""));mark_item_as_unseen(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type)}else jQuery.each(jQuery(".selected"),function(c,b){jQuery(b).removeClass("unseen");
jQuery(b).addClass("seen");typeof jQuery(b).attr("status")!=="undefined"&&jQuery(b).attr("status",jQuery(b).attr("status").replace(" unseen",""));jQuery(b).attr("status",jQuery(b).attr("status")+" seen");mark_item_as_seen(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type)})});
jQuery("body").bind("mark_unseen",function(a){a.preventDefault();if(is_in_cursor_mode()){jQuery(".cursor").removeClass("seen");jQuery(".cursor").addClass("unseen");jQuery(item_to_mark).attr("status",jQuery(item_to_mark).attr("status")+" seen");jQuery(item_to_mark).attr("status",jQuery(item_to_mark).attr("status").replace(" unseen",""));mark_item_as_unseen(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type)}else jQuery.each(jQuery(".selected"),function(c,b){jQuery(b).removeClass("seen");
jQuery(b).addClass("unseen");var d=jQuery(b).attr("status");typeof d!=="undefined"&&jQuery(b).attr("status",d.replace(" seen",""));jQuery(b).attr("status",jQuery(b).attr("status")+" unseen");mark_item_as_unseen(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type)})});
jQuery("body").bind("select_all",function(a){a.preventDefault();$.each($("#results > li"),function(c,b){if(!jQuery(b).hasClass("selected")){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")}})});
jQuery("body").bind("select_none",function(a){a.preventDefault();if(is_in_cursor_mode()){jQuery(".cursor").removeClass("selected");jQuery(".cursor").attr("status",jQuery(item_to_mark).attr("status").replace(" selected",""))}else $.each($(".selected"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
jQuery("body").bind("select_inverse",function(a){a.preventDefault();if(is_in_cursor_mode())if(jQuery(".cursor").hasClass("selected")){jQuery(".cursor").removeClass("selected");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" selected",""))}else{jQuery(".cursor").addClass("selected");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status")+" selected")}else $.each($("#results li"),function(c,b){if(jQuery(b).hasClass("selected")){jQuery(b).removeClass("selected");jQuery(b).attr("status",
jQuery(b).attr("status").replace(" selected",""))}else{jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")}})});jQuery("body").bind("select_favorites",function(a){a.preventDefault();$.each($(".favorited"),function(c,b){if(!jQuery(b).hasClass("selected")){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")}})});
jQuery("body").bind("deselect_seen",function(a){a.preventDefault();$.each($(".seen"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});jQuery("body").bind("deselect_unseen",function(a){a.preventDefault();$.each($(".unseen"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
jQuery("body").bind("deselect_favorites",function(a){a.preventDefault();$.each($(".favorited"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});jQuery("body").bind("deselect_read",function(a){a.preventDefault();$.each($(".read"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
jQuery("body").bind("deselect_unread",function(a){a.preventDefault();$.each($(".unread"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});jQuery("body").bind("deselect_archived",function(a){a.preventDefault();$.each($(".archived"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
jQuery("body").bind("deselect_unarchived",function(a){a.preventDefault();$.each($(".unarchived"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});jQuery("body").bind("deselect_unseen",function(a){a.preventDefault();$.each($(".unseen"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
jQuery("body").bind("deselect_unread",function(a){a.preventDefault();$.each($(".unread"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});jQuery("body").bind("deselect_unarchived",function(a){a.preventDefault();$.each($(".unarchived"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
jQuery("body").bind("select_seen",function(a){a.preventDefault();$.each($(".seen"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});jQuery("body").bind("select_unseen",function(a){a.preventDefault();$.each($(".unseen"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});
jQuery("body").bind("select_read",function(a){a.preventDefault();$.each($(".read"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});jQuery("body").bind("select_unread",function(a){a.preventDefault();$.each($(".unread"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});
jQuery("body").bind("select_archived",function(a){a.preventDefault();$.each($(".archived"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});jQuery("body").bind("select_unarchived",function(a){a.preventDefault();$.each($(".unarchived"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});
jQuery("body").bind("delete",function(a){a.preventDefault();if(is_in_cursor_mode()){delete_item(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);if(jQuery(".cursor").next().length>0)jQuery(".cursor").next().addClass("cursor").prev().remove();else{jQuery(".cursor").remove();jQuery("#results li:first").addClass("cursor")}}else $.each($(".selected"),function(c,b){delete_item(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(b).remove()})});
jQuery("body").bind("select",function(a){a.preventDefault();is_in_cursor_mode()?$.each($(".cursor"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")}):$.each($(".selected"),function(c,b){jQuery(b).addClass("selected");jQuery(b).attr("status",jQuery(b).attr("status")+" selected")})});
jQuery("body").bind("deselect",function(a){a.preventDefault();is_in_cursor_mode()?$.each($(".cursor"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))}):$.each($(".selected"),function(c,b){jQuery(b).removeClass("selected");jQuery(b).attr("status",jQuery(b).attr("status").replace(" selected",""))})});
jQuery("body").bind("archive",function(a){a.preventDefault();if(is_in_cursor_mode()){archive_item(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);if(jQuery(".cursor").next().length>0){jQuery(".cursor").next().addClass("cursor").prev().remove();jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" cursor",""))}else{jQuery(".cursor").remove();jQuery("#results li:first").addClass("cursor");jQuery("#results li:first").attr("status",jQuery(item_to_mark).attr("status").replace(" cursor",
""))}}else $.each($(".selected"),function(c,b){archive_item(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);Buleys.view.page!=="favorites"&&Buleys.view.page!=="archive"&&jQuery(b).remove()})});
jQuery("body").bind("read",function(a){a.preventDefault();if(is_in_cursor_mode()){window.open(jQuery(".cursor > a").attr("href"),jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));mark_item_as_read(jQuery(".cursor > a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(".cursor").addClass("read");jQuery(".cursor").removeClass("unread");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status")+" read");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" unread",
""))}else $.each($(".selected"),function(c,b){window.open(jQuery(b).children("a").attr("href"),jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));mark_item_as_read(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(b).addClass("read");jQuery(b).removeClass("unread");jQuery(b).attr("status",jQuery(b).attr("status")+" read");jQuery(b).attr("status",jQuery(b).attr("status").replace(" unread",""))})});
jQuery("body").bind("unarchive",function(a){a.preventDefault();if(is_in_cursor_mode()){unarchive_item(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(".cursor").removeClass("archived").addClass(".unarchived");Buleys.view.page=="archive"&&jQuery(".cursor").remove()}else $.each($(".selected"),function(c,b){unarchive_item(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);Buleys.view.page=="archive"&&jQuery(b).remove()})});
jQuery("body").bind("mark_read",function(a){a.preventDefault();if(is_in_cursor_mode()){mark_item_as_read(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(".cursor").addClass("read");jQuery(".cursor").removeClass("unread");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status")+" read");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" unread",""))}else $.each($(".selected"),function(c,b){mark_item_as_read(jQuery(b).children("a").attr("href"),
Buleys.view.slug,Buleys.view.type);jQuery(b).addClass("read");jQuery(b).removeClass("unread");jQuery(b).attr("status",jQuery(b).attr("status")+" read");jQuery(b).attr("status",jQuery(b).attr("status").replace(" unread",""))})});
jQuery("body").bind("mark_unread",function(a){a.preventDefault();if(is_in_cursor_mode()){remove_item_from_read_database(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(".cursor").addClass("unread");jQuery(".cursor").removeClass("read");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status")+" unread");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" read",""))}else $.each($(".selected"),function(c,b){remove_item_from_read_database(jQuery(b).children("a").attr("href"),
Buleys.view.slug,Buleys.view.type);jQuery(b).addClass("unread");jQuery(b).removeClass("read");jQuery(b).attr("status",jQuery(b).attr("status")+" read");jQuery(b).attr("status",jQuery(b).attr("status").replace(" unread",""))})});
jQuery("body").bind("mark_all_items_as_unread",function(a){a.preventDefault();jQuery.each(jQuery(".read"),function(c,b){var d=jQuery("#"+jQuery(b).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));if(d.hasClass("read")){d.removeClass("read");d.addClass("unread");jQuery(d).attr("status",jQuery(b).attr("status")+" unread");jQuery(d).attr("status",jQuery(b).attr("status").replace(" read",""))}remove_item_from_read_database(jQuery(b).children("a").attr("href"),Buleys.view.slug,Buleys.view.type)});
jQuery("#logout").live("click",function(){account_logout()});jQuery(".do_logout").live("click",function(){account_logout()});jQuery(".do_logout").live("click",function(){account_logout()});jQuery(".submitthelogin").live("click",function(){});jQuery("body").bind("defaulttext",function(){jQuery(this).val("");jQuery(this).removeClass("defaulttext")})});
jQuery("body").bind("delete_category",function(a){a.preventDefault();a=$(this).attr("link");var c=$(this).attr("type"),b=$(this).attr("slug");$(this).parent().parent().remove();remove_category_for_item(a.replace(/[^a-zA-Z0-9-_]+/g,""),c,b);$(this).hasClass("voted")||post_feedback("delete_category",a,c,b)});
jQuery("body").bind("follow_topic",function(a){a.preventDefault();a=$(this).attr("key");var c=$(this).attr("type");if(typeof a=="undefined")a=slug;if(typeof c=="undefined"||c=="")c=type;add_follow_if_doesnt_exist(c,a);post_feedback("follow","",a,c);$(this).children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/heart.png");$(this).removeClass("follow_topic");$(this).addClass("unfollow_topic")});
jQuery("body").bind("unfollow_topic",function(a){a.preventDefault();a=$(this).attr("key");var c=$(this).attr("type");if(typeof a=="undefined")a=slug;if(typeof c=="undefined"||c=="")c=type;remove_follow(c,a);post_feedback("unfollow","",a,c);$(this).children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/heart-empty.png");$(this).removeClass("unfollow_topic");$(this).addClass("follow_topic")});
jQuery("body").bind("subscribe_topic",function(a){a.preventDefault();a=$(this).attr("key");var c=$(this).attr("type");if(typeof a=="undefined")a=slug;if(typeof c=="undefined"||c=="")c=type;add_subscription_if_doesnt_exist(c,a);post_feedback("subscribe","",a,c);$(this).children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/inbox-document.png");$(this).removeClass("subscribe_topic");$(this).addClass("unsubscribe_topic")});
jQuery("body").bind("unsubscribe_topic",function(a){a.preventDefault();a=$(this).attr("key");var c=$(this).attr("type");if(typeof a=="undefined")a=slug;if(typeof c=="undefined"||c=="")c=type;remove_subscription(c,a);post_feedback("subscribe","",a,c);$(this).children("img").attr("src","http://buleys.com/images/icons/fugue-shadowless/inbox.png");$(this).removeClass("unsubscribe_topic");$(this).addClass("subscribe_topic")});
jQuery("body").bind("vote_up_category",function(a){a.preventDefault();a=$(this).attr("link");var c=$(this).attr("type"),b=$(this).attr("slug"),d="";d=a.replace(/[^a-zA-Z0-9-_]+/g,"")+c.toLowerCase()+b.toLowerCase();add_or_update_vote(d,1);$(this).hasClass("voted")||post_feedback("category_upvote",a,c,b);$(this).addClass("voted")});
jQuery("body").bind("vote_down_category",function(a){a.preventDefault();a=$(this).attr("link");var c=$(this).attr("type"),b=$(this).attr("slug"),d="";d=a.replace(/[^a-zA-Z0-9-_]+/g,"")+c.toLowerCase()+b.toLowerCase();add_or_update_vote(d,-1);$(this).hasClass("voted")||post_feedback("category_downvote",a,c,b);$(this).addClass("voted")});
jQuery("body").bind("vote_up",function(a){a.preventDefault();a=$(this).attr("link").replace(/[^a-zA-Z0-9-_]+/g,"");if(jQuery("#overlay_upvote_"+a).hasClass("vote")){jQuery("#overlay_upvote_"+a).children("img").attr("src","/images/icons/fugue-shadowless/thumb-up-empty.png");$(".vote").removeClass("vote");$(this).parent().removeClass("voted");post_feedback("item_remove_upvote",a,Buleys.view.type,Buleys.view.slug);remove_vote(a)}else{jQuery("#overlay_downvote_"+a).children("img").attr("src","/images/icons/fugue-shadowless/thumb-empty.png");
jQuery("#overlay_upvote_"+a).children("img").attr("src","/images/icons/fugue-shadowless/thumb-up.png");$(".vote").removeClass("vote");$(this).parent().addClass("voted");$(this).addClass("vote");post_feedback("item_upvote",a,Buleys.view.type,Buleys.view.slug);add_or_update_vote(a,1)}});
jQuery("body").bind("vote_down",function(a){a.preventDefault();a=$(this).attr("link").replace(/[^a-zA-Z0-9-_]+/g,"");var c=a.replace(/[^a-zA-Z0-9-_]+/g,"");if(jQuery("#overlay_downvote_"+c).hasClass("vote")){jQuery("#overlay_downvote_"+c).children("img").attr("src","/images/icons/fugue-shadowless/thumb-empty.png");$(".vote").removeClass("vote");$(this).parent().removeClass("voted");post_feedback("item_remove_downvote",a,Buleys.view.type,Buleys.view.slug);remove_vote(a)}else{jQuery("#overlay_downvote_"+
c).children("img").attr("src","/images/icons/fugue-shadowless/thumb.png");jQuery("#overlay_upvote_"+c).children("img").attr("src","/images/icons/fugue-shadowless/thumb-up-empty.png");$(".vote").removeClass("vote");$(this).parent().addClass("voted");$(this).addClass("vote");post_feedback("item_downvote",a,Buleys.view.type,Buleys.view.slug);add_or_update_vote(a,-1)}});jQuery("#console_wrapper").stop(true).animate({opacity:0},0,function(){});jQuery("#overlay").stop(true).animate({opacity:0},0,function(){}).html("");
$("#overlay .category").live("mouseenter",function(a){a.preventDefault();add_category_controls(jQuery(this))});$("#overlay .category").live("mouseleave",function(a){a.preventDefault();jQuery("#overlay .vote_up_category").remove();jQuery("#overlay .vote_down_category").remove();jQuery("#overlay .delete_category").remove()});
jQuery("body").bind("headline a",function(){var a=$(this).attr("href");c={event:"click",item:$(this).attr("href"),page:slug};var c;c={event:"clickthrough",item:$(this).attr("href"),context:Buleys.view.slug,type:Buleys.view.type};$.post("/feedback/index.php",c,dataType="json",function(){new_window=window.open(a,click_window)})});
jQuery("body").bind("sidebar_headline a",function(){var a=$(this).attr("href"),c;c={event:"click",item:$(this).attr("href"),context:Buleys.view.slug,type:Buleys.view.type};$.post("/feedback/index.php",c,dataType="json",function(){new_window=window.open(a,click_window)})});
jQuery("#results li").live("mouseenter",function(){var a=jQuery(this);if(a.hasClass("unseen")){a.removeClass("unseen");a.addClass("seen")}url_to_preview=a.children("a").attr("href");mark_item_as_seen(url_to_preview,Buleys.view.slug,Buleys.view.type)});
jQuery("body").bind("preview_item",function(a){a.preventDefault();if(!is_in_cursor_mode()&&$(".selected").length>0)$.each($(".selected"),function(c,b){var d=jQuery(b);if(d.hasClass("unseen")){d.removeClass("unseen");d.addClass("seen")}url_to_preview=d.children("a").attr("href");mark_item_as_seen(url_to_preview,Buleys.view.slug,Buleys.view.type);load_item_to_overlay(url_to_preview);jQuery("#overlay").stop(true).animate({opacity:1},100,function(){})});else if($(".selected").length>0){a=jQuery(".cursor");
if(a.hasClass("unseen")){a.removeClass("unseen");a.addClass("seen")}url_to_preview=a.children("a").attr("href");mark_item_as_seen(url_to_preview,Buleys.view.slug,Buleys.view.type);load_item_to_overlay(url_to_preview);jQuery("#overlay").stop(true).animate({opacity:1},100,function(){})}});
jQuery("body").bind("close_item_preview",function(a){a.preventDefault();if(is_in_cursor_mode()){a=jQuery(".cursor");if(a.hasClass("unseen")){a.removeClass("unseen");a.addClass("seen")}url_to_preview=a.children("a").attr("href");a="#overlay_"+url_to_preview.replace(/[^a-zA-Z0-9-_]+/g,"");jQuery(a).length>0&&jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})}else $(".selected").length>0?$.each($(".selected"),function(c,b){var d=jQuery(b),e=d.children("a").attr("href");
if(d.hasClass("unread")){d.removeClass("unread");d.addClass("read")}d="#overlay_"+e.replace(/[^a-zA-Z0-9-_]+/g,"");if(jQuery(d).length>0){d=jQuery(b);if(d.hasClass("unseen")){d.removeClass("unseen");d.addClass("seen")}e=d.children("a").attr("href");jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})}}):jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})});
jQuery("body").bind("results li",function(){var a=jQuery(this),c=a.children("a").attr("href");if(a.hasClass("unread")){a.removeClass("unread");a.addClass("read")}var b="#overlay_"+c.replace(/[^a-zA-Z0-9-_]+/g,"");if(jQuery(b).length>0&&jQuery(a).hasClass("selected"))jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")});else if(!jQuery(a).hasClass("selected")){jQuery("#overlay").stop(true).animate({opacity:1},100,function(){});load_item_to_overlay(c)}a.addClass("selected")});
$("body").bind("selected",function(){$(this).removeClass("selected")});$("#results li").live("mouseleave",function(){});$("#show_button").live("click",function(){send_notification_to_desktop()});

function new_votes_transaction(){try{var a=Buleys.db.transaction(["votes"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("votes")}catch(c){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("votes",{keyPath:"vote_key"},false);Buleys.objectStore.createIndex("vote_value","vote_value",{unique:false});Buleys.objectStore.createIndex("modified","modified",{unique:false})};
a.onerror=function(){}}}
function check_item_vote_status_for_overlay(a){new_votes_transaction();var c=Buleys.objectStore.get(a.replace(/[^a-zA-Z0-9-_]+/g,""));c.onsuccess=function(b){checker=c;if(typeof b.target.result!=="undefined"){if(b.target.result.vote_value==-1)jQuery("#overlay_left").prepend('<div class="vote_context"><div class="vote_up empty_thumb_up_icon" alt="'+Buleys.view.slug+'" id="overlay_upvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+a+'"></div><div class="vote_down thumb_icon" id="overlay_downvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,
"")+'" link="'+a+'" alt="'+Buleys.view.slug+'" ></div></div>');else b.target.result.vote_value==1?jQuery("#overlay_left").prepend('<div class="vote_context"><div class="vote_up thumb_up_icon" alt="'+Buleys.view.slug+'" id="overlay_upvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+a+'"></div><div class="vote_down empty_thumb_icon" id="overlay_downvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+a+'" alt="'+Buleys.view.slug+'" ></div></div>'):jQuery("#overlay_left").prepend('<div class="vote_context"><div class="vote_up empty_thumb_up_icon" alt="'+
Buleys.view.slug+'" id="overlay_upvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+a+'"></div><div href="#" class="vote_down empty_thumb_icon" id="overlay_downvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+a+'" alt="'+Buleys.view.slug+'" ></div></div>');jQuery("#overlay_left").parent().addClass("voted")}else{jQuery("#overlay_left").prepend('<div class="vote_context"><div class="vote_up empty_thumb_up_icon" alt="'+Buleys.view.slug+'" id="overlay_upvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+
a+'"></div><div href="#" class="vote_down empty_thumb_icon" id="overlay_downvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+a+'" alt="'+Buleys.view.slug+'" ></div></div>');jQuery("#overlay_left").parent().addClass("unvoted")}};c.onerror=function(){}}
function get_vote_info(a,c,b){new_votes_transaction();var d=a.replace(/[^a-zA-Z0-9-_]+/g,"")+c.toLowerCase()+b.toLowerCase(),e=Buleys.objectStore.get(d);e.onsuccess=function(){if(!(typeof e.result=="undefined"||e.result==""))if(typeof e.result!="undefined")if(e.result.vote_value==0)jQuery("#"+d).addClass("voted downvoted");else e.result.vote_value==1&&jQuery("#"+d).addClass("voted upvoted")};e.onerror=function(){}}
function get_votes(){try{new_votes_transaction();Buleys.index=Buleys.objectStore.index("vote_key");var a=Buleys.index.getAll();a.onsuccess=function(){var b=a.result;b&&b.length>=0&&jQuery.each(b,function(){})};request.onerror=function(){}}catch(c){}}function remove_vote(a){new_votes_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
function add_or_update_vote(a,c){new_votes_transaction();if(typeof c=="undefined")c="";var b=Buleys.objectStore.get(a);b.onsuccess=function(){typeof b.result=="undefined"?add_vote_to_votes_database(a,c):update_vote_in_votes_database(a,c)};b.onerror=function(){}}function add_vote_to_votes_database(a,c){new_votes_transaction();var b={vote_key:a,vote_value:c,modified:(new Date).getTime()},d=Buleys.objectStore.add(b);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}
function update_vote_in_votes_database(a,c){new_votes_transaction();var b={vote_key:a,vote_value:c,modified:(new Date).getTime()},d=Buleys.objectStore.put(b);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}};
var results=[];function resultReceiver(a){results.push(parseInt(a.data));results.length==2&&postMessage(results[0]+results[1])}function errorReceiver(a){throw a.data;}onmessage=function(a){a=parseInt(a.data);if(a==0||a==1)postMessage(a);else for(var b=1;b<=2;b++){var c=new Worker("worker.js");c.onmessage=resultReceiver;c.onerror=errorReceiver;c.postMessage(a-b)}};
