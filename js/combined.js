if(typeof window.webkitIndexedDB!=="undefined"){window.IDBCursor=window.webkitIDBCursor;window.IDBDatabase=window.webkitIDBDatabase;window.IDBDatabaseError=window.webkitIDBDatabaseError;window.IDBDatabaseException=window.webkitIDBDatabaseException;window.IDBErrorEvent=window.webkitIDBErrorEvent;window.IDBEvent=window.webkitIDBEvent;window.IDBFactory=window.webkitIDBFactory;window.IDBIndex=window.webkitIDBIndex;window.IDBKeyRange=window.webkitIDBKeyRange;window.IDBObjectStore=window.webkitIDBObjectStore;
window.IDBRequest=window.webkitIDBRequest;window.IDBSuccessEvent=window.webkitIDBSuccessEvent;window.IDBTransaction=window.webkitIDBTransaction;window.indexedDB=window.webkitIndexedDB}else if("mozIndexedDB"in window)window.indexedDB=window.mozIndexedDB;var Buleys={};Buleys.db={};Buleys.queues={};Buleys.mouse={};Buleys.shortcuts={};Buleys.history={};Buleys.session={};Buleys.settings={};Buleys.settings.hotkeys={};Buleys.view={};Buleys.view.scripts=[];Buleys.loader={};Buleys.loader.loaded_scripts=0;
Buleys.loader.total_scripts=0;Buleys.debug={};Buleys.debug.database=false;Buleys.debug.ajax=false;Buleys.debug.items=false;Buleys.settings.mini_inbox_topic_count=5;Buleys.shortcuts.s_depressed=false;Buleys.shortcuts.d_depressed=false;Buleys.shortcuts.shift_depressed=false;Buleys.settings.crawl_speed=1E4;Buleys.settings.crawl_deincrement=0.5;Buleys.settings.crawl_increment=0.2;Buleys.settings.crawl_max=6E6;Buleys.settings.crawl_min=1E4;Buleys.queues.pending_crawls=[];Buleys.queues.new_items={};
Buleys.mouse.mouse_y=0;Buleys.mouse.mouse_x=0;Buleys.mouse.mouse_y_snapshot=0;Buleys.mouse.mouse_x_snapshot=0;Buleys.store=window.localStorage;Buleys.session.database_is_open=false;var session_token="",debug;$(document).ready(function(){set_page_vars();check_login_status();if(typeof Buleys.db==="object")open_database();else if(typeof Buleys.db==="IDBDatabase"){console.log("database loaded");reload_results()}});
function new_archived_transaction(){try{var a=Buleys.db.transaction(["archive"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("archive")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("archive",{keyPath:"link"},true);Buleys.objectStore.createIndex("topic_slug","topic_slug",{unique:false});Buleys.objectStore.createIndex("topic_type","topic_type",
{unique:false});Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function get_archived(a,b,e,d,f){if(typeof f=="undefined")f=false;typeof e=="undefined"||e==null||parseInt(e);typeof d=="undefined"||d==null?(new Date).getTime():parseInt(d);new_categories_transaction();Buleys.index=Buleys.objectStore.index("slug");var i=Buleys.index.getAll(b);i.onsuccess=function(){var g=i.result;if(g)g.length>1?jQuery.each(g,function(k,h){new_archived_transaction();var j=Buleys.objectStore.get(h.link);j.onsuccess=function(){if(typeof j.result!=="undefined"&&f!==true){new_item_transaction();
var c=Buleys.objectStore.get(j.result.link);c.onsuccess=function(){typeof c.result!=="undefined"&&typeof c.result.link!=="undefined"&&jQuery("#"+h.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw(c.result.link)}}else if(f==true){new_item_transaction();c=Buleys.objectStore.get(h.link);c.onsuccess=function(){typeof c.result!=="undefined"&&typeof c.result!=="undefined"&&jQuery("#"+h.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw(c.result.link)}}}}):get_item(g.link)};i.onerror=
function(){}}function archive_item(a){new_archived_transaction();a={link:a,modified:(new Date).getTime()};var b=Buleys.objectStore.add(a);b.onsuccess=function(){Buleys.objectId=b.result};b.onerror=function(){}}
function check_if_item_is_archived(a){new_archived_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){checker=b;typeof b.result!="undefined"?jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("archived"):jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("unarchived")};b.onerror=function(){}}
function add_item_to_archives_database(a,b,e){new_archived_transaction();a={item_link:a,topic_slug:b,topic_type:e,modified:(new Date).getTime()};var d=Buleys.objectStore.add(a);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}function unarchive_item(a){new_archived_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
function remove_item_from_archives_database(a){new_archived_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}};
function get_signin(){var a=get_local_storage("session_id");typeof a=="undefined"||a==null||a==""?jQuery("#main").append('<div id="login_prompt"><div id="login_form"><input id="email" type="email" placeholder="Email" name="email" class="defaulttext" required/><br/><input id="password"  type="password" name="password" placeholder="Password" /><br/><br/><a href="#" id="doregistration" class="registrationlink">Register</a> or <a href="#" id="dologinsubmit" class="submitloginform">Login</a></div><div id="login_buttons"><a href="#" id="doresetpassword" class="resetpasswordlink">Reset Password</a></div></div></div>'):
jQuery("#main").append("<div id='login_prompt'>Already logged in with session id <code>"+a+"</code>.<br/><br/><a href='#' class='do_logout'>Click here</a> to log out.</div>");Buleys.view.loaded="signin"}function get_registration(){console.log("get_registration(): ")}function get_confirmation(){console.log("get_confirmation(): ")}
function submit_registration(){if($("#password_once").val()==$("#password_twice").val()){var a=$("#password_once").val(),b=$("#first_name").val(),c=$("#display_name").val(),d=$("#last_name").val(),e=$("#address_1").val(),g=$("#address_2").val(),h=$("#city").val(),i=$("#state").val(),j=$("#zip").val(),k=$("#country").val();request_registration(a,c,b,d,e,g,h,i,j,k)}else alert("Passwords don't match")}
function account_logout(){data_to_send={method:"logout"};$.post("/feedback/index.php",data_to_send,function(a){if(typeof a.result!=="undefined"){delete Buleys.store.session_id;jQuery("#login").fadeIn("fast");jQuery("#logout").fadeOut("fast")}},"json")}
function request_login(a,b){b=md5(b);$.post("/api/index.php",{method:"request_login",secret:b,email:a,token:session_token},function(c){if(c!=null&&typeof c.result!=="undefined")if(c.result.toLowerCase()=="failure"){console.log("fail");send_to_console(c.message)}else{if(c.result.toLowerCase()=="success"){set_local_storage("session_id",c.session_id);send_to_console(c.message);jQuery("#login_prompt").html("");jQuery("#login_prompt").append("Just logged in with session id <code>"+get_local_storage("session_id")+
"</code>.<br/><br/><a href='#' class='do_logout'>Click here</a> to log out.")}}else console.log("request_login(): no data")},"json")}
function request_registration(a,b,c,d,e,g,h,i,j,k){a=md5(a);data_to_send={method:"request_registration",secret:a,display_name:b,first_name:c,last_name:d,address_1:e,address_2:g,city:h,state:i,zip:j,country:k};$.post("/feedback/index.php",data_to_send,function(f){if(typeof f.request_status!=="undefined")if(f.result.toLowerCase()=="failure"){typeof f.message!=="undefined"?jQuery("#login_status_pane").prepend("<p>"+f.message+"</p>"):jQuery("#login_status_pane").prepend("There was an error. Your account is not confirmed.");
close_button(jQuery("#login_status_pane"))}else if(f.result.toLowerCase()=="success"){typeof f.message!=="undefined"?jQuery("#login_status_pane").html("<p>"+f.message+"</p>"):jQuery("#login_status_pane").html("Your account is confirmed.");close_button(jQuery("#login_status_pane"))}},"json")}
function confirm_registration(a){data_to_send={method:"confirm_account",secret:a};$.post("/feedback/index.php",data_to_send,function(b){if(typeof b.request_status!=="undefined")if(b.result.toLowerCase()=="failure"){jQuery("#login_status_pane").html("");typeof b.reason!=="undefined"&&jQuery("#login_status_pane").prepend("<p><small>"+b.reason+"<small></p>");typeof b.message!=="undefined"?jQuery("#login_status_pane").prepend("<p>"+b.message+"</p>"):jQuery("#login_status_pane").prepend("There was an error.")}else if(b.result.toLowerCase()==
"success"){typeof b.message!=="undefined"?jQuery("#login_status_pane").html("<p>"+b.message+"</p>"):jQuery("#login_status_pane").html("Your account is confirmed and logged in.");jQuery("#login_status_pane").append('<p><strong>Password</strong>:<input id="password_once"type="password"name="password"/><br/><strong>Password</strong>(again):<input id="password_twice"type="password"name="password_confirm"/></p><p><strong>Public name</strong>:<input id="display_name"type="text"name="display_name"/></p><p id="registration_profile_info"><strong>First Name</strong>: <input id="first_name"type="text"name="first_name"  size="20"/><br/><strong>Last Name</strong>: <input id="last_name"type="text"name="last_name"  size="20"/><br/><strong>Address 1</strong>:<input id="address_1"type="text"name="address_1"/><br/><strong>Apt. #</strong> (optional): <input id="address_2"type="text"name="address_2"/><br/><strong>City</strong>: <input id="city"type="text" name="city" size="20"/><br/><strong>State</strong>: <select id="state" name="state"><option value="AL">AL</option><option value="AK">AK</option><option value="AZ">AZ</option><option value="AR">AR</option><option value="CA">CA</option><option value="CO">CO</option><option value="CT">CT</option><option value="DE">DE</option><option value="DC">DC</option><option value="FL">FL</option><option value="GA">GA</option><option value="HI">HI</option><option value="ID">ID</option><option value="IL">IL</option><option value="IN">IN</option><option value="IA">IA</option><option value="KS">KS</option><option value="KY">KY</option><option value="LA">LA</option><option value="ME">ME</option><option value="MD">MD</option><option value="MA">MA</option><option value="MI">MI</option><option value="MN">MN</option><option value="MS">MS</option><option value="MO">MO</option><option value="MT">MT</option><option value="NE">NE</option><option value="NV">NV</option><option value="NH">NH</option><option value="NJ">NJ</option><option value="NM">NM</option><option value="NY">NY</option><option value="NC">NC</option><option value="ND">ND</option><option value="OH">OH</option><option value="OK">OK</option><option value="OR">OR</option><option value="PA">PA</option><option value="RI">RI</option><option value="SC">SC</option><option value="SD">SD</option><option value="TN">TN</option><option value="TX">TX</option><option value="UT">UT</option><option value="VT">VT</option><option value="VA">VA</option><option value="WA">WA</option><option value="WV">WV</option><option value="WI">WI</option><option value="WY">WY</option></select>&nbsp;&nbsp;&nbsp;<strong>Zip</strong>: <input id="zip"type="text"name="zip" size="10"/><br/><strong>Country</strong>: <select id="country" name="country" size="1"><option value="AF">Afghanistan</option><option value="AX">Axland Islands</option><option value="AL">Albania</option><option value="DZ">Algeria</option><option value="AS">American Samoa</option><option value="AD">Andorra</option><option value="AO">Angola</option><option value="AI">Anguilla</option><option value="AQ">Antarctica</option><option value="AG">Antigua And Barbuda</option><option value="AR">Argentina</option><option value="AM">Armenia</option><option value="AW">Aruba</option><option value="AU">Australia</option><option value="AT">Austria</option><option value="AZ">Azerbaijan</option><option value="BS">Bahamas</option><option value="BH">Bahrain</option><option value="BD">Bangladesh</option><option value="BB">Barbados</option><option value="BY">Belarus</option><option value="BE">Belgium</option><option value="BZ">Belize</option><option value="BJ">Benin</option><option value="BM">Bermuda</option><option value="BT">Bhutan</option><option value="BO">Bolivia</option><option value="BA">Bosnia And Herzegovina</option><option value="BW">Botswana</option><option value="BV">Bouvet Island</option><option value="BR">Brazil</option><option value="IO">British Indian Ocean Territory</option><option value="BN">Brunei Darussalam</option><option value="BG">Bulgaria</option><option value="BF">Burkina Faso</option><option value="BI">Burundi</option><option value="KH">Cambodia</option><option value="CM">Cameroon</option><option value="CA">Canada</option><option value="CV">Cape Verde</option><option value="KY">Cayman Islands</option><option value="CF">Central African Republic</option><option value="TD">Chad</option><option value="CL">Chile</option><option value="CN">China</option><option value="CX">Christmas Island</option><option value="CC">Cocos (Keeling) Islands</option><option value="CO">Colombia</option><option value="KM">Comoros</option><option value="CG">Congo</option><option value="CD">Congo, The Democratic Republic Of The</option><option value="CK">Cook Islands</option><option value="CR">Costa Rica</option><option value="CI">Cote DIvoire</option><option value="HR">Croatia</option><option value="CU">Cuba</option><option value="CY">Cyprus</option><option value="CZ">Czech Republic</option><option value="DK">Denmark</option><option value="DJ">Djibouti</option><option value="DM">Dominica</option><option value="DO">Dominican Republic</option><option value="EC">Ecuador</option><option value="EG">Egypt</option><option value="SV">El Salvador</option><option value="GQ">Equatorial Guinea</option><option value="ER">Eritrea</option><option value="EE">Estonia</option><option value="ET">Ethiopia</option><option value="FK">Falkland Islands (Malvinas)</option><option value="FO">Faroe Islands</option><option value="FJ">Fiji</option><option value="FI">Finland</option><option value="FR">France</option><option value="GF">French Guiana</option><option value="PF">French Polynesia</option><option value="TF">French Southern Territories</option><option value="GA">Gabon</option><option value="GM">Gambia</option><option value="GE">Georgia</option><option value="DE">Germany</option><option value="GH">Ghana</option><option value="GI">Gibraltar</option><option value="GR">Greece</option><option value="GL">Greenland</option><option value="GD">Grenada</option><option value="GP">Guadeloupe</option><option value="GU">Guam</option><option value="GT">Guatemala</option><option value=" Gg">Guernsey</option><option value="GN">Guinea</option><option value="GW">Guinea-Bissau</option><option value="GY">Guyana</option><option value="HT">Haiti</option><option value="HM">Heard Island And Mcdonald Islands</option><option value="VA">Holy See (Vatican City State)</option><option value="HN">Honduras</option><option value="HK">Hong Kong</option><option value="HU">Hungary</option><option value="IS">Iceland</option><option value="IN">India</option><option value="ID">Indonesia</option><option value="IR">Iran, Islamic Republic Of</option><option value="IQ">Iraq</option><option value="IE">Ireland</option><option value="IM">Isle Of Man</option><option value="IL">Israel</option><option value="IT">Italy</option><option value="JM">Jamaica</option><option value="JP">Japan</option><option value="JE">Jersey</option><option value="JO">Jordan</option><option value="KZ">Kazakhstan</option><option value="KE">Kenya</option><option value="KI">Kiribati</option><option value="KP">Korea, Democratic People\'s Republic Of</option><option value="KR">Korea, Republic Of</option><option value="KW">Kuwait</option><option value="KG">Kyrgyzstan</option><option value="LA">Lao People\'s Democratic Republic</option><option value="LV">Latvia</option><option value="LB">Lebanon</option><option value="LS">Lesotho</option><option value="LR">Liberia</option><option value="LY">Libyan Arab Jamahiriya</option><option value="LI">Liechtenstein</option><option value="LT">Lithuania</option><option value="LU">Luxembourg</option><option value="MO">Macao</option><option value="MK">Macedonia, The Former Yugoslav Republic Of</option><option value="MG">Madagascar</option><option value="MW">Malawi</option><option value="MY">Malaysia</option><option value="MV">Maldives</option><option value="ML">Mali</option><option value="MT">Malta</option><option value="MH">Marshall Islands</option><option value="MQ">Martinique</option><option value="MR">Mauritania</option><option value="MU">Mauritius</option><option value="YT">Mayotte</option><option value="MX">Mexico</option><option value="FM">Micronesia, Federated States Of</option><option value="MD">Moldova, Republic Of</option><option value="MC">Monaco</option><option value="MN">Mongolia</option><option value="MS">Montserrat</option><option value="MA">Morocco</option><option value="MZ">Mozambique</option><option value="MM">Myanmar</option><option value="NA">Namibia</option><option value="NR">Nauru</option><option value="NP">Nepal</option><option value="NL">Netherlands</option><option value="AN">Netherlands Antilles</option><option value="NC">New Caledonia</option><option value="NZ">New Zealand</option><option value="NI">Nicaragua</option><option value="NE">Niger</option><option value="NG">Nigeria</option><option value="NU">Niue</option><option value="NF">Norfolk Island</option><option value="MP">Northern Mariana Islands</option><option value="NO">Norway</option><option value="OM">Oman</option><option value="PK">Pakistan</option><option value="PW">Palau</option><option value="PS">Palestinian Territory, Occupied</option><option value="PA">Panama</option><option value="PG">Papua New Guinea</option><option value="PY">Paraguay</option><option value="PE">Peru</option><option value="PH">Philippines</option><option value="PN">Pitcairn</option><option value="PL">Poland</option><option value="PT">Portugal</option><option value="PR">Puerto Rico</option><option value="QA">Qatar</option><option value="RE">Reunion</option><option value="RO">Romania</option><option value="RU">Russian Federation</option><option value="RW">Rwanda</option><option value="SH">Saint Helena</option><option value="KN">Saint Kitts And Nevis</option><option value="LC">Saint Lucia</option><option value="PM">Saint Pierre And Miquelon</option><option value="VC">Saint Vincent And The Grenadines</option><option value="WS">Samoa</option><option value="SM">San Marino</option><option value="ST">Sao Tome And Principe</option><option value="SA">Saudi Arabia</option><option value="SN">Senegal</option><option value="CS">Serbia And Montenegro</option><option value="SC">Seychelles</option><option value="SL">Sierra Leone</option><option value="SG">Singapore</option><option value="SK">Slovakia</option><option value="SI">Slovenia</option><option value="SB">Solomon Islands</option><option value="SO">Somalia</option><option value="ZA">South Africa</option><option value="GS">South Georgia And The South Sandwich Islands</option><option value="ES">Spain</option><option value="LK">Sri Lanka</option><option value="SD">Sudan</option><option value="SR">Suriname</option><option value="SJ">Svalbard And Jan Mayen</option><option value="SZ">Swaziland</option><option value="SE">Sweden</option><option value="CH">Switzerland</option><option value="SY">Syrian Arab Republic</option><option value="TW">Taiwan, Province Of China</option><option value="TJ">Tajikistan</option><option value="TZ">Tanzania, United Republic Of</option><option value="TH">Thailand</option><option value="TL">Timor-Leste</option><option value="TG">Togo</option><option value="TK">Tokelau</option><option value="TO">Tonga</option><option value="TT">Trinidad And Tobago</option><option value="TN">Tunisia</option><option value="TR">Turkey</option><option value="TM">Turkmenistan</option><option value="TC">Turks And Caicos Islands</option><option value="TV">Tuvalu</option><option value="UG">Uganda</option><option value="UA">Ukraine</option><option value="AE">United Arab Emirates</option><option value="GB">United Kingdom</option><option value="US" selected>United States</option><option value="UM">United States Minor Outlying Islands</option><option value="UY">Uruguay</option><option value="UZ">Uzbekistan</option><option value="VU">Vanuatu</option><option value="VE">Venezuela</option><option value="VN">Viet Nam</option><option value="VG">Virgin Islands, British</option><option value="VI">Virgin Islands, U.S.</option><option value="WF">Wallis And Futuna</option><option value="EH">Western Sahara</option><option value="YE">Yemen</option><option value="ZM">Zambia</option><option value="ZW">Zimbabwe</option></select><br/></p>');
request_registration_confirmation_buttons(jQuery("#login_status_pane"))}else jQuery("#login_status_pane").prepend("There was an error.")},"json")}
function send_confirmation(a,b,c,d){if(typeof b==undefined)b="";if(typeof c==undefined)c="";if(typeof d==undefined)d=false;jQuery("body").append("<div id='pending_email' style='display:none;'>"+a+"</div>");b={};b=d?{method:"account_confirmation_resend",email:a,page:slug,context:c}:{method:"account_confirmation",email:a,page:slug,context:c};$.post("/feedback/index.php",b,function(e){if(typeof e.result!=="undefined")if(e.result.toLowerCase()=="failure"){jQuery("#login_status_pane").html("");if(typeof e.reason!==
"undefined")e.reason.toLowerCase()=="account_pending"?pending_confirmation_buttons(jQuery("#login_status_pane")):ready_to_close_button(jQuery("#login_status_pane"));typeof e.message!=="undefined"&&jQuery("#login_status_pane").append("<p>"+e.message+"</p>")}else{pending_secret_confirmation_buttons(jQuery("#login_status_pane"));jQuery("#login_status_pane").html("Thank you. Buley's has sent an email to "+$("#registration_email").val()+'. Please click the verification link in that email or paste its "secret" into the box below:<br/><br/><strong>Secret</strong>: <input id="confirmation_hash" type="text" name="confirmation_hash" />')}},
"json")}
function account_login(a,b){var c=md5(b);data_to_send={method:"email_login",email:a,secret:c};$.post("/feedback/index.php",data_to_send,function(d){if(typeof d.result!=="undefined")if(d.result.toLowerCase()=="failure")typeof d.message!=="undefined"&&send_to_console("<p>"+d.message+"</p>");else if(d.result.toLowerCase()=="success"){jQuery("#login_status_pane").remove();typeof d.message!=="undefined"&&d.message!=null&&d.message!=""?send_to_console("<p>"+d.message+"</p>"):send_to_console("<p>Logged \tin successfully.</p>");jQuery("#register").fadeOut("fast");
jQuery("#login").fadeOut("fast");jQuery("#logout").fadeIn("fast");close_button(jQuery("#login_status_pane"))}},"json")}function cancel_confirmation(){}
function check_login_status(){var a=get_local_storage("session_id");if(typeof a=="undefined"||a==null||a=="")jQuery("#login_status_pane").length>=1?jQuery("#login_status_pane").html('<a href="#" id="get_login" class="getloginform">Login or Signup</a>'):jQuery("#header").append('<div id=\'login_status_pane\'><a href="#" id="get_login" class="getloginform">Login or Signup</a></div>');else jQuery("#login_status_pane").length>=1?jQuery("#login_status_pane").html(""):jQuery("#header").append("<div id='login_status_pane'></div>")}
jQuery("#logout").live("click",function(){account_logout()});jQuery(".do_logout").live("click",function(a){a.preventDefault();account_logout()});jQuery(".do_logout").live("click",function(a){a.preventDefault();account_logout()});jQuery(".submitthelogin").live("click",function(){alert("submitlogin")});$("#dologin").live("click",function(a){a.preventDefault();$("#dologin").remove();$("#login_status_pane").append('<div id="minimize_login_controls"><a href="#" id="dologinboxminimize" class="loginboxminimizelink enter_door_icon"></a></div><div id="login_form"><a href="#" id="doregistration" class="registrationlink">Register</a> or Login:<br/><input id="email" type="text" value="your@email.here" name="email" /><br/><input id="password"  type="password" xxx name="password" /></div><div id="login_buttons"><a href="#" id="doresetpassword" class="resetpasswordlink">Reset Password</a><br/><a href="#" id="dologinsubmit" class="submitloginform">Login</a></div></div>')});
$("#dologinboxminimize").live("click",function(a){a.preventDefault();$("#login_status_pane").html('<a href="#" id="dologin" class="getloginform exit_door_link"></a>')});$("#get_login").live("click",function(a){a.preventDefault();console.log(location.pathname);console.log("get_login clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};history.pushState(a,"login","http://buleys.com/start");reload_results()});
$("#dologinsubmit").live("click",function(a){a.preventDefault();typeof $('[name="password"]')!==undefined&&$('[name="password"]').val()!==""&&request_login($('[name="email"]').val(),$('[name="password"]').val())});
function new_categories_transaction(){try{var a=Buleys.db.transaction(["categories"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("categories")}catch(b){console.log("new_categories_transaction(): Could not open objectStore. You may have to create it first");a=0;if(Buleys.db.version>0)a=1;else a+=1;console.log(Buleys.db);a=Buleys.db.setVersion(a);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("categories",{keyPath:"id"},
true);Buleys.objectStore.createIndex("link","link",{unique:false});Buleys.objectStore.createIndex("slug","slug",{unique:false});Buleys.objectStore.createIndex("type","type",{unique:false});Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function add_category_controls(a){jQuery("#overlay .vote_up_category").remove();jQuery("#overlay .vote_down_category").remove();jQuery("#overlay .delete_category").remove();jQuery("#overlay .selected_category").removeClass(".selected_category");var b,e=jQuery(a).html(),c=jQuery(a).attr("link"),f=jQuery(a).attr("type"),d=jQuery(a).attr("slug");new_votes_transaction();var h=c.replace(/[^a-zA-Z0-9-_]+/g,"")+f.toLowerCase()+d.toLowerCase(),g=Buleys.objectStore.get(h);g.onsuccess=function(){if(typeof g.result==
"undefined"||g.result==""){b="<span class='vote_up_category empty_thumb_up_icon float_left category_hover_icon ' link='"+c+"' type='"+f+"' slug='"+d+"'></span>";b=b+""+e;b=b+"<div class='delete_category float_right cross_icon category_hover_icon' link='"+c+"' type='"+f+"' slug='"+d+"'></div>";b=b+"<div class='vote_down_category empty_thumb_icon float_right category_hover_icon' link='"+c+"' type='"+f+"' slug='"+d+"'></div>"}else if(typeof g.result!="undefined")if(g.result.vote_value==-1){b="<span class='vote_up_category empty_thumb_up_icon float_left category_hover_icon ' link='"+
c+"' type='"+f+"' slug='"+d+"'></span>";b=b+""+e;b=b+"<div class='delete_category float_right cross_icon category_hover_icon' link='"+c+"' type='"+f+"' slug='"+d+"'></div>";b=b+"<div class='remove_category_down_vote thumb_icon float_right category_hover_icon' link='"+c+"' type='"+f+"' slug='"+d+"'></div>"}else{b=g.result.vote_value==1?"<span class='remove_category_up_vote thumb_up_icon float_left category_hover_icon ' link='"+c+"' type='"+f+"' slug='"+d+"'></span>":"<span class='vote_up_category empty_thumb_up_icon float_left category_hover_icon ' link='"+
c+"' type='"+f+"' slug='"+d+"'></span>";b=b+""+e;b=b+"<div class='delete_category float_right cross_icon category_hover_icon' link='"+c+"' type='"+f+"' slug='"+d+"'></div>";b=b+"<div class='vote_down_category empty_thumb_icon float_right category_hover_icon' link='"+c+"' type='"+f+"' slug='"+d+"'></div>"}else{b="<span class='vote_up_category empty_thumb_up_icon float_left category_hover_icon ' link='"+c+"' type='"+f+"' slug='"+d+"'></span>";b=b+""+e;b=b+"<div class='delete_category float_right cross_icon category_hover_icon' link='"+
c+"' type='"+f+"' slug='"+d+"'></div>";b=b+"<div class='vote_down_category empty_thumb_icon float_right category_hover_icon' link='"+c+"' type='"+f+"' slug='"+d+"'></div>"}jQuery(a).html(b)};g.onerror=function(){}}function remove_category_for_item(a,b,e){new_categories_transaction();a=Buleys.objectStore["delete"](a+e+b);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
function add_category_controls_without_vote_status(a){jQuery("#overlay .vote_up_category").remove();jQuery("#overlay .vote_down_category").remove();jQuery("#overlay .delete_category").remove();jQuery("#overlay .selected_category").removeClass(".selected_category");var b=jQuery(a).html(),e=jQuery(a).attr("link"),c=jQuery(a).attr("type"),f=jQuery(a).attr("slug");jQuery(a).html("<div class='vote_block'>"+("<span class='vote_up_category thumb_up_icon float_left category_hover_icon ' link='"+e+"' type='"+
c+"' slug='"+f+"'></span>"+b+"<div class='delete_category float_right cross_icon category_hover_icon' link='"+e+"' type='"+c+"' slug='"+f+"'></div><div class='vote_down_category thumb_icon float_right category_hover_icon' link='"+e+"' type='"+c+"' slug='"+f+"'></div>")+"</div>")}function remove_category_for_item(a,b,e){new_categories_transaction();a=Buleys.objectStore["delete"](a+e+b);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
function remove_item_from_categories_database(a){new_categories_transaction();Buleys.index=Buleys.objectStore.index("link");var b=Buleys.index.get(a);b.onsuccess=function(){if(typeof b.result!=="undefined")if(typeof b.result!=="undefined"){var e="";e=b.result.link.replace(/[^a-zA-Z0-9-_]+/g,"")+b.result.slug.toLowerCase()+b.result.type.toLowerCase();new_categories_transaction();e=Buleys.objectStore["delete"](e);e.onsuccess=function(){delete Buleys.objectId};e.onerror=function(){}}else $.each(b.result,
function(c,f){var d="";d=f.link.replace(/[^a-zA-Z0-9-_]+/g,"")+f.slug.toLowerCase()+f.type.toLowerCase();new_categories_transaction();d=Buleys.objectStore["delete"](d);d.onsuccess=function(){delete Buleys.objectId};d.onerror=function(){}})};b.onerror=function(){}}
function add_categories_to_categories_database(a,b){jQuery.each(b,function(e,c){if(typeof c.key!=="undefined"&&c.key!==""&&c.key.toLowerCase()=="function"){new_categories_transaction();var f={id:a.replace(/[^a-zA-Z0-9-_]+/g,"")+c.key.toLowerCase()+c.type.toLowerCase(),link:a,slug:c.key,type:c.type,value:c.value,modified:(new Date).getTime()};f=Buleys.objectStore.add(f);f.onsuccess=function(){if(typeof c.key!=="undefined"){var d=c.type.toLowerCase()+"_"+c.key.toLowerCase();if(typeof Buleys.queues.new_items[d]==
"undefined")Buleys.queues.new_items[d]=0;Buleys.queues.new_items[d]+=1}};f.onerror=function(){}}})}
function get_item_categories_for_overlay(a){new_categories_transaction();Buleys.objectStore.get(a);try{new_categories_transaction();Buleys.index=Buleys.objectStore.index("link");var b=Buleys.index.getAll(a);b.onsuccess=function(){var c=b.result;c&&c.length>=0&&jQuery.each(c,function(f,d){if(jQuery("#categories_"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).length<1){var h="<ul class='category_list' id='categories_"+a.replace(/[^a-zA-Z0-9-_]+/g,"")+"'></ul>";jQuery("#overlay_"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).append(h)}h=
"<li id='list_item_"+a.replace(/[^a-zA-Z0-9-_]+/g,"")+d.type.toLowerCase()+d.slug.toLowerCase()+"' class='category_list_item' link='"+a+"' type='"+d.type.toLowerCase()+"' slug='"+d.slug.toLowerCase()+"'><a id='"+a.replace(/[^a-zA-Z0-9-_]+/g,"")+d.type.toLowerCase()+d.slug.toLowerCase()+"'  class='category' link='"+a+"' type='"+d.type.toLowerCase()+"' slug='"+d.slug.toLowerCase()+"' href='/"+d.type.toLowerCase()+"/"+d.slug+"'>"+d.value+"</a></li>";jQuery("#categories_"+a.replace(/[^a-zA-Z0-9-_]+/g,
"")).append(h);get_vote_info(a,d.type.toLowerCase(),d.slug.toLowerCase())})};request.onerror=function(){}}catch(e){}}$(".delete_category").live("click",function(a){a.preventDefault();a=$(this).attr("link");var b=$(this).attr("type"),e=$(this).attr("slug");$(this).parent().parent().remove();remove_category_for_item(a.replace(/[^a-zA-Z0-9-_]+/g,""),b,e);$(this).hasClass("voted")||post_feedback("delete_category",a,b,e)});
$(".vote_up_category").live("click",function(a){a.preventDefault();a=$(this).attr("link");var b=$(this).attr("type"),e=$(this).attr("slug"),c="";c=a.replace(/[^a-zA-Z0-9-_]+/g,"")+b.toLowerCase()+e.toLowerCase();jQuery(this).removeClass("empty_thumb_up_icon").addClass("thumb_up_icon");jQuery(this).parent().children(".thumb_icon").removeClass(".thumb_icon").addClass("empty_thumb_icon");add_or_update_vote(c,1);$(this).hasClass("voted")||post_feedback("category_upvote",a,b,e);$(this).addClass("voted");
$(this).removeClass("vote_up_category");$(this).addClass("remove_category_up_vote")});
$(".vote_down_category").live("click",function(a){a.preventDefault();a=$(this).attr("link");var b=$(this).attr("type"),e=$(this).attr("slug"),c="";jQuery(this).removeClass("empty_thumb_icon").addClass("thumb_icon");jQuery(this).parent().children(".thumb_up_icon").removeClass(".thumb_up_icon").addClass("empty_thumb_up_icon");c=a.replace(/[^a-zA-Z0-9-_]+/g,"")+b.toLowerCase()+e.toLowerCase();add_or_update_vote(c,-1);$(this).hasClass("voted")||post_feedback("category_downvote",a,b,e);$(this).addClass("voted");
$(this).removeClass("vote_down_category");$(this).addClass("remove_category_down_vote")});
$(".remove_category_up_vote").live("click",function(a){a.preventDefault();a=$(this).attr("link");var b=$(this).attr("type"),e=$(this).attr("slug"),c="";c=a.replace(/[^a-zA-Z0-9-_]+/g,"")+b.toLowerCase()+e.toLowerCase();jQuery(this).removeClass("thumb_up_icon").addClass("empty_thumb_up_icon");remove_vote(c);$(this).hasClass("voted")&&post_feedback("remove_category_upvote",a,b,e);$(this).removeClass("voted");$(this).removeClass("remove_category_up_vote");$(this).addClass("vote_up_category")});
$(".remove_category_down_vote").live("click",function(a){a.preventDefault();a=$(this).attr("link");var b=$(this).attr("type"),e=$(this).attr("slug"),c="";jQuery(this).removeClass("thumb_icon").addClass("empty_thumb_icon");c=a.replace(/[^a-zA-Z0-9-_]+/g,"")+b.toLowerCase()+e.toLowerCase();remove_vote(c);$(this).hasClass("voted")&&post_feedback("remove_category_downvote",a,b,e);$(this).removeClass("voted");$(this).removeClass("remove_category_down_vote");$(this).addClass("vote_down_category")});
$("#overlay .category").live("mouseenter",function(a){a.preventDefault();add_category_controls(jQuery(this))});$("#overlay .category").live("mouseleave",function(a){a.preventDefault();jQuery("#overlay .vote_up_category").remove();jQuery("#overlay .vote_down_category").remove();jQuery("#overlay .remove_category_up_vote").remove();jQuery("#overlay .remove_category_down_vote").remove();jQuery("#overlay .delete_category").remove()});
function flash_console(a){send_to_console(a);jQuery("#console_wrapper").stop(true).animate({opacity:1},500);jQuery("#console_wrapper").stop(true).animate({opacity:0},500)}function send_text_to_console(a){jQuery("#console").html("").append("<p>"+a+"</p>")}function send_to_console(a){send_text_to_console(a);jQuery("#console_wrapper").stop(true).animate({opacity:1},500)}function fade_console_message(){jQuery("#console_wrapper").stop(true).animate({opacity:0},500)};
function do_work(){Buleys.queues.pending_crawls.length>0?do_pending_crawl():get_follows();var a=0;a=getKeys(Buleys.queues.new_items);if(a>0){var b=type+"_"+slug;typeof Buleys.queues.new_items[b]!=="undefined"&&delete Buleys.queues.new_items[b];if(getKeys(Buleys.queues.new_items)>0)typeof jQuery("#minimize_inbox")!=="undefined"&&a>0&&jQuery("#get_inbox").removeClass("inbox_icon").addClass("empty_inbox_icon").parent().parent().removeClass("empty_inbox").addClass("waiting_inbox");else jQuery("#get_inbox img").removeClass("empty_inbox_icon").addClass("inbox_icon").parent().parent().addClass("empty_inbox").removeClass("waiting_inbox");
save_queues();save_settings()}if(Buleys.mouse.mouse_y_snapshot===Buleys.mouse.mouse_y&&Buleys.mouse.mouse_x_snapshot===Buleys.mouse.mouse_x)if(Buleys.settings.crawl_speed>=Buleys.settings.crawl_min)Buleys.settings.crawl_speed*=Buleys.settings.crawl_increment;else Buleys.settings.crawl_speed=Buleys.settings.crawl_min;else{if(Buleys.settings.crawl_speed<=Buleys.settings.crawl_max)Buleys.settings.crawl_speed*=Buleys.settings.crawl_deincrement;else Buleys.settings.crawl_speed=Buleys.settings.crawl_max;
Buleys.mouse.mouse_y_snapshot=Buleys.mouse.mouse_y;Buleys.mouse.mouse_x_snapshot=Buleys.mouse.mouse_x}if(jQuery(".unseen").length>0){window.document.title=window.document.title.replace(/[|\s]*?Buley's/,"");window.document.title=window.document.title.replace(/\(.*?\)[|\s]*?/g,"")+" ("+jQuery(".unseen").length+") | Buley's"}else window.document.title=window.document.title.replace(/[\s]?\(.*?\)/g,"");setTimeout("do_work()",Buleys.settings.crawl_speed)};
function is_in_cursor_mode(){return jQuery(".cursor").length>0?true:false};
function new_favorite_transaction(){try{var a=Buleys.db.transaction(["favorites"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("favorites")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("favorites",{keyPath:"item_link"},true);Buleys.objectStore.createIndex("topic_slug","topic_slug",{unique:false});Buleys.objectStore.createIndex("topic_type","topic_type",
{unique:false});Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function add_favorite_to_results(a){var b=a.link.replace(/[^a-zA-Z0-9-_]+/g,"");jQuery("#"+b).length||jQuery("<li class='item' modified= '"+a.modified+"'  index-date= '"+a.index_date+"' published-date= '"+a.published_date+"' id='"+a.link.replace(/[^a-zA-Z0-9-_]+/g,"")+"'><a href='"+a.link+"'>"+a.title+"</a><div class='magnify_icon'></div></li>").hide().prependTo("#results").fadeIn("slow")}
function get_favorites(a,b,c,e){typeof c=="undefined"||parseInt(c);typeof e=="undefined"?(new Date).getTime():parseInt(e);new_categories_transaction();Buleys.index=Buleys.objectStore.index("slug");var h=Buleys.index.getAll(b);h.onsuccess=function(){var f=h.result;if(f)f.length>1?jQuery.each(f,function(j,d){new_favorite_transaction();var i=Buleys.objectStore.get(d.link);i.onsuccess=function(){if(typeof i.result!=="undefined"){new_item_transaction();var g=Buleys.objectStore.get(d.link);g.onsuccess=
function(){typeof g.result!=="undefined"&&typeof g.result.link!=="undefined"&&jQuery("#"+d.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw(g.result.link)}}};i.onerror=function(){if(jQuery("#"+d.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0){add_item_to_results(d);check_if_item_is_favorited(d.link);check_if_item_is_read(d.link);check_if_item_is_seen(d.link)}}}):get_item(f.link)};h.onerror=function(){}}
function get_favorite(a){if(typeof a!=="undefined"){new_favorite_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!="undefined"){new_archived_transaction();var c=Buleys.objectStore.get(a);c.onsuccess=function(){if(typeof c.result==="undefined")if(jQuery("#"+b.result.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0){add_favorite_to_results(b.result);check_if_favorite_is_favorited(b.result.link);check_if_favorite_is_read(b.result.link);check_if_favorite_is_seen(b.result.link)}};
c.onerror=function(){if(jQuery("#"+b.result.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0){add_favorite_to_results(b.result);check_if_favorite_is_favorited(b.result.link);check_if_favorite_is_read(b.result.link);check_if_favorite_is_seen(b.result.link)}}}};b.onerror=function(){}}}
function get_favorite_for_console(a){new_favorite_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!="undefined"&&typeof b.result.id=="string"){var c="<div id='console_"+b.result.id.replace(/[^a-zA-Z0-9-_]+/g,"")+"'>";c=c+"<h3><a href='"+b.result.id+"'>"+b.result.title+"</a></h3>";c=c+"<p>"+b.result.author+"</p>";c+="</div>";send_to_console(c)}};b.onerror=function(){}}
function get_favorite_for_overlay(a){new_favorite_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!="undefined"&&typeof b.result.link=="string"){var c='<div id="overlay_right"><div class="sidebar_close_link"><div href="#" class="close_sidebar_link close_icon" id="'+favorite_slug+"\"></div></div><h3 id='overlay_"+favorite_slug.replace(/[^a-zA-Z0-9-_]+/g,"")+"'><div href='"+b.result.link+"'>"+b.result.title+"</div></h3></div><div id='overlay_left'></div>";send_to_overlay(c)}};
b.onerror=function(){}}function add_item_as_favorite(a){new_status_transaction();a={link:a,status:"favorite",modified:(new Date).getTime()};var b=Buleys.objectStore.add(a);b.onsuccess=function(){Buleys.objectId=b.result};b.onerror=function(){}}
function check_if_item_is_favorited_for_overlay(a){new_favorite_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!="undefined"){jQuery("#overlay_left").prepend("<div class='overlay_favorite_status' id='favorite_"+a.replace(/[^a-zA-Z0-9-_]+/g,"")+"'><div href='"+a+"' class='unfav_link star_icon'></div></div>");jQuery("#overlay_left").addClass("favorited")}else{jQuery("#overlay_left").prepend("<div class='overlay_favorite_status' id='favorite_"+a.replace(/[^a-zA-Z0-9-_]+/g,
"")+"'><div href='"+a+"' class='fav_link empty_star_icon'></div></div>");jQuery("#overlay_left").addClass("unfavorited")}};b.onerror=function(){}}
function check_if_item_is_favorited(a){new_favorite_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!="undefined"){Buleys.settings.show_favorite_status!==false&&jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).prepend("<span class='favorite_status'><div href='"+a+"' class='unfav_link star_icon'></div></span>");jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("favorited")}else{Buleys.settings.show_favorite_status!==false&&jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,
"")).prepend("<span class='favorite_status'><div href='"+a+"' class='fav_link empty_star_icon'></div></span>");jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("unfavorited")}};b.onerror=function(){}}function add_item_to_favorites_database(a,b,c){new_favorite_transaction();a={item_link:a,topic_slug:b,topic_type:c,modified:(new Date).getTime()};var e=Buleys.objectStore.add(a);e.onsuccess=function(){Buleys.objectId=e.result};e.onerror=function(){}}
function remove_item_from_favorites_database(a){new_favorite_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
$(".unfav_link").live("click",function(a){a.preventDefault();console.log(jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children(".unfav_link"));jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("star_icon").addClass("empty_star_icon");jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");
jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children(".unfav_link").removeClass("unfav_link").addClass("fav_link");jQuery("#favorite_"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("star_icon").addClass("empty_star_icon");jQuery("#favorite_"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("unfav_link").addClass("fav_link");if(typeof Buleys.view.page!==
"undefined"&&(Buleys.view.type=="favorites"||Buleys.view.page=="favorites"||Buleys.view.page=="favs"))jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).remove();remove_item_from_favorites_database($(this).attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("unstar",$(this).attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item removed from favorites</p>");setTimeout("fade_console_message()",1E3)});
$("#favorite").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){jQuery("#"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("empty_star_icon").addClass("star_icon");jQuery("#"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("unfav_link");
jQuery("#favorite_"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("empty_star_icon").addClass("star_icon");jQuery("#favorite_"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("fav_link").addClass("unfav_link");add_item_to_favorites_database($(".cursor a").attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("star",$(".cursor a").attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item favorited</p>");
setTimeout("fade_console_message()",1E3)}else $.each($(".selected"),function(b,c){jQuery("#"+jQuery(c).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("empty_star_icon").addClass("star_icon");jQuery("#"+jQuery(c).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(c).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,
"")).children(".favorite_status").children("div").removeClass("unfav_link");jQuery("#favorite_"+jQuery(c).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("empty_star_icon").addClass("star_icon");jQuery("#favorite_"+jQuery(c).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("fav_link").addClass("unfav_link");add_item_to_favorites_database($(c).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("star",
$(c).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item favorited</p>");setTimeout("fade_console_message()",1E3)})});
$("#unfavorite").live("click",function(a){a.preventDefault();if(is_in_cursor_mode()){jQuery("#"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("star_icon").addClass("empty_star_icon");jQuery("#"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("unfav_link");
jQuery("#favorite_"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("star_icon").addClass("empty_star_icon");jQuery("#favorite_"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("unfav_link").addClass("fav_link");if(typeof Buleys.view.type!=="undefined"&&(Buleys.view.type=="favorites"||Buleys.view.page=="favorites"||Buleys.view.page=="favs"))jQuery("#"+$(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,
"")).remove();remove_item_from_favorites_database($(".cursor > a").attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("unstar",$(".cursor > a").attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item removed from favorites</p>");setTimeout("fade_console_message()",1E3)}else $.each($(".selected"),function(b,c){jQuery("#"+jQuery(c).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("star_icon").addClass("empty_star_icon");
jQuery("#"+jQuery(c).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(c).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("unfav_link");jQuery("#favorite_"+jQuery(c).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("star_icon").addClass("empty_star_icon");jQuery("#favorite_"+
jQuery(c).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("unfav_link").addClass("fav_link");if(typeof Buleys.view.type!=="undefined"&&(Buleys.view.type=="favorites"||Buleys.view.page=="favorites"||Buleys.view.page=="favs"))jQuery("#"+$(c).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).remove();remove_item_from_favorites_database($(c).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("unstar",$(c).children("a").attr("href"),
Buleys.view.slug,Buleys.view.type);send_to_console("<p>item removed from favorites</p>");setTimeout("fade_console_message()",1E3)})});
$(".fav_link").live("click",function(a){a.preventDefault();jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("empty_star_icon").addClass("star_icon");jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("fav_link").addClass("unfav_link");
jQuery("#favorite_"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("empty_star_icon").addClass("star_icon");jQuery("#favorite_"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("fav_link").addClass("unfav_link");add_item_to_favorites_database($(this).attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("star",$(this).attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item favorited</p>");
setTimeout("fade_console_message()",1E3)});$("#select_favorites").live("click",function(a){a.preventDefault();$.each($(".favorited"),function(b,c){if(!jQuery(c).hasClass("selected")){jQuery(c).addClass("selected");jQuery(c).attr("status",jQuery(c).attr("status")+" selected")}})});$("#deselect_favorites").live("click",function(a){a.preventDefault();$.each($(".favorited"),function(b,c){jQuery(c).removeClass("selected");jQuery(c).attr("status",jQuery(c).attr("status").replace(" selected",""))})});
function new_follows_transaction(){try{var a=Buleys.db.transaction(["follows"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("follows")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("follows",{keyPath:"key"},true);Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function get_follows(){try{new_follows_transaction();Buleys.index=Buleys.objectStore;var a=Buleys.index.getAll();a.onsuccess=function(){var c=a.result;c&&c.length>=0&&jQuery.each(c,function(d,e){parse_single_topic(e.key)})};request.onerror=function(){}}catch(b){}}$("html").bind("mousemove",function(a){Buleys.mouse.mouse_x=a.pageX;Buleys.mouse.mouse_y=a.pageY});function getKeys(a){var b=[];if(typeof a!=="undefined"){$.each(a,function(c){b.push(c)});return b.length}else return 0}
function get_follows_deleteme(){new_follows_transaction();try{new_categories_transaction();Buleys.index=Buleys.objectStore.index("id");var a=Buleys.index.getAll();a.onsuccess=function(){var c=a.result;c&&c.length>=0&&jQuery.each(c,function(d,e){send_to_console("get_follows(): "+e)})};request.onerror=function(){}}catch(b){}}
function get_page_follow_status(a,b){new_follows_transaction();var c=Buleys.objectStore.get(a+"_"+b);c.onsuccess=function(){typeof c.result=="undefined"||c.result==""?jQuery("#page_follow_status").html("<div class='follow_topic empty_heart_icon'></div>"):jQuery("#page_follow_status").html("<div class='unfollow_topic heart_icon'></div>")};c.onerror=function(){}}
function remove_follow(a,b){if(typeof a!=="undefined"&&typeof b!=="undefined"){new_follows_transaction();var c=Buleys.objectStore["delete"](a+"_"+b);c.onsuccess=function(){delete Buleys.objectId};c.onerror=function(){}}}function add_follow_if_doesnt_exist(a,b){if(typeof a!=="undefined"&&typeof b!=="undefined"){new_follows_transaction();var c=Buleys.objectStore.get(a+"_"+b);c.onsuccess=function(){typeof c.result=="undefined"&&add_follow_to_follows_database(a,b)};c.onerror=function(){}}}
function add_follow_to_follows_database(a,b){new_follows_transaction();var c={key:a+"_"+b,modified:(new Date).getTime()},d=Buleys.objectStore.add(c);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}
$(".follow_topic").live("click",function(a){a.preventDefault();a=$(this).attr("key");var b=$(this).attr("type");if(typeof a=="undefined")a=Buleys.view.slug;if(typeof b=="undefined"||b=="")b=Buleys.view.type;add_follow_if_doesnt_exist(b,a);post_feedback("follow","",a,b);$(this).removeClass("empty_heart_icon").addClass("heart_icon");$(this).removeClass("follow_topic");$(this).addClass("unfollow_topic")});
$(".unfollow_topic").live("click",function(a){a.preventDefault();a=$(this).attr("key");var b=$(this).attr("type");if(typeof a=="undefined")a=Buleys.view.slug;if(typeof b=="undefined"||b=="")b=Buleys.view.type;remove_follow(b,a);post_feedback("unfollow","",a,b);$(this).removeClass("heart_icon").addClass("empty_heart_icon");$(this).removeClass("unfollow_topic");$(this).addClass("follow_topic")});
function temporarily_disable_hotkeys(){}function disable_hotkeys(){Buleys.settings.hotkeys.disabled=true}function enable_hotkeys(){delete Buleys.settings.hotkeys.disabled}$("#show_commands").live("click",function(a){a.preventDefault();$("#result_controls").show()});$("#hide_commands").live("click",function(a){a.preventDefault();$("#result_controls").hide()});$("#show_button").live("click",function(){send_notification_to_desktop()});
$("html").live("keyup",function(a){if(typeof Buleys.settings!=="undefined"&&typeof Buleys.settings.hotkeys!=="undefined"&&typeof Buleys.settings.hotkeys.disabled==="undefined"||typeof Buleys.settings!=="undefined"&&typeof Buleys.settings.hotkeys!=="undefined"&&typeof Buleys.settings.hotkeys.disabled!=="undefined"&&Buleys.settings.hotkeys.disabled!==true)if(a.keyCode==68)Buleys.shortcuts.d_depressed=false;else if(a.keyCode==83)Buleys.shortcuts.s_depressed=false;else if(a.keyCode==16)Buleys.shortcuts.shift_depressed=
false;else if(a.keyCode==72)Buleys.shortcuts.s_depressed||Buleys.shortcuts.d_depressed||(Buleys.shortcuts.shift_depressed?$("#view_index").click():$("#close_item_preview").click());else if(a.keyCode==76){if(!Buleys.shortcuts.s_depressed)if(!Buleys.shortcuts.d_depressed)if(Buleys.shortcuts.shift_depressed)$("#view_home").click();else{$("#preview_item").click();jQuery(".cursor")}}else if(a.keyCode==78){$("#preview_item").click();jQuery(".selected").length>0?jQuery("#results li.selected:first").addClass("cursor"):
jQuery("#results li:first").addClass("cursor")}else if(a.keyCode==74)if(jQuery(".cursor").next().length>0)jQuery(".cursor").removeClass("cursor").next().addClass("cursor");else{jQuery(".cursor").removeClass("cursor");jQuery("#results li:first").addClass("cursor")}else if(a.keyCode==75)if(jQuery(".cursor").prev().length>0)jQuery(".cursor").removeClass("cursor").prev().addClass("cursor");else{jQuery(".cursor").removeClass("cursor");jQuery("#results li:last").addClass("cursor")}else if(a.keyCode==27){jQuery(".cursor").removeClass("cursor");
$("#close_all").click()}else if(a.keyCode==77)jQuery(".cursor").removeClass("cursor");else if(a.keyCode==219)$("#preview_item").click();else if(a.keyCode==221)$("#close_item_preview").click();else if(a.keyCode==89)$("#show_commands").click();else if(a.keyCode==85)$("#hide_commands").click();else if(a.keyCode==65)if(Buleys.shortcuts.s_depressed)$("#select_all").click();else Buleys.shortcuts.d_depressed&&$("#select_none").click();else if(a.keyCode==82)if(Buleys.shortcuts.s_depressed)$("#select_unread").click();
else if(Buleys.shortcuts.d_depressed)$("#deselect_unread").click();else Buleys.shortcuts.shift_depressed?$("#view_unread").click():$("#mark_unread").click();else if(a.keyCode!=13)if(a.keyCode==73)$("#select").click();else if(a.keyCode==79)$("#deselect").click();else if(a.keyCode==69)if(Buleys.shortcuts.s_depressed)$("#select_read").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_read").click();else Buleys.shortcuts.shift_depressed?$("#view_read").click():$("#mark_read").click();else if(a.keyCode==
88)if(Buleys.shortcuts.s_depressed)$("#select_none").click();else Buleys.shortcuts.d_depressed||(Buleys.shortcuts.shift_depressed?$("#view_trash").click():$("#delete").click());else if(a.keyCode==67)if(Buleys.shortcuts.s_depressed)$("#select_archived").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_archived").click();else Buleys.shortcuts.shift_depressed?$("#view_archive").click():$("#archive").click();else if(a.keyCode==86)if(Buleys.shortcuts.s_depressed)$("#select_unarchived").click();
else Buleys.shortcuts.d_depressed?$("#deselect_unarchived").click():$("#unarchive").click();else if(a.keyCode==70)if(Buleys.shortcuts.s_depressed)$("#select_favorites").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_favorites").click();else Buleys.shortcuts.shift_depressed?$("#view_favorites").click():$("#favorite").click();else if(a.keyCode==71)if(Buleys.shortcuts.s_depressed)$("#select_unfavorite").click();else Buleys.shortcuts.d_depressed?$("#deselect_unfavorite").click():$("#unfavorite").click();
else if(a.keyCode==81)if(Buleys.shortcuts.s_depressed)$("#select_seen").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_seen").click();else Buleys.shortcuts.shift_depressed?$("#view_seen").click():$("#mark_seen").click();else if(a.keyCode==87)if(Buleys.shortcuts.s_depressed)$("#select_unseen").click();else if(Buleys.shortcuts.d_depressed)$("#deselect_unseen").click();else Buleys.shortcuts.shift_depressed?$("#view_unseen").click():$("#mark_unseen").click();else if(a.keyCode==90)if(Buleys.shortcuts.s_depressed)$("#select_inverse").click();
else Buleys.shortcuts.d_depressed||(Buleys.shortcuts.shift_depressed?$("#view_index").click():$("#refresh").click());else if(a.keyCode==73)$("#deselect").click();else a.keyCode==79&&$("#select").click()});
$("html").live("keydown",function(a){if(typeof Buleys.settings!=="undefined"&&typeof Buleys.settings.hotkeys!=="undefined"&&typeof Buleys.settings.hotkeys.disabled==="undefined"||typeof Buleys.settings!=="undefined"&&typeof Buleys.settings.hotkeys!=="undefined"&&typeof Buleys.settings.hotkeys.disabled!=="undefined"&&Buleys.settings.hotkeys.disabled!==true)if(a.keyCode==68)Buleys.shortcuts.d_depressed=true;else if(a.keyCode==83)Buleys.shortcuts.s_depressed=true;else if(a.keyCode==16)Buleys.shortcuts.shift_depressed=
true});
function add_topics_to_mini_inbox(){jQuery("#mini_inbox_list").html("");var a=0;getKeys(Buleys.queues.new_items)>0?$.each(Buleys.queues.new_items,function(c,b){if(a<=Buleys.settings.mini_inbox_topic_count){add_topic_to_mini_inbox(c,b);a++}}):jQuery("#mini_inbox_list").html("<li>No new items</li>")}
function add_topic_to_mini_inbox(a,c){new_topics_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result=="undefined"||b.result==""){var d=a.split("_",1),e=d[0];d=a.replace(d[0]+"_","");jQuery("#mini_inbox_list").append("<li><a href='/"+e+"/"+d+"' class='topic_name'>"+a+"</a> ("+c+")</li>")}else typeof b.result.name!="undefined"&&jQuery("#mini_inbox_list").append("<li><a href='/"+b.result.type+"/"+b.result.key+"' class='topic_name'>"+b.result.name+"</a> ("+c+")</li>")};
b.onerror=function(){}}$("#get_inbox").live("click",function(a){a.preventDefault();$("#mini_inbox_box").html('<div id="mini_inbox_wrapper" class="service_box_wrapper"><div class="cross_icon" id="minimize_mini_inbox_controls"></div><ul id="mini_inbox_list"><li>Loading...</li></ul></div>');add_topics_to_mini_inbox()});
$("#minimize_mini_inbox_controls").live("click",function(a){a.preventDefault();$("#mini_inbox_box").hasClass("waiting_inbox")?$("#mini_inbox_box").html('<div class="getinbox empty_inbox big_inbox_document_icon" id="get_inbox"></div>'):$("#mini_inbox_box").html('<div class="getinbox empty_inbox big_inbox_icon" id="get_inbox"></div>')});
function new_item_transaction(){try{var a=Buleys.db.transaction(["items"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("items")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version,10)+1);a.onsuccess=function(){Buleys.db.objectStore=Buleys.db.createObjectStore("items",{keyPath:"link"},false);Buleys.db.objectStore.createIndex("author","author",{unique:false});Buleys.db.objectStore.createIndex("published_date","published_date",
{unique:false});Buleys.db.objectStore.createIndex("index_date","index_date",{unique:false});Buleys.db.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function new_item_transaction_old(){try{var a=Buleys.db.transaction(["items"],1,1E3);a.oncomplete=function(){};a.onabort=function(){};Buleys.db.objectStore=a.objectStore("items");console.log("New Transaction",Buleys.db.objectStore)}catch(b){console.log("e",b);console.log("new_item_transaction(): Create object store; db: "+Buleys.db);console.log("Fail!",Buleys.db,typeof Buleys.db.setVersion);if(typeof Buleys.db.setVersion==="function"){a=Buleys.db.setVersion(parseInt(Buleys.db.version,10)+1);a.onsuccess=
function(){console.log("Version changed to ",Buleys.db.version,", so trying to create a database now.");Buleys.db.objectStore=Buleys.db.createObjectStore("items",{keyPath:"link"},false);Buleys.db.objectStore.createIndex("author","author",{unique:false});Buleys.db.objectStore.createIndex("published_date","published_date",{unique:false});Buleys.db.objectStore.createIndex("index_date","index_date",{unique:false});Buleys.db.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}}
function remove_item_from_items_database(a){new_item_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}function get_data_object_for_item(a){return{link:a.link,title:a.title,author:a.author,published_date:(new Date(a.published_date)).getTime(),index_date:(new Date(a.index_date)).getTime(),modified:(new Date).getTime()}}
function add_item_to_results(a){var b=a.link.replace(/[^a-zA-Z0-9-_]+/g,"");jQuery("#"+b).length||jQuery("<li class='item' modified= '"+a.modified+"'  index-date= '"+a.index_date+"' published-date= '"+a.published_date+"' id='"+a.link.replace(/[^a-zA-Z0-9-_]+/g,"")+"'><a href='"+a.link+"'>"+a.title+"</a><a class='examine_item magnify_icon' href='#'></a></li>").hide().prependTo("#results").fadeIn("slow")}
function add_item_to_items_database(a){var b=get_data_object_for_item(a);new_deleted_transaction();var c=Buleys.objectStore.get(a.link);c.onsuccess=function(){if(typeof c.result==="undefined"){new_item_transaction();var d=Buleys.objectStore.add(b);d.onsuccess=function(){if(a.categories.length>1&&typeof a.categories.type==="undefined"&&typeof a.categories.key==="undefined")$.each(a.categories,function(f,e){if(Buleys.view.type==="home"||typeof Buleys.view.slug==="undefined"||typeof Buleys.view.slug===
""||e.key!==null&&typeof e.key!=="null"&&e.key===Buleys.view.slug)if(typeof page==="undefined"||page!=="favorites"&&page!=="seen"&&page!=="read"&&page!=="archive")add_item_to_results(get_data_object_for_item(a))});else if(a.categories.length===1&&typeof a.categories.key!=="undefined")if(Buleys.view.type==="home"||a.categories[0].key.toLowerCase()===Buleys.view.slug&&a.categories[0].type.toLowerCase()===type)add_item_to_results(get_data_object_for_item(a))};d.onerror=function(){}}};c.onerror=function(){}}
function check_if_item_is_read(a){new_status_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){typeof b.result!=="undefined"?jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("read"):jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("unread")};b.onerror=function(){}}
function get_item_raw_no_trash(a){if(typeof a!=="undefined"){new_item_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!=="undefined")if(jQuery("#"+b.result.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0){add_item_to_results(b.result);check_if_item_is_favorited(b.result.link);check_if_item_is_read(b.result.link);check_if_item_is_seen(b.result.link)}};b.onerror=function(){if(jQuery("#"+b.result.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0){add_item_to_results(b.result);
check_if_item_is_favorited(b.result.link);check_if_item_is_read(b.result.link);check_if_item_is_seen(b.result.link)}}}}
function get_item(a){if(typeof a!=="undefined"){new_deleted_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result==="undefined"){new_item_transaction();var c=Buleys.objectStore.get(a);c.onsuccess=function(){if(typeof c.result!=="undefined"){new_archived_transaction();var d=Buleys.objectStore.get(a);d.onsuccess=function(){typeof d.result==="undefined"&&get_item_raw_no_trash(c.result.link)};d.onerror=function(){if(jQuery("#"+c.result.link.replace(/[^a-zA-Z0-9-_]+/g,
"")).length<=0){add_item_to_results(c.result);check_if_item_is_favorited(c.result.link);check_if_item_is_read(c.result.link);check_if_item_is_seen(c.result.link)}}}};c.onerror=function(){}}};b.onerror=function(){}}}
function get_item_raw(a){if(typeof a!=="undefined"){new_item_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!=="undefined"){new_deleted_transaction();var c=Buleys.objectStore.get(a);c.onsuccess=function(){if(typeof c.result==="undefined")if(jQuery("#"+b.result.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0){add_item_to_results(b.result);check_if_item_is_favorited(b.result.link);check_if_item_is_read(b.result.link);check_if_item_is_seen(b.result.link)}}}};b.onerror=
function(){}}}
function get_items(a,b,c,d){var f=0;f=typeof c==="undefined"?0:parseInt(c,10);c=0;c=typeof d==="undefined"?(new Date).getTime():parseInt(d,10);if(typeof b==="undefined"||a==="home"){Buleys.keyRange=new IDBKeyRange.bound(f,c,true,false);console.log("Range Defined",Buleys.db,Buleys.keyRange);Buleys.db.onCursor=function(g){console.log("get_items callback objectStore",g,Buleys.db.objectStore);new_item_transaction();Buleys.db.indexItem=Buleys.db.objectStore.index("published_date");var h=Buleys.db.indexItem.openCursor(Buleys.keyRange);
h.onsuccess=function(){if(typeof h.result!=="undefined"){Buleys.cursor=h.result;console.log("get_items() cursor value ",Buleys.cursor.value);get_item(Buleys.cursor.value.link);if(typeof Buleys.cursor["continue"]==="function")Buleys.cursor["continue"]()}};h.onerror=function(){}};Buleys.db.onCursor(function(){})}else{new_categories_transaction();Buleys.index=Buleys.objectStore.index("slug");console.log("get_items db stuff ",Buleys.db,Buleys.index);var e=Buleys.index.getAll(b);e.onsuccess=function(){var g=
e.result;if(g)g.length>1?jQuery.each(g,function(h,i){console.log("get_item(): ",i.link);get_item(i.link)}):get_item(g.link)};e.onerror=function(){}}}
function get_item_for_console(a){new_item_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!=="undefined"&&typeof b.result.id==="string"){var c="<div id='console_"+b.result.id.replace(/[^a-zA-Z0-9-_]+/g,"")+"'>";c=c+"<h3><a href='"+b.result.id+"'>"+b.result.title+"</a></h3>";c=c+"<p>"+b.result.author+"</p>";c+="</div>";send_to_console(c)}};b.onerror=function(){}}
function fire_off_request(){$.ajax({url:typeof Buleys.view.type==="undefined"||Buleys.view.type===""?"/feedback/index.php":"http://static.buleys.com/js/collections/"+Buleys.view.type+"/"+Buleys.view.slug+".js",dataType:"jsonp",jsonpCallback:"load_collection",error:function(){$("#index").html("<li class='item'>No results.</li>")},success:function(a){Buleys.view.slug=a.info.key;Buleys.view.type=a.info.type;populate_and_maybe_setup_indexeddbs(a.items);get_data_for_items(a.items);add_items(a.items,a.info.type,
a.info.key);load_page_title_info(a.info);add_or_update_topic(a.info.type+"_"+a.info.key,a.info)}})}function get_data_for_items(a){$.each(a,function(b,c){get_item(c.link)})}function add_items(a,b,c){$.each(a,function(d,f){add_item_if_new(f,b,c)})}function populate_and_maybe_setup_indexeddbs(a){$.each(a,function(b,c){add_item_if_doesnt_exist(c)})}
function add_item_if_new(a,b,c){new_item_transaction();var d=Buleys.objectStore.get(a.link);d.onsuccess=function(f){if(typeof f.target.result==="undefined"){new_deleted_transaction();Buleys.objectStore.get(a.link).onsuccess=function(e){if(typeof e.target.result==="undefined"){add_item_to_items_database(a);add_categories_to_categories_database(a.link,a.categories);send_to_console("<p>Added: <a href='"+a.link+"'>"+a.title+"</a></p>");e=b.toLowerCase()+"_"+c.toLowerCase();if(typeof Buleys.queues.new_items[e]===
"undefined")Buleys.queues.new_items[e]=0;Buleys.queues.new_items[e]+=1}};d.onerror=function(){}}};d.onerror=function(){}}function add_item_if_doesnt_exist_old(a){new_item_transaction();var b=Buleys.objectStore.get(a.link);b.onsuccess=function(){if(typeof b.result==="undefined"){add_item_to_items_database(a);add_categories_to_categories_database(a.link,a.categories)}};b.onerror=function(){}}
function add_item_if_doesnt_exist(a){new_item_transaction();var b=Buleys.objectStore.get(a.link);b.onsuccess=function(){if(typeof b.result==="undefined"){add_item_to_items_database(a);add_categories_to_categories_database(a.link,a.categories);a.categories.length>0&&$.each(a.categories,function(c,d){if(Buleys.view.type==="home"||typeof Buleys.view.slug==="undefined"||typeof Buleys.view.slug===""||d.key!==null&&typeof d.key!=="null"&&d.key===Buleys.view.slug&&d.type===Buleys.view.type){add_item_to_results(get_data_object_for_item(a));
check_if_item_is_favorited(a.link);check_if_item_is_read(a.link);check_if_item_is_seen(a.link)}})}};b.onerror=function(){}};
function post_feedback(a,b,c,d){$.post("/feedback/index.php",{event:a,item:b,context:c,type:d},function(){},dataType="json")};
$("#view_seen").live("click",function(b){b.preventDefault();console.log(location.pathname);console.log("view_seen clicked");b={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";c=typeof Buleys.view.page!="undefined"&&Buleys.view.page!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/seen":typeof Buleys.view.slug!="undefined"&&Buleys.view.slug!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/seen":"http://buleys.com/seen";
history.pushState(b,"view_seen",c);reload_results()});
$("#view_unseen").live("click",function(b){b.preventDefault();console.log(location.pathname);console.log("view_unseen clicked");b={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";c=typeof Buleys.view.page!="undefined"&&Buleys.view.page!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/unseen":typeof Buleys.view.slug!="undefined"&&Buleys.view.slug!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/unseen":"http://buleys.com/unseen";
history.pushState(b,"view_unseen",c);reload_results()});
$("#view_read").live("click",function(b){b.preventDefault();console.log(location.pathname);console.log("view_read clicked");b={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";c=typeof Buleys.view.page!="undefined"&&Buleys.view.page!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/read":typeof Buleys.view.slug!="undefined"&&Buleys.view.slug!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/read":"http://buleys.com/read";
history.pushState(b,"view_read",c);reload_results()});
$("#view_unread").live("click",function(b){b.preventDefault();console.log(location.pathname);console.log("view_unread clicked");b={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";c=typeof Buleys.view.page!="undefined"&&Buleys.view.page!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/unread":typeof Buleys.view.slug!="undefined"&&Buleys.view.slug!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/unread":"http://buleys.com/unread";
history.pushState(b,"view_unread",c);reload_results()});
$("#view_trash").live("click",function(b){b.preventDefault();console.log(location.pathname);console.log("view_trash clicked");b={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";c=typeof Buleys.view.page!="undefined"&&Buleys.view.page!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/trash":typeof Buleys.view.slug!="undefined"&&Buleys.view.slug!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/trash":"http://buleys.com/trash";
history.pushState(b,"view_trash",c);reload_results()});
$("#view_archive").live("click",function(b){b.preventDefault();console.log(location.pathname);console.log("view_archive clicked");b={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";c=typeof Buleys.view.page!="undefined"&&Buleys.view.page!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/archive":typeof Buleys.view.slug!="undefined"&&Buleys.view.slug!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/archive":"http://buleys.com/archive";
history.pushState(b,"view_archive",c);reload_results()});
$("#view_index").live("click",function(b){b.preventDefault();console.log(location.pathname);console.log("view_index clicked");b={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";if(typeof Buleys.view.slug!="undefined"&&Buleys.view.slug!="")c="http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/";else if(typeof Buleys.view.type!="undefined"&&Buleys.view.type!="")c="http://buleys.com/"+Buleys.view.type+"/";history.pushState(b,"view_index",
c);reload_results()});$("#view_home").live("click",function(b){b.preventDefault();console.log(location.pathname);console.log("view_home clicked");b={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";c="http://buleys.com/"+Buleys.view.type+"/";history.pushState(b,"view_home",c);reload_results()});
$("#view_settings").live("click",function(b){b.preventDefault();console.log(location.pathname);console.log("view_home clicked");b={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};history.pushState(b,"view_settings","http://buleys.com/settings/");reload_results()});$(".close_item_preview").live("click",function(b){b.preventDefault();jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})});
$(".sidebar_close_link").live("click",function(b){b.preventDefault();jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})});$("#close_all").live("click",function(b){b.preventDefault();jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})});
$(".mark_item_as_unread").live("click",function(b){b.preventDefault();$(this).removeClass("empty_star_icon").addClass("star_icon");$(this).removeClass("unfav_link");$(this).addClass("fav_link");b=jQuery("#"+jQuery(this).attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));if(b.hasClass("read")){b.removeClass("read");b.addClass("unread")}remove_item_from_read_database($(this).attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>marked as unread</p>");setTimeout("fade_console_message()",1E3)});
$("#mark_all_items_as_read").live("click",function(b){b.preventDefault();jQuery.each(jQuery(".unread"),function(c,a){var d=jQuery("#"+jQuery(a).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));if(d.hasClass("unread")){d.removeClass("unread");d.addClass("read")}mark_item_as_read(jQuery(a).children("a").attr("href"),Buleys.view.slug,Buleys.view.type)})});
$("#mark_seen").live("click",function(b){b.preventDefault();if(is_in_cursor_mode()){jQuery(".cursor").removeClass("seen");jQuery(".cursor").addClass("unseen");jQuery(item_to_mark).attr("status",jQuery(item_to_mark).attr("status")+" unseen");jQuery(item_to_mark).attr("status",jQuery(item_to_mark).attr("status").replace(" seen",""));mark_item_as_unseen(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type)}else jQuery.each(jQuery(".selected"),function(c,a){jQuery(a).removeClass("unseen");
jQuery(a).addClass("seen");typeof jQuery(a).attr("status")!=="undefined"&&jQuery(a).attr("status",jQuery(a).attr("status").replace(" unseen",""));jQuery(a).attr("status",jQuery(a).attr("status")+" seen");mark_item_as_seen(jQuery(a).children("a").attr("href"),Buleys.view.slug,Buleys.view.type)})});
$("#mark_unseen").live("click",function(b){b.preventDefault();if(is_in_cursor_mode()){jQuery(".cursor").removeClass("seen");jQuery(".cursor").addClass("unseen");jQuery(item_to_mark).attr("status",jQuery(item_to_mark).attr("status")+" seen");jQuery(item_to_mark).attr("status",jQuery(item_to_mark).attr("status").replace(" unseen",""));mark_item_as_unseen(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type)}else jQuery.each(jQuery(".selected"),function(c,a){jQuery(a).removeClass("seen");
jQuery(a).addClass("unseen");var d=jQuery(a).attr("status");typeof d!=="undefined"&&jQuery(a).attr("status",d.replace(" seen",""));jQuery(a).attr("status",jQuery(a).attr("status")+" unseen");mark_item_as_unseen(jQuery(a).children("a").attr("href"),Buleys.view.slug,Buleys.view.type)})});
$("#select_all").live("click",function(b){b.preventDefault();$.each($("#results > li"),function(c,a){if(!jQuery(a).hasClass("selected")){jQuery(a).addClass("selected");jQuery(a).attr("status",jQuery(a).attr("status")+" selected")}})});
$("#select_none").live("click",function(b){b.preventDefault();if(is_in_cursor_mode()){jQuery(".cursor").removeClass("selected");jQuery(".cursor").attr("status",jQuery(item_to_mark).attr("status").replace(" selected",""))}else $.each($(".selected"),function(c,a){jQuery(a).removeClass("selected");jQuery(a).attr("status",jQuery(a).attr("status").replace(" selected",""))})});
$("#select_inverse").live("click",function(b){b.preventDefault();if(is_in_cursor_mode())if(jQuery(".cursor").hasClass("selected")){jQuery(".cursor").removeClass("selected");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" selected",""))}else{jQuery(".cursor").addClass("selected");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status")+" selected")}else $.each($("#results li"),function(c,a){if(jQuery(a).hasClass("selected")){jQuery(a).removeClass("selected");jQuery(a).attr("status",
jQuery(a).attr("status").replace(" selected",""))}else{jQuery(a).addClass("selected");jQuery(a).attr("status",jQuery(a).attr("status")+" selected")}})});
$("#view_favorites").live("click",function(b){b.preventDefault();console.log(location.pathname);console.log("view_favorites clicked");b={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};var c="";c=typeof Buleys.view.page!="undefined"&&Buleys.view.page!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/favorites":typeof Buleys.view.slug!="undefined"&&Buleys.view.slug!=""?"http://buleys.com/"+Buleys.view.type+"/"+Buleys.view.slug+"/favorites":
"http://buleys.com/favorites";history.pushState(b,"view_favorites",c);reload_results()});$("#deselect_seen").live("click",function(b){b.preventDefault();$.each($(".seen"),function(c,a){jQuery(a).removeClass("selected");jQuery(a).attr("status",jQuery(a).attr("status").replace(" selected",""))})});$("#deselect_unseen").live("click",function(b){b.preventDefault();$.each($(".unseen"),function(c,a){jQuery(a).removeClass("selected");jQuery(a).attr("status",jQuery(a).attr("status").replace(" selected",""))})});
$("#deselect_read").live("click",function(b){b.preventDefault();$.each($(".read"),function(c,a){jQuery(a).removeClass("selected");jQuery(a).attr("status",jQuery(a).attr("status").replace(" selected",""))})});$("#deselect_unread").live("click",function(b){b.preventDefault();$.each($(".unread"),function(c,a){jQuery(a).removeClass("selected");jQuery(a).attr("status",jQuery(a).attr("status").replace(" selected",""))})});
$("#deselect_archived").live("click",function(b){b.preventDefault();$.each($(".archived"),function(c,a){jQuery(a).removeClass("selected");jQuery(a).attr("status",jQuery(a).attr("status").replace(" selected",""))})});$("#deselect_unarchived").live("click",function(b){b.preventDefault();$.each($(".unarchived"),function(c,a){jQuery(a).removeClass("selected");jQuery(a).attr("status",jQuery(a).attr("status").replace(" selected",""))})});
$("#deselect_unseen").live("click",function(b){b.preventDefault();$.each($(".unseen"),function(c,a){jQuery(a).removeClass("selected");jQuery(a).attr("status",jQuery(a).attr("status").replace(" selected",""))})});$("#deselect_unread").live("click",function(b){b.preventDefault();$.each($(".unread"),function(c,a){jQuery(a).removeClass("selected");jQuery(a).attr("status",jQuery(a).attr("status").replace(" selected",""))})});
$("#deselect_unarchived").live("click",function(b){b.preventDefault();$.each($(".unarchived"),function(c,a){jQuery(a).removeClass("selected");jQuery(a).attr("status",jQuery(a).attr("status").replace(" selected",""))})});$("#select_seen").live("click",function(b){b.preventDefault();$.each($(".seen"),function(c,a){jQuery(a).addClass("selected");jQuery(a).attr("status",jQuery(a).attr("status")+" selected")})});
$("#select_unseen").live("click",function(b){b.preventDefault();$.each($(".unseen"),function(c,a){jQuery(a).addClass("selected");jQuery(a).attr("status",jQuery(a).attr("status")+" selected")})});$("#select_read").live("click",function(b){b.preventDefault();$.each($(".read"),function(c,a){jQuery(a).addClass("selected");jQuery(a).attr("status",jQuery(a).attr("status")+" selected")})});
$("#select_unread").live("click",function(b){b.preventDefault();$.each($(".unread"),function(c,a){jQuery(a).addClass("selected");jQuery(a).attr("status",jQuery(a).attr("status")+" selected")})});$("#select_archived").live("click",function(b){b.preventDefault();$.each($(".archived"),function(c,a){jQuery(a).addClass("selected");jQuery(a).attr("status",jQuery(a).attr("status")+" selected")})});
$("#select_unarchived").live("click",function(b){b.preventDefault();$.each($(".unarchived"),function(c,a){jQuery(a).addClass("selected");jQuery(a).attr("status",jQuery(a).attr("status")+" selected")})});
$("#delete").live("click",function(b){b.preventDefault();if(is_in_cursor_mode()){delete_item(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);if(jQuery(".cursor").next().length>0)jQuery(".cursor").next().addClass("cursor").prev().remove();else{jQuery(".cursor").remove();jQuery("#results li:first").addClass("cursor")}}else $.each($(".selected"),function(c,a){delete_item(jQuery(a).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(a).remove()})});
$("#select").live("click",function(b){b.preventDefault();is_in_cursor_mode()?$.each($(".cursor"),function(c,a){jQuery(a).addClass("selected");jQuery(a).attr("status",jQuery(a).attr("status")+" selected")}):$.each($(".selected"),function(c,a){jQuery(a).addClass("selected");jQuery(a).attr("status",jQuery(a).attr("status")+" selected")})});
$("#deselect").live("click",function(b){b.preventDefault();is_in_cursor_mode()?$.each($(".cursor"),function(c,a){jQuery(a).removeClass("selected");jQuery(a).attr("status",jQuery(a).attr("status").replace(" selected",""))}):$.each($(".selected"),function(c,a){jQuery(a).removeClass("selected");jQuery(a).attr("status",jQuery(a).attr("status").replace(" selected",""))})});
$("#archive").live("click",function(b){b.preventDefault();if(is_in_cursor_mode()){archive_item(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);if(jQuery(".cursor").next().length>0){jQuery(".cursor").next().addClass("cursor").prev().remove();jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" cursor",""))}else{jQuery(".cursor").remove();jQuery("#results li:first").addClass("cursor");jQuery("#results li:first").attr("status",jQuery(item_to_mark).attr("status").replace(" cursor",
""))}}else $.each($(".selected"),function(c,a){archive_item(jQuery(a).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);Buleys.view.page!=="favorites"&&Buleys.view.page!=="archive"&&jQuery(a).remove()})});
$("#read").live("click",function(b){b.preventDefault();if(is_in_cursor_mode()){window.open(jQuery(".cursor > a").attr("href"),jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));mark_item_as_read(jQuery(".cursor > a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(".cursor").addClass("read");jQuery(".cursor").removeClass("unread");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status")+" read");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" unread",
""))}else $.each($(".selected"),function(c,a){window.open(jQuery(a).children("a").attr("href"),jQuery(a).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));mark_item_as_read(jQuery(a).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(a).addClass("read");jQuery(a).removeClass("unread");jQuery(a).attr("status",jQuery(a).attr("status")+" read");jQuery(a).attr("status",jQuery(a).attr("status").replace(" unread",""))})});
$("#unarchive").live("click",function(b){b.preventDefault();if(is_in_cursor_mode()){unarchive_item(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(".cursor").removeClass("archived").addClass(".unarchived");Buleys.view.page=="archive"&&jQuery(".cursor").remove()}else $.each($(".selected"),function(c,a){unarchive_item(jQuery(a).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);Buleys.view.page=="archive"&&jQuery(a).remove()})});
$("#mark_read").live("click",function(b){b.preventDefault();if(is_in_cursor_mode()){mark_item_as_read(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(".cursor").addClass("read");jQuery(".cursor").removeClass("unread");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status")+" read");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" unread",""))}else $.each($(".selected"),function(c,a){mark_item_as_read(jQuery(a).children("a").attr("href"),
Buleys.view.slug,Buleys.view.type);jQuery(a).addClass("read");jQuery(a).removeClass("unread");jQuery(a).attr("status",jQuery(a).attr("status")+" read");jQuery(a).attr("status",jQuery(a).attr("status").replace(" unread",""))})});
$("#mark_unread").live("click",function(b){b.preventDefault();if(is_in_cursor_mode()){remove_item_from_read_database(jQuery(".cursor").children("a").attr("href"),Buleys.view.slug,Buleys.view.type);jQuery(".cursor").addClass("unread");jQuery(".cursor").removeClass("read");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status")+" unread");jQuery(".cursor").attr("status",jQuery(".cursor").attr("status").replace(" read",""))}else $.each($(".selected"),function(c,a){remove_item_from_read_database(jQuery(a).children("a").attr("href"),
Buleys.view.slug,Buleys.view.type);jQuery(a).addClass("unread");jQuery(a).removeClass("read");jQuery(a).attr("status",jQuery(a).attr("status")+" read");jQuery(a).attr("status",jQuery(a).attr("status").replace(" unread",""))})});
$("#mark_all_items_as_unread").live("click",function(b){b.preventDefault();jQuery.each(jQuery(".read"),function(c,a){var d=jQuery("#"+jQuery(a).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,""));if(d.hasClass("read")){d.removeClass("read");d.addClass("unread");jQuery(d).attr("status",jQuery(a).attr("status")+" unread");jQuery(d).attr("status",jQuery(a).attr("status").replace(" read",""))}remove_item_from_read_database(jQuery(a).children("a").attr("href"),Buleys.view.slug,Buleys.view.type)})});
jQuery("#console_wrapper").stop(true).animate({opacity:0},0,function(){});jQuery("#overlay").stop(true).animate({opacity:0},0,function(){}).html("");$(".headline a").live("click",function(){var b=$(this).attr("href");c={event:"click",item:$(this).attr("href"),page:slug};var c;c={event:"clickthrough",item:$(this).attr("href"),context:Buleys.view.slug,type:Buleys.view.type};$.post("/feedback/index.php",c,dataType="json",function(){new_window=window.open(b,click_window)})});
$(".sidebar_headline a").live("click",function(){var b=$(this).attr("href"),c;c={event:"click",item:$(this).attr("href"),context:Buleys.view.slug,type:Buleys.view.type};$.post("/feedback/index.php",c,dataType="json",function(){new_window=window.open(b,click_window)})});
jQuery("#results li").live("mouseenter",function(){var b=jQuery(this);if(b.hasClass("unseen")){b.removeClass("unseen");b.addClass("seen")}url_to_preview=b.children("a").attr("href");mark_item_as_seen(url_to_preview,Buleys.view.slug,Buleys.view.type)});
jQuery("#preview_item").live("click",function(b){b.preventDefault();if(!is_in_cursor_mode()&&$(".selected").length>0)$.each($(".selected"),function(c,a){var d=jQuery(a);if(d.hasClass("unseen")){d.removeClass("unseen");d.addClass("seen")}url_to_preview=d.children("a").attr("href");mark_item_as_seen(url_to_preview,Buleys.view.slug,Buleys.view.type);load_item_to_overlay(url_to_preview);jQuery("#overlay").stop(true).animate({opacity:1},100,function(){})});else if($(".selected").length>0){b=jQuery(".cursor");
if(b.hasClass("unseen")){b.removeClass("unseen");b.addClass("seen")}url_to_preview=b.children("a").attr("href");mark_item_as_seen(url_to_preview,Buleys.view.slug,Buleys.view.type);load_item_to_overlay(url_to_preview);jQuery("#overlay").stop(true).animate({opacity:1},100,function(){})}});
$("#close_item_preview").live("click",function(b){b.preventDefault();if(is_in_cursor_mode()){b=jQuery(".cursor");if(b.hasClass("unseen")){b.removeClass("unseen");b.addClass("seen")}url_to_preview=b.children("a").attr("href");b="#overlay_"+url_to_preview.replace(/[^a-zA-Z0-9-_]+/g,"");jQuery(b).length>0&&jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})}else $(".selected").length>0?$.each($(".selected"),function(c,a){var d=jQuery(a),e=d.children("a").attr("href");
if(d.hasClass("unread")){d.removeClass("unread");d.addClass("read")}d="#overlay_"+e.replace(/[^a-zA-Z0-9-_]+/g,"");if(jQuery(d).length>0){d=jQuery(a);if(d.hasClass("unseen")){d.removeClass("unseen");d.addClass("seen")}e=d.children("a").attr("href");jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})}}):jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")})});
jQuery("#results li:not(.favorite_status)").live("click",function(){var b=jQuery(this),c=b.children("a").attr("href");if(b.hasClass("unread")){b.removeClass("unread");b.addClass("read")}if(jQuery(this).hasClass("star_icon")===false&&jQuery(this).hasClass("empty_star_icon")===false){var a="#overlay_"+c.replace(/[^a-zA-Z0-9-_]+/g,"");if(jQuery(a).length>0&&jQuery(b).hasClass("selected"))jQuery("#overlay").stop(true).animate({opacity:0},500,function(){jQuery("#overlay").html("")});else if(!jQuery(b).hasClass("selected")){jQuery("#overlay").stop(true).animate({opacity:1},
100,function(){});load_item_to_overlay(c)}b.addClass("selected")}});$(".selected").live("click",function(){$(this).removeClass("selected")});$("#results li").live("mouseleave",function(){});
function createNotificationInstance(a){if(a.notificationType=="simple")return window.webkitNotifications.createNotification("fire.png","Notification Title","Notification content...");else if(a.notificationType=="html")return window.webkitNotifications.createHTMLNotification("http://someurl.com")}
function send_notification_to_desktop(){if(window.webkitNotifications.checkPermission()==0){notification_test=createNotificationInstance({notificationType:"html"});notification_test.ondisplay=function(){};notification_test.onclose=function(){};notification_test.show()}else window.webkitNotifications.requestPermission()}
function notify_user_of_new_items(a,b,c){if(Buleys.view.type===b&&c===Buleys.view.slug||Buleys.view.type=="home"||typeof Buleys.view.type==="undefined")flash_console("<p>"+a+" new items added to "+b+" "+c+" </p>")}
function do_pending_crawl(){var a=Buleys.queues.pending_crawls.splice(0,1),b=a[0].split("_",1),c=b[0],d=a[0].replace(b[0]+"_","");$.ajax({url:"http://static.buleys.com/js/collections/"+c+"/"+d+".js",dataType:"jsonp",jsonpCallback:"load_collection",error:function(){$("#index").html("<li class='item'>No results.</li>")},success:function(e){add_items(e.items,c,d)}})}function check_for_waiting_items(){notify_user_of_new_items(Buleys.queues.new_items,type_to_get,company_to_get)};
function send_text_to_overlay(a){jQuery("#overlay").html("").append(a)}function send_to_overlay(a){send_text_to_overlay(a);jQuery("#overlay").stop(true).animate({opacity:1},500)}function hide_overlay(){jQuery("#overlay").stop(true).animate({opacity:0},500);jQuery("#overlay").html("").removeClass()}function load_item_to_overlay(a){get_item_for_overlay(a);check_if_item_is_favorited_for_overlay(a);check_item_vote_status_for_overlay(a);get_item_categories_for_overlay(a)}
function get_item_for_overlay(a){new_item_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){if(typeof b.result!=="undefined"&&typeof b.result.link==="string"){var c='<div id="overlay_right"><div class="sidebar_close_link"><div class="close_sidebar_link cross_icon" id="'+a+"\"></div></div><div id='overlay_"+a.replace(/[^a-zA-Z0-9-_]+/g,"")+"'><a href='"+b.result.link+"' class='overlay_headline'>"+b.result.title+"</a></div></div><div id='overlay_left'></div>";send_to_overlay(c)}};
b.onerror=function(){}};
function save_queues(){add_or_update_queue("new_items",Buleys.queues.new_items);add_or_update_queue("pending_crawls",Buleys.queues.pending_crawls)}function get_queues(){try{new_queue_transaction();Buleys.index=Buleys.objectStore.index("queue_name");var a=Buleys.index.getAll();a.onsuccess=function(){var b=a.result;b&&b.length>=0&&jQuery.each(b,function(){})};request.onerror=function(){}}catch(c){}}
function remove_queue(a){new_queue_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}function load_all_queues_into_dom(){new_queue_transaction();var a=Buleys.objectStore.getAll();a.onsuccess=function(){typeof a.result!=="undefined"&&a.result.length>=0&&jQuery.each(a.result,function(c,b){Buleys.queues[b.queue_name]=b.queue_value})};a.onerror=function(){}}
function add_or_update_queue(a,c){new_queue_transaction();if(typeof c=="undefined")c="";var b=Buleys.objectStore.get(a);b.onsuccess=function(){typeof b.result=="undefined"?add_queue_to_queues_database(a,c):update_queue_in_queues_database(a,c)};b.onerror=function(){}}function add_queue_to_queues_database(a,c){new_queue_transaction();var b={queue_name:a,queue_value:c,modified:(new Date).getTime()},d=Buleys.objectStore.add(b);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}
function update_queue_in_queues_database(a,c){new_queue_transaction();var b={queue_name:a,queue_value:c,modified:(new Date).getTime()},d=Buleys.objectStore.put(b);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}
function new_queue_transaction(){try{var a=Buleys.db.transaction(["queue"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("queue")}catch(c){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("queue",{keyPath:"queue_name"},true);Buleys.objectStore.createIndex("queue_value","queue_value",{unique:false})};a.onerror=function(){}}};
function get_read(a,c,d,b,e){if(typeof e=="undefined")e=false;typeof d=="undefined"||d==null||parseInt(d);typeof b=="undefined"||b==null?(new Date).getTime():parseInt(b);new_categories_transaction();Buleys.index=Buleys.objectStore.index("slug");var i=Buleys.index.getAll(c);i.onsuccess=function(){var f=i.result;if(f)f.length>1?jQuery.each(f,function(j,g){new_status_transaction();var h=Buleys.objectStore.get(g.link);h.onsuccess=function(){if(typeof h.result!=="undefined"&&e!==true)jQuery("#"+g.link.replace(/[^a-zA-Z0-9-_]+/g,
"")).length<=0&&get_item_raw(h.result.link);else typeof h.result=="undefined"&&e==true&&jQuery("#"+g.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw(g.link)}}):get_item(f.link)};i.onerror=function(){}}function mark_item_as_read(a,c,d){new_status_transaction();a={link:a,topic_slug:c,topic_type:d,modified:(new Date).getTime()};var b=Buleys.objectStore.add(a);b.onsuccess=function(){Buleys.objectId=b.result};b.onerror=function(){}}
function new_status_transaction(){try{var a=Buleys.db.transaction(["status"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("status")}catch(c){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("status",{keyPath:"link"},true);Buleys.objectStore.createIndex("topic_slug","topic_slug",{unique:false});Buleys.objectStore.createIndex("topic_type","topic_type",{unique:false});
Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}function remove_item_from_read_database(a){new_status_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
function add_item_to_readstatus_database(a,c){if(typeof c=="undefined")c="unread";new_status_transaction();var d={link:a.link,status:c,modified:(new Date).getTime()},b=Buleys.objectStore.add(d);b.onsuccess=function(){Buleys.objectId=b.result};b.onerror=function(){}};
function new_seen_transaction(){try{var a=Buleys.db.transaction(["seen"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("seen")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("seen",{keyPath:"link"},true);Buleys.objectStore.createIndex("topic_slug","topic_slug",{unique:false});Buleys.objectStore.createIndex("topic_type","topic_type",{unique:false});
Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function get_seen(a,b,d,c,e){if(typeof e=="undefined")e=false;typeof d=="undefined"||d==null||parseInt(d);typeof c=="undefined"||c==null?(new Date).getTime():parseInt(c);new_categories_transaction();Buleys.index=Buleys.objectStore.index("slug");var i=Buleys.index.getAll(b);i.onsuccess=function(){var f=i.result;if(f)f.length>1?jQuery.each(f,function(j,g){new_seen_transaction();var h=Buleys.objectStore.get(g.link);h.onsuccess=function(){if(typeof h.result!=="undefined"&&e!==true)jQuery("#"+g.link.replace(/[^a-zA-Z0-9-_]+/g,
"")).length<=0&&get_item(h.result.link);else typeof h.result=="undefined"&&e==true&&jQuery("#"+g.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item(g.link)}}):get_item(f.link)};i.onerror=function(){}}function mark_item_as_seen(a,b,d){new_seen_transaction();a={link:a,topic_slug:b,topic_type:d,modified:(new Date).getTime()};var c=Buleys.objectStore.add(a);c.onsuccess=function(){Buleys.objectId=c.result};c.onerror=function(){}}
function mark_item_as_unseen(a){new_seen_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}function add_item_as_seen(a){new_seen_transaction();a={link:a,modified:(new Date).getTime()};var b=Buleys.objectStore.add(a);b.onsuccess=function(){Buleys.objectId=b.result};b.onerror=function(){}}
function check_if_item_is_seen(a){new_seen_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){checker=b;typeof b.result!="undefined"?jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("seen"):jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("unseen")};b.onerror=function(){}}
function add_item_to_seens_database(a,b,d){new_seen_transaction();a={item_link:a,topic_slug:b,topic_type:d,modified:(new Date).getTime()};var c=Buleys.objectStore.add(a);c.onsuccess=function(){Buleys.objectId=c.result};c.onerror=function(){}}function remove_item_from_seens_database(a){new_seen_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}};
function new_settings_transaction(){try{var a=Buleys.db.transaction(["settings"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("settings")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("settings",{keyPath:"option_name"},true);Buleys.objectStore.createIndex("option_value","option_value",{unique:false})};a.onerror=function(){}}}
function get_settings(){console.log("get_settings(): ");Buleys.view.loaded="settings";get_settings();var a=get_local_storage("session_id");typeof a=="undefined"||a==null||a==""?jQuery("#main").append('<div id="account"><input id="password" type="password" value="p4s5w0rd" name="password" /><br/><br/><a href="#" id="update_settings_button" class="update_settings">Update</a> or <a href="#" id="clear_form_button" class="clear_form">Clear</a></div></div></div>'):jQuery("#main").append("<div id='account'>Already logged in with session id <code>"+
a+"</code>.<br/><br/><a href='#' class='do_logout'>Click here</a> to log out.</div>");jQuery("#main").append('<input type="number" min="0" max="10" step="2" value="6"> <input type="number" min="0" max="10" step="2" value="6">')}
function get_settings_old(){try{new_settings_transaction();Buleys.index=Buleys.objectStore.index("option_name");var a=Buleys.index.getAll();a.onsuccess=function(){var c=a.result;if(c)if(c.length>=0){Buleys.view.type="settings";jQuery.each(c,function(d,e){console.log("get_settings(): "+e)})}};request.onerror=function(){}}catch(b){}}function save_settings(){add_or_update_setting("hotkeys",Buleys.settings)}
function load_settings_into_dom(){new_settings_transaction();Buleys.index=Buleys.objectStore.index();var a=Buleys.objectStore.getAll();a.onsuccess=function(){new_settings_transaction();var b=a.result;b&&b.length>=0&&jQuery.each(b,function(c,d){Buleys.settings[c]=d})};request.onerror=function(){}}function remove_setting(a){new_settings_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
function load_all_settings_into_dom(){new_settings_transaction();var a=Buleys.objectStore.getAll();a.onsuccess=function(){typeof a.result!=="undefined"&&a.result.length>=0&&jQuery.each(a.result,function(b,c){Buleys.settings[c.option_name]=c.option_value})};a.onerror=function(){}}
function add_or_update_setting(a,b){new_settings_transaction();if(typeof b=="undefined")b="";var c=Buleys.objectStore.get(a);c.onsuccess=function(){typeof c.result=="undefined"?add_setting_to_settings_database(a,b):update_setting_in_settings_database(a,b)};c.onerror=function(){}}
function add_setting_to_settings_database(a,b){new_settings_transaction();var c={option_name:a,option_value:b,modified:(new Date).getTime()},d=Buleys.objectStore.add(c);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}function update_setting_in_settings_database(a,b){new_settings_transaction();var c={option_name:a,option_value:b,modified:(new Date).getTime()},d=Buleys.objectStore.put(c);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}
function get_settings_page(){var a=get_local_storage("session_id");typeof a==="undefined"||a===null?jQuery("#main").append("<div od='login_prompt'>Logged in with session id <code>"+ +"</code>.<br/><br/><a href='#' class='do_logout'>Click here</a> to log out.</div>"):jQuery("#main").append("<div id='configuration_panel'><h3>Configuration</h3><p><input type='range' min='0' max='10' step='2' value='6'></p><p><input type='number' min='0' max='10' step='2' value='6'></p></div>")}
function get_setting_type(a){return get_local_storage("setting_type_"+a)}function set_setting_type(a,b){return set_local_storage("setting_type_"+a,b)}function get_setting(a){return get_local_storage("setting_type_"+a)}function set_setting(a,b){return set_local_storage("setting_type_"+a,b)}
$(".get_settings").live("click",function(a){a.preventDefault();console.log(location.pathname);console.log("view_settings clicked");a={page:Buleys.view.page,slug:Buleys.view.slug,type:Buleys.view.type,time:(new Date).getTime()};console.log(history);history.pushState(a,"settings","http://buleys.com/settings");reload_results()});
function new_social_transaction(){try{var a=Buleys.db.transaction(["social"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("social")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("social",{keyPath:"link"},true);Buleys.objectStore.createIndex("source","source",{unique:false});Buleys.objectStore.createIndex("type","type",{unique:false});Buleys.objectStore.createIndex("modified",
"modified",{unique:false})};a.onerror=function(){}}};
function set_local_storage(a,b){return Buleys.store.setItem(a,b)}function get_local_storage(a){return Buleys.store.getItem(a)}function open_database(){var a=window.indexedDB.open("Buleys-317");a.onsuccess=function(){console.log("!!!",a.result);database_is_open(a.result)};a.onerror=function(){}}function database_is_open(a){Buleys.db=a;console.log("open!",Buleys.db,Buleys.session.database_is_open);Buleys.session.database_is_open=true;load_current_page()};
function getURLSlug(b){if(typeof b!="object")if(b!=null&&b!="undefined"&&b!=""){var a="";b.toLowerCase();a=b.replace(/ - /g,"_");a=a.replace(/ /g,"_");a=a.replace(/\'s/g,"");a=a.replace(/ - /g,"_");a=a.replace(/-/g,"_");a=a.replace("/%20/g","_");a=a.replace(/&/,"and");a=a.replace("/%26/g","and");return a=a.replace(".","")}};
function new_subscriptions_transaction(){try{var a=Buleys.db.transaction(["subscriptions"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("subscriptions")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("subscriptions",{keyPath:"key"},true);Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function add_subscription_to_subscriptions_database(a,b){new_subscriptions_transaction();var c={key:a+"_"+b,modified:(new Date).getTime()},d=Buleys.objectStore.add(c);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}
function get_page_subscription_status(a,b){new_subscriptions_transaction();var c=Buleys.objectStore.get(a+"_"+b);c.onsuccess=function(){typeof c.result=="undefined"||c.result==""?jQuery("#page_subscription_status").html("<div class='subscribe_topic empty_mail_icon'></div>"):jQuery("#page_subscription_status").html("<div class='unsubscribe_topic mail_icon'></div>")};c.onerror=function(){}}
function remove_subscription(a,b){new_subscriptions_transaction();var c=Buleys.objectStore["delete"](a+"_"+b);c.onsuccess=function(){delete Buleys.objectId};c.onerror=function(){}}function add_subscription_if_doesnt_exist(a,b){if(typeof a!=="undefined"&&typeof b!=="undefined"){new_subscriptions_transaction();var c=Buleys.objectStore.get(a+"_"+b);c.onsuccess=function(){typeof c.result=="undefined"&&add_subscription_to_subscriptions_database(a,b)};c.onerror=function(){}}}
function get_subscriptions(){new_subscriptions_transaction();try{new_categories_transaction();Buleys.index=Buleys.objectStore.index("id");var a=Buleys.index.getAll();a.onsuccess=function(){var c=a.result;c&&c.length>=0&&jQuery.each(c,function(){})};request.onerror=function(){}}catch(b){}}
$(".subscribe_topic").live("click",function(a){a.preventDefault();a=$(this).attr("key");var b=$(this).attr("type");if(typeof a=="undefined"||a=="")a=Buleys.view.slug;if(typeof b=="undefined"||b=="")b=Buleys.view.type;add_subscription_if_doesnt_exist(b,a);post_feedback("subscribe","",a,b);$(this).removeClass("empty_mail_icon").addClass("mail_icon");$(this).removeClass("subscribe_topic");$(this).addClass("unsubscribe_topic")});
$(".unsubscribe_topic").live("click",function(a){a.preventDefault();a=$(this).attr("key");var b=$(this).attr("type");if(typeof a=="undefined"||a=="")a=Buleys.view.slug;if(typeof b=="undefined"||b=="")b=Buleys.view.type;remove_subscription(b,a);post_feedback("unsubscribe","",a,b);$(this).removeClass("mail_icon").addClass("empty_mail_icon");$(this).removeClass("unsubscribe_topic");$(this).addClass("subscribe_topic")});
$(window).bind("popstate",function(){console.log(location.pathname);if(Buleys.session.database_is_open){reload_results();Buleys.session.database_is_open=true}});
function load_page_title_info(a){console.log("LOAD PAGE TITLE:",a);typeof a.name!=="undefined"&&jQuery("#page_title").html("<a href='/"+a.type+"/"+a.key+"' class='topic_name'>"+a.name+"</a>");typeof a.subsector!="undefined"&&jQuery("a .sector_name").length>0&&!jQuery("#subtitle_1").indexOf("<a href='/sector/"+getURLSlug(a.subsector).toLowerCase()+"' class='sector_name'>"+a.subsector+"</a>")&&jQuery("#subtitle_1").html("<a href='/sector/"+getURLSlug(a.subsector).toLowerCase()+"' class='sector_name'>"+
a.subsector+"</a>");typeof a.sector!="undefined"&&jQuery("a .subsector_name").length>0&&!jQuery("#subtitle_2").indexOf("<a href='/sector/"+getURLSlug(a.sector).toLowerCase()+"' class='subsector_name'>"+a.sector+"</a>")&&jQuery("#subtitle_2").html("<a href='/sector/"+getURLSlug(a.sector).toLowerCase()+"' class='subsector_name'>"+a.sector+"</a>")}function show_loading(){$("#index").html("<div class='loading'>&nbsp;</div>")}function hide_loading(){$("#index .loading").hide()}
function load_profile_info(){$.post("/feedback/index.php",{method:"get_user_attributes"},function(a){jQuery("#small_profile").show();if(typeof a.display_name!="undefined"&&a.display_name!=null){jQuery("#small_profile").append("<div id='small_profile_image'><a href='/profile/'><img src='http://www.gravatar.com/avatar/"+a.email_hash+"?s=42'></a></div><div><div id='small_profile_display_name'><a href='/profile/'>"+a.display_name+"</a></div></div>");jQuery.each(a,function(b,c){add_or_update_setting(b,
c)})}},dataType="json")}function clear_page(){hide_overlay();jQuery("#right").html("<ul id='results'></ul>");jQuery("#main").html("")}
function load_current_page(){fire_off_request();if(Buleys.view.type=="account"){disable_hotkeys();load_profile_info()}if(Buleys.view.type!=="account"&&Buleys.view.type!=="home"&&Buleys.view.type!=="signin"&&Buleys.view.type!==""&&Buleys.view.type!=="start"&&Buleys.view.type!=="settings"&&Buleys.view.type!=="favorites"&&Buleys.view.type!=="read"&&Buleys.view.type!=="unread"&&Buleys.view.type!=="seen"&&Buleys.view.type!=="unseen"&&Buleys.view.type!=="unarchived"&&Buleys.view.type!=="archived"){enable_hotkeys();
get_page_follow_status(Buleys.view.type,Buleys.view.slug);get_page_subscription_status(Buleys.view.type,Buleys.view.slug);get_page_topic_info(Buleys.view.type,Buleys.view.slug)}if(Buleys.view.type=="settings"||Buleys.view.type=="account"){disable_hotkeys();get_settings_page()}else if(Buleys.view.type=="signin"||"signin"==Buleys.view.type||"login"==Buleys.view.type||"register"==Buleys.view.type||"signup"==Buleys.view.type||"start"==Buleys.view.type){disable_hotkeys();Buleys.view.loaded!="signin"&&
get_signin()}else if(Buleys.view.type=="register"){disable_hotkeys();get_registration()}else if(Buleys.view.type=="confirm"){disable_hotkeys();get_confirmation()}else if(Buleys.view.type=="favorites"||Buleys.view.page=="favorites"||Buleys.view.page=="favs"){enable_hotkeys();get_favorites(Buleys.view.type,Buleys.view.slug)}else if(Buleys.view.type=="archive"||Buleys.view.page=="archive"||Buleys.view.page=="archived"){enable_hotkeys();get_archived(Buleys.view.type,Buleys.view.slug)}else if(Buleys.view.type==
"trash"||Buleys.view.page=="trash"||Buleys.view.page=="trashed"||Buleys.view.page=="deleted"){enable_hotkeys();get_deleted(Buleys.view.type,Buleys.view.slug)}else if(Buleys.view.type=="read"||Buleys.view.page=="read"){enable_hotkeys();get_read(Buleys.view.type,Buleys.view.slug,null,null,false)}else if(Buleys.view.type=="unread"||Buleys.view.page=="unread"){enable_hotkeys();get_read(Buleys.view.type,Buleys.view.slug,null,null,true)}else if(Buleys.view.type=="seen"||Buleys.view.page=="seen"){enable_hotkeys();
get_seen(Buleys.view.type,Buleys.view.slug,null,null,false)}else if(Buleys.view.type=="unseen"||Buleys.view.page=="unseen"){enable_hotkeys();get_seen(Buleys.view.type,Buleys.view.slug,null,null,true)}else{enable_hotkeys();get_items(Buleys.view.type,Buleys.view.slug)}Buleys.view.loaded=Buleys.view.type}function reload_results(){clear_page();set_page_vars();load_current_page()}
function set_page_vars(){console.log("Setting page vars: ",location.pathname);var a=location.pathname;a=a.replace(/^\//,"");a=a.replace(/\/$/,"");a=a.split("/");Buleys.view.type=a[0];Buleys.view.slug=a[1];Buleys.view.page=a[2]}jQuery(".defaulttext").live("click",function(){jQuery(this).val("");jQuery(this).removeClass("defaulttext")});
function minutes_ago(a){a=Date.parse(a);return((new Date).getTime()-a)/1E3/60};
function parse_single_topic(a){a.split("_");Buleys.queues.pending_crawls.slice(0,1);Buleys.queues.pending_crawls.push(a)}
function update_topic_in_topics_database(a,b){new_topics_transaction();b.topic_key=a;b.modified=new Date;if(typeof b.last_updated!="undefined")b.last_updated=new Date(parseInt(b.last_updated)*1E3);if(typeof b.updated!="undefined")b.updated=new Date(parseInt(b.updated)*1E3);if(typeof b.last_attempt!="undefined")b.last_attempt=new Date(parseInt(b.last_attempt)*1E3);var c=Buleys.objectStore.put(b);c.onsuccess=function(){Buleys.objectId=c.result};c.onerror=function(){}}
function get_page_topic_info(a,b){new_topics_transaction();var c=Buleys.objectStore.get(a+"_"+b);c.onsuccess=function(){if(typeof c.result!=="undefined"||c.result.name!=="")load_page_title_info(c.result)};c.onerror=function(){}}function get_topics(){try{new_topics_transaction();Buleys.index=Buleys.objectStore.index("topic_key");var a=Buleys.index.getAll();a.onsuccess=function(){var c=a.result;c&&c.length>=0&&jQuery.each(c,function(){})};request.onerror=function(){}}catch(b){}}
function remove_topic(a){new_topics_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}function add_or_update_topic(a,b){new_topics_transaction();if(typeof b=="undefined")b={};var c=Buleys.objectStore.get(a);c.onsuccess=function(){typeof c.result=="undefined"?add_topic_to_topics_database(a,b):update_topic_in_topics_database(a,b)};c.onerror=function(){}}
function add_topic_to_topics_database(a,b){new_topics_transaction();if(typeof b=="undefined")b={};b.topic_key=a;b.modified=new Date;var c=Buleys.objectStore.add(b);c.onsuccess=function(){Buleys.objectId=c.result};c.onerror=function(){}}
function new_topics_transaction(){try{var a=Buleys.db.transaction(["topic"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("topic")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("topic",{keyPath:"topic_key"},true);Buleys.objectStore.createIndex("slug","slug",{unique:false});Buleys.objectStore.createIndex("type","type",{unique:false});Buleys.objectStore.createIndex("last_updated",
"last_updated",{unique:false})};a.onerror=function(){}}};
function new_deleted_transaction(){try{var a=Buleys.db.transaction(["deleted"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("deleted")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("deleted",{keyPath:"link"},true);Buleys.objectStore.createIndex("topic_slug","topic_slug",{unique:false});Buleys.objectStore.createIndex("topic_type","topic_type",{unique:false});
Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function get_deleted(a,b,c,d,e){if(typeof e=="undefined")e=false;typeof c=="undefined"||c==null||parseInt(c);typeof d=="undefined"||d==null?(new Date).getTime():parseInt(d);new_categories_transaction();Buleys.index=Buleys.objectStore.index("slug");var j=Buleys.index.getAll(b);j.onsuccess=function(){var g=j.result;if(g)g.length>1?jQuery.each(g,function(k,h){new_deleted_transaction();var i=Buleys.objectStore.get(h.link);i.onsuccess=function(){if(typeof i.result!=="undefined"&&e!==true){new_item_transaction();
var f=Buleys.objectStore.get(i.result.link);f.onsuccess=function(){typeof f.result!=="undefined"&&e!==true&&jQuery("#"+h.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw_no_trash(f.result.link)}}else if(typeof i.result=="undefined"&&e==true){new_item_transaction();f=Buleys.objectStore.get(h.link);f.onsuccess=function(){typeof f.result!=="undefined"&&typeof f.result!=="undefined"&&jQuery("#"+h.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw(f.result.link)}}}}):get_item(g.link)};
j.onerror=function(){}}function mark_item_as_deleted(a,b,c){new_deleted_transaction();a={link:a,topic_slug:b,topic_type:c,modified:(new Date).getTime()};var d=Buleys.objectStore.add(a);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}function mark_item_as_undeleted(a){new_deleted_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
function delete_item(a,b,c){new_deleted_transaction();var d={link:a,modified:(new Date).getTime()},e=Buleys.objectStore.add(d);e.onsuccess=function(){Buleys.objectId=e.result};e.onerror=function(){};remove_item_from_favorites_database(a,b,c);remove_item_from_categories_database(a,b,c);remove_item_from_archives_database(a,b,c);remove_item_from_seens_database(a,b,c);remove_item_from_read_database(a,b,c)}
function check_if_item_is_deleted(a){new_deleted_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){checker=b;if(typeof b.result!="undefined"){jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).prepend("<span class='delete_status'><a href='"+a+"' class='fav_link star_icon'></a></span>");jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("deleted")}else jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).prepend("<span class='delete_status'><a href='"+a+"' class='unfav_link empty_star_icon'></a></span>")};
b.onerror=function(){}}function add_item_to_deletes_database(a,b,c){new_deleted_transaction();a={item_link:a,topic_slug:b,topic_type:c,modified:(new Date).getTime()};var d=Buleys.objectStore.add(a);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}function remove_item_from_deletes_database(a){new_deleted_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}};
$("body").bind("favorite",function(b){b.preventDefault();if(is_in_cursor_mode()){jQuery("#"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("empty_star_icon").addClass("star_icon");jQuery("#"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("unfav_link");
jQuery("#favorite_"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("empty_star_icon").addClass("star_icon");jQuery("#favorite_"+jQuery(".cursor a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("fav_link").addClass("unfav_link");add_item_to_favorites_database($(".cursor a").attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("star",$(".cursor a").attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item favorited</p>");
setTimeout("fade_console_message()",1E3)}else $.each($(".selected"),function(c,a){jQuery("#"+jQuery(a).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("empty_star_icon").addClass("star_icon");jQuery("#"+jQuery(a).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(a).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,
"")).children(".favorite_status").children("div").removeClass("unfav_link");jQuery("#favorite_"+jQuery(a).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("empty_star_icon").addClass("star_icon");jQuery("#favorite_"+jQuery(a).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".fav_link").removeClass("fav_link").addClass("unfav_link");add_item_to_favorites_database($(a).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("star",
$(a).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item favorited</p>");setTimeout("fade_console_message()",1E3)})});
$("body").bind("favorite",function(b){b.preventDefault();if(is_in_cursor_mode()){jQuery("#"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("star_icon").addClass("empty_star_icon");jQuery("#"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("unfav_link");
jQuery("#favorite_"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("star_icon").addClass("empty_star_icon");jQuery("#favorite_"+jQuery(".cursor > a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("unfav_link").addClass("fav_link");remove_item_from_favorites_database($(".cursor > a").attr("href"),Buleys.view.slug,Buleys.view.type);post_feedback("unstar",$(".cursor > a").attr("href"),Buleys.view.slug,Buleys.view.type);
send_to_console("<p>item removed from favorites</p>");setTimeout("fade_console_message()",1E3)}else $.each($(".selected"),function(c,a){jQuery("#"+jQuery(a).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").children("div").removeClass("star_icon").addClass("empty_star_icon");jQuery("#"+jQuery(a).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".favorite_status").parent().removeClass("unfavorited").addClass("favorited");jQuery("#"+jQuery(a).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,
"")).children(".favorite_status").children("div").removeClass("unfav_link");jQuery("#favorite_"+jQuery(a).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("star_icon").addClass("empty_star_icon");jQuery("#favorite_"+jQuery(a).children("a").attr("href").replace(/[^a-zA-Z0-9-_]+/g,"")).children(".unfav_link").removeClass("unfav_link").addClass("fav_link");remove_item_from_favorites_database($(a).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);
post_feedback("unstar",$(a).children("a").attr("href"),Buleys.view.slug,Buleys.view.type);send_to_console("<p>item removed from favorites</p>");setTimeout("fade_console_message()",1E3)})});

function new_votes_transaction(){try{var a=Buleys.db.transaction(["votes"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("votes")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("votes",{keyPath:"vote_key"},false);Buleys.objectStore.createIndex("vote_value","vote_value",{unique:false});Buleys.objectStore.createIndex("modified","modified",{unique:false})};
a.onerror=function(){}}}
function check_item_vote_status_for_overlay(a){new_votes_transaction();var b=Buleys.objectStore.get(a.replace(/[^a-zA-Z0-9-_]+/g,""));b.onsuccess=function(c){checker=b;if(typeof c.target.result!=="undefined"){if(c.target.result.vote_value==-1)jQuery("#overlay_left").prepend('<div class="vote_context voted"><div class="vote_up empty_thumb_up_icon" alt="'+Buleys.view.slug+'" id="overlay_upvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+a+'"></div><div class="vote_down vote thumb_icon" id="overlay_downvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,
"")+'" link="'+a+'" alt="'+Buleys.view.slug+'" ></div></div>');else c.target.result.vote_value==1?jQuery("#overlay_left").prepend('<div class="vote_context voted"><div class="vote_up vote thumb_up_icon" alt="'+Buleys.view.slug+'" id="overlay_upvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+a+'"></div><div class="vote_down empty_thumb_icon" id="overlay_downvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+a+'" alt="'+Buleys.view.slug+'" ></div></div>'):jQuery("#overlay_left").prepend('<div class="vote_context"><div class="vote_up empty_thumb_up_icon" alt="'+
Buleys.view.slug+'" id="overlay_upvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+a+'"></div><div href="#" class="vote_down empty_thumb_icon" id="overlay_downvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+a+'" alt="'+Buleys.view.slug+'" ></div></div>');jQuery("#overlay_left").parent().addClass("voted")}else{jQuery("#overlay_left").prepend('<div class="vote_context"><div class="vote_up empty_thumb_up_icon" alt="'+Buleys.view.slug+'" id="overlay_upvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+
a+'"></div><div href="#" class="vote_down empty_thumb_icon" id="overlay_downvote_'+a.replace(/[^a-zA-Z0-9-_]+/g,"")+'" link="'+a+'" alt="'+Buleys.view.slug+'" ></div></div>');jQuery("#overlay_left").parent().addClass("unvoted")}};b.onerror=function(){}}
function get_vote_info(a,b,c){new_votes_transaction();var d=a.replace(/[^a-zA-Z0-9-_]+/g,"")+b.toLowerCase()+c.toLowerCase(),e=Buleys.objectStore.get(d);e.onsuccess=function(){if(!(typeof e.result=="undefined"||e.result==""))if(typeof e.result!="undefined")if(e.result.vote_value==0)jQuery("#"+d).addClass("voted downvoted");else e.result.vote_value==1&&jQuery("#"+d).addClass("voted upvoted")};e.onerror=function(){}}
function get_votes(){try{new_votes_transaction();Buleys.index=Buleys.objectStore.index("vote_key");var a=Buleys.index.getAll();a.onsuccess=function(){var c=a.result;c&&c.length>=0&&jQuery.each(c,function(){})};request.onerror=function(){}}catch(b){}}function remove_vote(a){new_votes_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
function add_or_update_vote(a,b){new_votes_transaction();if(typeof b=="undefined")b="";var c=Buleys.objectStore.get(a);c.onsuccess=function(){typeof c.result=="undefined"?add_vote_to_votes_database(a,b):update_vote_in_votes_database(a,b)};c.onerror=function(){}}function add_vote_to_votes_database(a,b){new_votes_transaction();var c={vote_key:a,vote_value:b,modified:(new Date).getTime()},d=Buleys.objectStore.add(c);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}
function update_vote_in_votes_database(a,b){new_votes_transaction();var c={vote_key:a,vote_value:b,modified:(new Date).getTime()},d=Buleys.objectStore.put(c);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}
$(".vote_up").live("click",function(a){a.preventDefault();a=$(this).attr("link").replace(/[^a-zA-Z0-9-_]+/g,"");var b=a.replace(/[^a-zA-Z0-9-_]+/g,"");if(jQuery("#overlay_upvote_"+b).hasClass("vote")){jQuery("#overlay_upvote_"+b).removeClass("thumb_up_icon").addClass("empty_thumb_up_icon");$(".vote").removeClass("vote");$(this).parent().removeClass("voted");post_feedback("item_remove_upvote",a,Buleys.view.type,Buleys.view.slug);remove_vote(a)}else{jQuery("#overlay_downvote_"+b).removeClass("thumb_icon").addClass("empty_thumb_icon");
jQuery("#overlay_upvote_"+b).removeClass("empty_thumb_up_icon").addClass("thumb_up_icon");$(".vote").removeClass("vote");$(this).parent().addClass("voted");$(this).addClass("vote");post_feedback("item_upvote",a,Buleys.view.type,Buleys.view.slug);add_or_update_vote(a,1)}});
$(".vote_down").live("click",function(a){a.preventDefault();a=$(this).attr("link").replace(/[^a-zA-Z0-9-_]+/g,"");var b=a.replace(/[^a-zA-Z0-9-_]+/g,"");if(jQuery("#overlay_downvote_"+b).hasClass("vote")){jQuery("#overlay_downvote_"+b).removeClass("thumb_icon").addClass("empty_thumb_icon");$(".vote").removeClass("vote");$(this).parent().removeClass("voted");post_feedback("item_remove_downvote",a,Buleys.view.type,Buleys.view.slug);remove_vote(a)}else{jQuery("#overlay_downvote_"+b).removeClass("empty_thumb_icon").addClass("thumb_icon");
jQuery("#overlay_upvote_"+b).removeClass("thumb_up_icon").addClass("empty_thumb_up_icon");$(".vote").removeClass("vote");$(this).parent().addClass("voted");$(this).addClass("vote");post_feedback("item_downvote",a,Buleys.view.type,Buleys.view.slug);add_or_update_vote(a,-1)}});
var results=[];function resultReceiver(a){results.push(parseInt(a.data));results.length==2&&postMessage(results[0]+results[1])}function errorReceiver(a){throw a.data;}onmessage=function(a){a=parseInt(a.data);if(a==0||a==1)postMessage(a);else for(var b=1;b<=2;b++){var c=new Worker("worker.js");c.onmessage=resultReceiver;c.onerror=errorReceiver;c.postMessage(a-b)}};
var getStyleProperty=function(){var e=["Moz","Webkit","Khtml","O","Ms"],k={};return function(j,l){l=l||document.documentElement;var a=l.style,b,c,d,f;if(arguments.length===1&&typeof k[j]==="string")return k[j];if(typeof a[j]==="string")return k[j]=j;c=j.charAt(0).toUpperCase()+j.slice(1);d=0;for(f=e.length;d<f;d++){b=e[d]+c;if(typeof a[b]==="string")return k[j]=b}}}();
window.Modernizr=window.Modernizr||function(e,k){var j={},l=" -o- -moz- -ms- -webkit- -khtml- ".split(" "),a=[],b=document.documentElement,c,d=[{name:"csstransforms",result:function(){return!!getStyleProperty("transform")}},{name:"csstransforms3d",result:function(){var h=!!getStyleProperty("perspective");if(h){var i=document.createElement("style"),m=document.createElement("div");h="@media ("+l.join("transform-3d),(")+"modernizr)";i.textContent=h+"{#modernizr{height:3px}}";(k.head||k.getElementsByTagName("head")[0]).appendChild(i);
m.id="modernizr";b.appendChild(m);h=m.offsetHeight===3;i.parentNode.removeChild(i);m.parentNode.removeChild(m)}return!!h}},{name:"csstransitions",result:function(){return!!getStyleProperty("transitionProperty")}}];c=0;for(len=d.length;c<len;c++){var f=d[c],g=f.result();j[f.name]=g;a.push((g?"":"no-")+f.name)}b.className+=" "+a.join(" ");return j}(this,this.document);
(function(e,k){e.isoTransform={transformProp:getStyleProperty("transform"),fnUtils:Modernizr.csstransforms3d?{translate:function(a){return"translate3d("+a[0]+"px, "+a[1]+"px, 0) "},scale:function(a){return"scale3d("+a+", "+a+", 1) "}}:{translate:function(a){return"translate("+a[0]+"px, "+a[1]+"px) "},scale:function(a){return"scale("+a+") "}},set:function(a,b,c){var d=e(a).data("transform")||{},f={},g,h={};f[b]=c;e.extend(d,f);for(g in d)h[g]=(0,e.isoTransform.fnUtils[g])(d[g]);b=(h.translate||"")+
(h.scale||"");e(a).data("transform",d);a.style[e.isoTransform.transformProp]=b}};e.cssNumber.scale=true;e.cssHooks.scale={set:function(a,b){if(typeof b==="string")b=parseFloat(b);e.isoTransform.set(a,"scale",b)},get:function(a){return(a=e.data(a,"transform"))&&a.scale?a.scale:1}};e.fx.step.scale=function(a){e.cssHooks.scale.set(a.elem,a.now+a.unit)};e.cssNumber.translate=true;e.cssHooks.translate={set:function(a,b){e.isoTransform.set(a,"translate",b)},get:function(a){return(a=e.data(a,"transform"))&&
a.translate?a.translate:[0,0]}};var j=e.event,l;j.special.smartresize={setup:function(){e(this).bind("resize",j.special.smartresize.handler)},teardown:function(){e(this).unbind("resize",j.special.smartresize.handler)},handler:function(a,b){var c=this,d=arguments;a.type="smartresize";l&&clearTimeout(l);l=setTimeout(function(){jQuery.event.handle.apply(c,d)},b==="execAsap"?0:100)}};e.fn.smartresize=function(a){return a?this.bind("smartresize",a):this.trigger("smartresize",["execAsap"])};e.Isotope=function(a,
b){this.element=e(b);this._create(a);this._init()};e.Isotope.prototype={options:{resizable:true,layoutMode:"masonry",containerClass:"isotope",itemClass:"isotope-item",hiddenClass:"isotope-hidden",hiddenStyle:Modernizr.csstransforms&&!e.browser.opera?{opacity:0,scale:0.001}:{opacity:0},visibleStyle:Modernizr.csstransforms&&!e.browser.opera?{opacity:1,scale:1}:{opacity:1},animationEngine:e.browser.opera?"jquery":"best-available",animationOptions:{queue:false,duration:800},sortBy:"original-order",sortAscending:true,
resizesContainer:true},_filterFind:function(a,b){return b?a.filter(b).add(a.find(b)):a},_create:function(a){this.options=e.extend(true,{},this.options,a);this.isNew={};this.styleQueue=[];this.elemCount=0;this.$allAtoms=this._filterFind(this.element.children(),this.options.itemSelector);this.element.css({overflow:"hidden",position:"relative"});a=false;switch(this.options.animationEngine.toLowerCase().replace(/[ _\-]/g,"")){case "none":this.applyStyleFnName="css";break;case "jquery":this.applyStyleFnName=
"animate";a=true;break;default:this.applyStyleFnName=Modernizr.csstransitions?"css":"animate"}this.positionFn=(this.usingTransforms=Modernizr.csstransforms&&Modernizr.csstransitions&&!a)?this._translate:this._positionAbs;this.options.getSortData=e.extend(this.options.getSortData,{"original-order":function(c,d){return d.elemCount}});this._setupAtoms(this.$allAtoms);a=e(document.createElement("div"));this.element.prepend(a);this.posTop=Math.round(a.position().top);this.posLeft=Math.round(a.position().left);
a.remove();var b=this;setTimeout(function(){b.element.addClass(b.options.containerClass)},0);this.options.resizable&&e(window).bind("smartresize.isotope",function(){b.element.isotope("resize")})},_isNewProp:function(a){return this.prevOpts?this.options[a]!==this.prevOpts[a]:true},_init:function(a){var b=this;e.each(["filter","sortBy","sortAscending"],function(c,d){b.isNew[d]=b._isNewProp(d)});this.$filteredAtoms=this.isNew.filter?this._filter(this.$allAtoms):this.$allAtoms;if(this.isNew.filter||this.isNew.sortBy||
this.isNew.sortAscending)this._sort();this.reLayout(a)},option:function(a,b){if(e.isPlainObject(a))this.options=e.extend(true,this.options,a);else if(a&&typeof b==="undefined")return this.options[a];else this.options[a]=b;return this},_setupAtoms:function(a){var b={position:"absolute"};if(this.usingTransforms){b.left=0;b.top=0}a.css(b).addClass(this.options.itemClass);var c=this;a.each(function(){var d=e(this),f={},g=c.options.getSortData,h;for(h in g)f[h]=g[h](d,c);d.data("isotope-sort-data",f);
c.elemCount++})},_filter:function(a){var b=this.options.filter===""?"*":this.options.filter;if(b){var c=this.options.hiddenClass,d="."+c,f=a.not(d),g=a.filter(d);d=g;a=a.filter(b);if(b!=="*"){d=g.filter(b);b=f.not(b).toggleClass(c);b.addClass(c);this.styleQueue.push({$el:b,style:this.options.hiddenStyle})}this.styleQueue.push({$el:d,style:this.options.visibleStyle});d.removeClass(c)}return a},_sort:function(){var a=this,b=function(d){return e(d).data("isotope-sort-data")[a.options.sortBy]},c=this.options.sortAscending?
1:-1;sortFn=function(d,f){var g=b(d),h=b(f);return(g>h?1:g<h?-1:0)*c};this.$filteredAtoms.sort(sortFn);return this},_translate:function(a,b){return{translate:[a,b]}},_positionAbs:function(a,b){return{left:a,top:b}},_pushPosition:function(a,b,c){b=this.positionFn(b,c);this.styleQueue.push({$el:a,style:b})},layout:function(a,b){var c=this.options.layoutMode;this["_"+c+"Layout"](a);this.options.resizesContainer&&this.styleQueue.push({$el:this.element,style:this["_"+c+"GetContainerSize"]()});var d=this.applyStyleFnName===
"animate"&&!this.isLaidOut?"css":this.applyStyleFnName,f=this.options.animationOptions;e.each(this.styleQueue,function(g,h){h.$el[d](h.style,e.extend({},f))});this.styleQueue=[];b&&b.call(a);this.isLaidOut=true;return this},resize:function(){return this["_"+this.options.layoutMode+"Resize"]()},reLayout:function(a){return this["_"+this.options.layoutMode+"Reset"]().layout(this.$filteredAtoms,a)},addItems:function(a,b){var c=this._filterFind(a,this.options.itemSelector);this._setupAtoms(c);this.$allAtoms=
this.$allAtoms.add(c);b&&b(c)},insert:function(a,b){this.element.append(a);var c=this;this.addItems(a,function(d){$filteredAtoms=c._filter(d);c.$filteredAtoms=c.$filteredAtoms.add($filteredAtoms)});this._sort().reLayout(b)},appended:function(a,b){var c=this;this.addItems(a,function(d){c.$filteredAtoms=c.$filteredAtoms.add(d);c.layout(d,b)})},remove:function(a){this.$allAtoms=this.$allAtoms.not(a);this.$filteredAtoms=this.$filteredAtoms.not(a);a.remove()},_shuffleArray:function(a){var b,c,d=a.length;
if(d)for(;--d;){c=~~(Math.random()*(d+1));b=a[c];a[c]=a[d];a[d]=b}return a},shuffle:function(a){this.options.sortBy="shuffle";this.$allAtoms=this._shuffleArray(this.$allAtoms);this.$filteredAtoms=this._filter(this.$allAtoms);return this.reLayout(a)},destroy:function(){var a=e.extend(this.options.visibleStyle,{position:"relative",top:"auto",left:"auto"});if(this.usingTransforms)a[e.isoTransform.transformProp]="none";this.$allAtoms.css(a).removeClass(this.options.hiddenClass);this.element.css({width:"auto",
height:"auto"}).unbind(".isotope").removeClass(this.options.containerClass).removeData("isotope");e(window).unbind(".isotope")},_getSegments:function(a,b){var c=b?"rowHeight":"columnWidth",d=b?"height":"width",f=b?"rows":"cols";this[a][c]=this.options[a]&&this.options[a][c]||this.$allAtoms["outer"+(b?"Height":"Width")](true);if(!this[a][c]){e.error(c+" calculated to be zero. Stopping Isotope plugin before divide by zero. Check that the width of first child inside the isotope container is not zero.");
return this}this[d]=this.element[d]();this[a][f]=Math.floor(this[d]/this[a][c]);this[a][f]=Math.max(this[a][f],1);return this},_masonryPlaceBrick:function(a,b,c){b=Math.min.apply(Math,c);for(var d=b+a.outerHeight(true),f=c.length,g=f,h=this.masonry.cols+1-f;f--;)if(c[f]===b)g=f;this._pushPosition(a,this.masonry.columnWidth*g+this.posLeft,b);for(f=0;f<h;f++)this.masonry.colYs[g+f]=d},_masonryLayout:function(a){var b=this;a.each(function(){var c=e(this),d=Math.ceil(c.outerWidth(true)/b.masonry.columnWidth);
d=Math.min(d,b.masonry.cols);if(d===1)b._masonryPlaceBrick(c,b.masonry.cols,b.masonry.colYs);else{var f=b.masonry.cols+1-d,g=[],h,i;for(i=0;i<f;i++){h=b.masonry.colYs.slice(i,i+d);g[i]=Math.max.apply(Math,h)}b._masonryPlaceBrick(c,f,g)}})},_masonryReset:function(){this.masonry={};this._getSegments("masonry");var a=this.masonry.cols;for(this.masonry.colYs=[];a--;)this.masonry.colYs.push(this.posTop);return this},_masonryResize:function(){var a=this.masonry.cols;this._getSegments("masonry");this.masonry.cols!==
a&&this.reLayout();return this},_masonryGetContainerSize:function(){return{height:Math.max.apply(Math,this.masonry.colYs)-this.posTop}},_fitRowsLayout:function(a){this.width=this.element.width();var b=this;return a.each(function(){var c=e(this),d=c.outerWidth(true),f=c.outerHeight(true);if(b.fitRows.x!==0&&d+b.fitRows.x>b.width){b.fitRows.x=0;b.fitRows.y=b.fitRows.height}b._pushPosition(c,b.fitRows.x+b.posLeft,b.fitRows.y+b.posTop);b.fitRows.height=Math.max(b.fitRows.y+f,b.fitRows.height);b.fitRows.x+=
d})},_fitRowsReset:function(){this.fitRows={x:0,y:0,height:0};return this},_fitRowsGetContainerSize:function(){return{height:this.fitRows.height}},_fitRowsResize:function(){return this.reLayout()},_cellsByRowReset:function(){this.cellsByRow={};this._getSegments("cellsByRow");this.cellsByRow.rowHeight=this.options.cellsByRow.rowHeight||this.$allAtoms.outerHeight(true);return this},_cellsByRowLayout:function(a){var b=this,c=this.cellsByRow.cols;this.cellsByRow.atomsLen=a.length;a.each(function(d){var f=
e(this),g=(d%c+0.5)*b.cellsByRow.columnWidth-f.outerWidth(true)/2+b.posLeft;d=(~~(d/c)+0.5)*b.cellsByRow.rowHeight-f.outerHeight(true)/2+b.posTop;b._pushPosition(f,g,d)});return this},_cellsByRowGetContainerSize:function(){return{height:Math.ceil(this.cellsByRow.atomsLen/this.cellsByRow.cols)*this.cellsByRow.rowHeight+this.posTop}},_cellsByRowResize:function(){var a=this.cellsByRow.cols;this._getSegments("cellsByRow");this.cellsByRow.cols!==a&&this.reLayout();return this},_straightDownReset:function(){this.straightDown=
{y:0};return this},_straightDownLayout:function(a){var b=this;a.each(function(){var c=e(this);b._pushPosition(c,b.posLeft,b.straightDown.y+b.posTop);b.straightDown.y+=c.outerHeight(true)});return this},_straightDownGetContainerSize:function(){return{height:this.straightDown.y+this.posTop}},_straightDownResize:function(){this.reLayout();return this},_masonryHorizontalPlaceBrick:function(a,b,c){b=Math.min.apply(Math,c);for(var d=b+a.outerWidth(true),f=c.length,g=f,h=this.masonryHorizontal.rows+1-f;f--;)if(c[f]===
b)g=f;this._pushPosition(a,b,this.masonryHorizontal.rowHeight*g+this.posTop);for(f=0;f<h;f++)this.masonryHorizontal.rowXs[g+f]=d},_masonryHorizontalLayout:function(a){var b=this;a.each(function(){var c=e(this),d=Math.ceil(c.outerHeight(true)/b.masonryHorizontal.rowHeight);d=Math.min(d,b.masonryHorizontal.rows);if(d===1)b._masonryHorizontalPlaceBrick(c,b.masonryHorizontal.rows,b.masonryHorizontal.rowXs);else{for(var f=b.masonryHorizontal.rows+1-d,g=[],h,i=0;i<f;i++){h=b.masonryHorizontal.rowXs.slice(i,
i+d);g[i]=Math.max.apply(Math,h)}b._masonryHorizontalPlaceBrick(c,f,g)}})},_masonryHorizontalReset:function(){this.masonryHorizontal={};this._getSegments("masonryHorizontal",true);var a=this.masonryHorizontal.rows;for(this.masonryHorizontal.rowXs=[];a--;)this.masonryHorizontal.rowXs.push(this.posLeft);return this},_masonryHorizontalResize:function(){var a=this.masonryHorizontal.rows;this._getSegments("masonryHorizontal",true);this.masonryHorizontal.rows!==a&&this.reLayout();return this},_masonryHorizontalGetContainerSize:function(){return{width:Math.max.apply(Math,
this.masonryHorizontal.rowXs)-this.posLeft}},_fitColumnsReset:function(){this.fitColumns={x:0,y:0,width:0};return this},_fitColumnsLayout:function(a){var b=this;this.height=this.element.height();return a.each(function(){var c=e(this),d=c.outerWidth(true),f=c.outerHeight(true);if(b.fitColumns.y!==0&&f+b.fitColumns.y>b.height){b.fitColumns.x=b.fitColumns.width;b.fitColumns.y=0}b._pushPosition(c,b.fitColumns.x+b.posLeft,b.fitColumns.y+b.posTop);b.fitColumns.width=Math.max(b.fitColumns.x+d,b.fitColumns.width);
b.fitColumns.y+=f})},_fitColumnsGetContainerSize:function(){return{width:this.fitColumns.width}},_fitColumnsResize:function(){return this.reLayout()},_cellsByColumnReset:function(){this.cellsByColumn={};this._getSegments("cellsByColumn",true);this.cellsByColumn.columnWidth=this.options.cellsByColumn.columnWidth||this.$allAtoms.outerHeight(true);return this},_cellsByColumnLayout:function(a){var b=this,c=this.cellsByColumn.rows;this.cellsByColumn.atomsLen=a.length;a.each(function(d){var f=e(this),g=
(~~(d/c)+0.5)*b.cellsByColumn.columnWidth-f.outerWidth(true)/2+b.posLeft;d=(d%c+0.5)*b.cellsByColumn.rowHeight-f.outerHeight(true)/2+b.posTop;b._pushPosition(f,g,d)});return this},_cellsByColumnGetContainerSize:function(){return{width:Math.ceil(this.cellsByColumn.atomsLen/this.cellsByColumn.rows)*this.cellsByColumn.columnWidth+this.posLeft}},_cellsByColumnResize:function(){var a=this.cellsByColumn.rows;this._getSegments("cellsByColumn",true);this.cellsByColumn.rows!==a&&this.reLayout();return this}};
e.fn.imagesLoaded=function(a){var b=this.find("img"),c=b.length,d=this;b.bind("load",function(){--c<=0&&a.call(d)}).each(function(){if(this.complete||this.complete===k){var f=this.src;this.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";this.src=f}});return this};e.widget=e.widget||{};e.widget.bridge=e.widget.bridge||function(a,b){e.fn[a]=function(c){var d=typeof c==="string",f=Array.prototype.slice.call(arguments,1),g=this;c=!d&&f.length?e.extend.apply(null,[true,c].concat(f)):
c;if(d&&c.charAt(0)==="_")return g;d?this.each(function(){var h=e.data(this,a);if(!h)return e.error("cannot call methods on "+a+" prior to initialization; attempted to call method '"+c+"'");if(!e.isFunction(h[c]))return e.error("no such method '"+c+"' for "+a+" widget instance");var i=h[c].apply(h,f);if(i!==h&&i!==k){g=i;return false}}):this.each(function(){var h=e.data(this,a);h?h.option(c||{})._init():e.data(this,a,new b(c,this))});return g}};e.widget.bridge("isotope",e.Isotope)})(jQuery);
function md5(t){var i=function(g,h){var m,n,q,p,j;q=g&2147483648;p=h&2147483648;m=g&1073741824;n=h&1073741824;j=(g&1073741823)+(h&1073741823);if(m&n)return j^2147483648^q^p;return m|n?j&1073741824?j^3221225472^q^p:j^1073741824^q^p:j^q^p},k=function(g,h,m,n,q,p,j){g=i(g,i(i(h&m|~h&n,q),j));return i(g<<p|g>>>32-p,h)},l=function(g,h,m,n,q,p,j){g=i(g,i(i(h&n|m&~n,q),j));return i(g<<p|g>>>32-p,h)},r=function(g,h,m,n,q,p,j){g=i(g,i(i(h^m^n,q),j));return i(g<<p|g>>>32-p,h)},o=function(g,h,m,n,q,p,j){g=i(g,
i(i(m^(h|~n),q),j));return i(g<<p|g>>>32-p,h)},s=function(g){var h="",m="",n;for(n=0;n<=3;n++){m=g>>>n*8&255;m="0"+m.toString(16);h+=m.substr(m.length-2,2)}return h},e=[],f,u,v,w,x,a,b,c,d;t=this.utf8_encode(t);e=function(g){var h,m=g.length;h=m+8;for(var n=((h-h%64)/64+1)*16,q=Array(n-1),p=0,j=0;j<m;){h=(j-j%4)/4;p=j%4*8;q[h]|=g.charCodeAt(j)<<p;j++}q[(j-j%4)/4]|=128<<j%4*8;q[n-2]=m<<3;q[n-1]=m>>>29;return q}(t);a=1732584193;b=4023233417;c=2562383102;d=271733878;t=e.length;for(f=0;f<t;f+=16){u=a;
v=b;w=c;x=d;a=k(a,b,c,d,e[f+0],7,3614090360);d=k(d,a,b,c,e[f+1],12,3905402710);c=k(c,d,a,b,e[f+2],17,606105819);b=k(b,c,d,a,e[f+3],22,3250441966);a=k(a,b,c,d,e[f+4],7,4118548399);d=k(d,a,b,c,e[f+5],12,1200080426);c=k(c,d,a,b,e[f+6],17,2821735955);b=k(b,c,d,a,e[f+7],22,4249261313);a=k(a,b,c,d,e[f+8],7,1770035416);d=k(d,a,b,c,e[f+9],12,2336552879);c=k(c,d,a,b,e[f+10],17,4294925233);b=k(b,c,d,a,e[f+11],22,2304563134);a=k(a,b,c,d,e[f+12],7,1804603682);d=k(d,a,b,c,e[f+13],12,4254626195);c=k(c,d,a,b,e[f+
14],17,2792965006);b=k(b,c,d,a,e[f+15],22,1236535329);a=l(a,b,c,d,e[f+1],5,4129170786);d=l(d,a,b,c,e[f+6],9,3225465664);c=l(c,d,a,b,e[f+11],14,643717713);b=l(b,c,d,a,e[f+0],20,3921069994);a=l(a,b,c,d,e[f+5],5,3593408605);d=l(d,a,b,c,e[f+10],9,38016083);c=l(c,d,a,b,e[f+15],14,3634488961);b=l(b,c,d,a,e[f+4],20,3889429448);a=l(a,b,c,d,e[f+9],5,568446438);d=l(d,a,b,c,e[f+14],9,3275163606);c=l(c,d,a,b,e[f+3],14,4107603335);b=l(b,c,d,a,e[f+8],20,1163531501);a=l(a,b,c,d,e[f+13],5,2850285829);d=l(d,a,b,c,
e[f+2],9,4243563512);c=l(c,d,a,b,e[f+7],14,1735328473);b=l(b,c,d,a,e[f+12],20,2368359562);a=r(a,b,c,d,e[f+5],4,4294588738);d=r(d,a,b,c,e[f+8],11,2272392833);c=r(c,d,a,b,e[f+11],16,1839030562);b=r(b,c,d,a,e[f+14],23,4259657740);a=r(a,b,c,d,e[f+1],4,2763975236);d=r(d,a,b,c,e[f+4],11,1272893353);c=r(c,d,a,b,e[f+7],16,4139469664);b=r(b,c,d,a,e[f+10],23,3200236656);a=r(a,b,c,d,e[f+13],4,681279174);d=r(d,a,b,c,e[f+0],11,3936430074);c=r(c,d,a,b,e[f+3],16,3572445317);b=r(b,c,d,a,e[f+6],23,76029189);a=r(a,
b,c,d,e[f+9],4,3654602809);d=r(d,a,b,c,e[f+12],11,3873151461);c=r(c,d,a,b,e[f+15],16,530742520);b=r(b,c,d,a,e[f+2],23,3299628645);a=o(a,b,c,d,e[f+0],6,4096336452);d=o(d,a,b,c,e[f+7],10,1126891415);c=o(c,d,a,b,e[f+14],15,2878612391);b=o(b,c,d,a,e[f+5],21,4237533241);a=o(a,b,c,d,e[f+12],6,1700485571);d=o(d,a,b,c,e[f+3],10,2399980690);c=o(c,d,a,b,e[f+10],15,4293915773);b=o(b,c,d,a,e[f+1],21,2240044497);a=o(a,b,c,d,e[f+8],6,1873313359);d=o(d,a,b,c,e[f+15],10,4264355552);c=o(c,d,a,b,e[f+6],15,2734768916);
b=o(b,c,d,a,e[f+13],21,1309151649);a=o(a,b,c,d,e[f+4],6,4149444226);d=o(d,a,b,c,e[f+11],10,3174756917);c=o(c,d,a,b,e[f+2],15,718787259);b=o(b,c,d,a,e[f+9],21,3951481745);a=i(a,u);b=i(b,v);c=i(c,w);d=i(d,x)}return(s(a)+s(b)+s(c)+s(d)).toLowerCase()}
function utf8_encode(t){t+="";var i="",k,l,r=0;k=l=0;r=t.length;for(var o=0;o<r;o++){var s=t.charCodeAt(o),e=null;if(s<128)l++;else e=s>127&&s<2048?String.fromCharCode(s>>6|192)+String.fromCharCode(s&63|128):String.fromCharCode(s>>12|224)+String.fromCharCode(s>>6&63|128)+String.fromCharCode(s&63|128);if(e!==null){if(l>k)i+=t.substring(k,l);i+=e;k=l=o+1}}if(l>k)i+=t.substring(k,t.length);return i};
