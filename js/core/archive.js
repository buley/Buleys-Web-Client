function new_archived_transaction(){try{var a=Buleys.db.transaction(["archive"],IDBTransaction.READ_WRITE,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("archive")}catch(b){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("archive",{keyPath:"link"},true);Buleys.objectStore.createIndex("topic_slug","topic_slug",{unique:false});Buleys.objectStore.createIndex("topic_type",
"topic_type",{unique:false});Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function get_archived(a,b,e,d,f){if(typeof f=="undefined")f=false;typeof e=="undefined"||e==null||parseInt(e);typeof d=="undefined"||d==null?(new Date).getTime():parseInt(d);new_categories_transaction();Buleys.index=Buleys.objectStore.index("slug");var i=Buleys.index.openCursor(b);i.onsuccess=function(){var g=i.result;if(g)g.length>1?jQuery.each(g,function(k,h){new_archived_transaction();var j=Buleys.objectStore.get(h.link);j.onsuccess=function(){if(typeof j.result!=="undefined"&&f!==true){new_item_transaction();
var c=Buleys.objectStore.get(j.result.link);c.onsuccess=function(){typeof c.result!=="undefined"&&typeof c.result.link!=="undefined"&&jQuery("#"+h.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw(c.result.link)}}else if(f==true){new_item_transaction();c=Buleys.objectStore.get(h.link);c.onsuccess=function(){typeof c.result!=="undefined"&&typeof c.result!=="undefined"&&jQuery("#"+h.link.replace(/[^a-zA-Z0-9-_]+/g,"")).length<=0&&get_item_raw(c.result.link)}}}}):get_item(g.link)};i.onerror=
function(){}}function archive_item(a){new_archived_transaction();a={link:a,modified:(new Date).getTime()};var b=Buleys.objectStore.add(a);b.onsuccess=function(){Buleys.objectId=b.result};b.onerror=function(){}}
function check_if_item_is_archived(a){new_archived_transaction();var b=Buleys.objectStore.get(a);b.onsuccess=function(){checker=b;typeof b.result!="undefined"?jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("archived"):jQuery("#"+a.replace(/[^a-zA-Z0-9-_]+/g,"")).addClass("unarchived")};b.onerror=function(){}}
function add_item_to_archives_database(a,b,e){new_archived_transaction();a={item_link:a,topic_slug:b,topic_type:e,modified:(new Date).getTime()};var d=Buleys.objectStore.add(a);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}function unarchive_item(a){new_archived_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}}
function remove_item_from_archives_database(a){new_archived_transaction();a=Buleys.objectStore["delete"](a);a.onsuccess=function(){delete Buleys.objectId};a.onerror=function(){}};
