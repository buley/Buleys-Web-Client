function new_subscriptions_transaction(){try{var a=Buleys.db.transaction(["subscriptions"],1,1E3);a.oncomplete=function(){delete Buleys.objectStore};a.onabort=function(){};Buleys.objectStore=a.objectStore("subscriptions")}catch(c){a=Buleys.db.setVersion(parseInt(Buleys.db.version)+1);a.onsuccess=function(){Buleys.objectStore=Buleys.db.createObjectStore("subscriptions",{keyPath:"key"},true);Buleys.objectStore.createIndex("modified","modified",{unique:false})};a.onerror=function(){}}}
function add_subscription_to_subscriptions_database(a,c){new_subscriptions_transaction();var b={key:a+"_"+c,modified:(new Date).getTime()},d=Buleys.objectStore.add(b);d.onsuccess=function(){Buleys.objectId=d.result};d.onerror=function(){}}
function get_page_subscription_status(a,c){new_subscriptions_transaction();var b=Buleys.objectStore.get(a+"_"+c);b.onsuccess=function(){typeof b.result=="undefined"||b.result==""?jQuery("#page_meta").append("<a href='#' class='subscribe_topic'><img src='http://buleys.com/images/icons/fugue-shadowless/mail.png'/></a>"):jQuery("#page_meta").append("<a href='#' class='unsubscribe_topic'><img src='http://buleys.com/images/icons/fugue-shadowless/mail-send.png'/></a>")};b.onerror=function(){}}
function remove_subscription(a,c){new_subscriptions_transaction();var b=Buleys.objectStore["delete"](a+"_"+c);b.onsuccess=function(){delete Buleys.objectId};b.onerror=function(){}}function add_subscription_if_doesnt_exist(a,c){if(typeof a!=="undefined"&&typeof c!=="undefined"){new_subscriptions_transaction();var b=Buleys.objectStore.get(a+"_"+c);b.onsuccess=function(){typeof b.result=="undefined"&&add_subscription_to_subscriptions_database(a,c)};b.onerror=function(){}}}
function get_subscriptions(){new_subscriptions_transaction();try{new_categories_transaction();Buleys.index=Buleys.objectStore.index("id");var a=Buleys.index.getAll();a.onsuccess=function(){var b=a.result;b&&b.length>=0&&jQuery.each(b,function(){})};request.onerror=function(){}}catch(c){}};
